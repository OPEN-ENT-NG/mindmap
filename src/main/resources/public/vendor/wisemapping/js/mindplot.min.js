var mindplot={}
mindplot.util={},mindplot.commands={},mindplot.layout={},mindplot.layout.boards={},mindplot.layout.boards.original={},mindplot.widget={},mindplot.model={},mindplot.collaboration={},mindplot.collaboration.framework={},mindplot.persistence={},mindplot.layout={},Class.Mutators.Static=function(t){this.extend(t)}
var web2d={}
web2d.peer={svg:{}},web2d.peer.utils={},web2d.peer.utils.EventUtils={broadcastChangeEvent:function(t,e){var i=t.getChangeEventListeners(e)
if($defined(i))for(var n=0;n<i.length;n++){var o=i[n]
o.call(t,null)}for(var s=t.getChildren(),r=0;r<s.length;r++){var a=s[r]
web2d.peer.utils.EventUtils.broadcastChangeEvent(a,e)}}},web2d.peer.utils.TransformUtil={workoutScale:function(t){for(var e=t.getParent(),i=1,n=1;e;){var o=e.getCoordSize(),s=e.getSize()
i*=parseInt(s.width)/o.width,n*=parseInt(s.height)/o.height,e=e.getParent()}return{width:i,height:n}}},web2d.peer.svg.ElementPeer=new Class({initialize:function(t){if(this._native=t,!this._native.addEvent)for(var e in Element)this._native[e]=Element.prototype[e]
this._size={width:1,height:1},this._changeListeners={}},setChildren:function(t){this._children=t},getChildren:function(){var t=this._children
return $defined(t)||(t=[],this._children=t),t},getParent:function(){return this._parent},setParent:function(t){this._parent=t},appendChild:function(t){t.setParent(this)
var e=this.getChildren()
e.include(t),this._native.appendChild(t._native),web2d.peer.utils.EventUtils.broadcastChangeEvent(this,"strokeStyle")},removeChild:function(t){t.setParent(null)
var e=this.getChildren(),i=e.length
e.erase(t),$assert(e.length<i,"element could not be removed:"+t),this._native.removeChild(t._native)},addEvent:function(t,e){this._native.addEvent(t,e)},fireEvent:function(t,e){this._native.fireEvent(t,e)},cloneEvents:function(t){this._native.cloneEvents(t)},removeEvent:function(t,e){this._native.removeEvent(t,e)},setSize:function(t,e){$defined(t)&&this._size.width!=parseInt(t)&&(this._size.width=parseInt(t),this._native.setAttribute("width",parseInt(t))),$defined(e)&&this._size.height!=parseInt(e)&&(this._size.height=parseInt(e),this._native.setAttribute("height",parseInt(e))),web2d.peer.utils.EventUtils.broadcastChangeEvent(this,"strokeStyle")},getSize:function(){return{width:this._size.width,height:this._size.height}},setFill:function(t,e){$defined(t)&&this._native.setAttribute("fill",t),$defined(e)&&this._native.setAttribute("fill-opacity",e)},getFill:function(){var t=this._native.getAttribute("fill"),e=this._native.getAttribute("fill-opacity")
return{color:t,opacity:Number(e)}},getStroke:function(){var t=this._native,e=t.getAttribute("stroke"),i=this._stokeStyle,n=t.getAttribute("stroke-opacity"),o=t.getAttribute("stroke-width")
return{color:e,style:i,opacity:n,width:o}},setStroke:function(t,e,i,n){if($defined(t)&&this._native.setAttribute("stroke-width",t+"px"),$defined(i)&&this._native.setAttribute("stroke",i),$defined(e)){var o=this.__stokeStyleToStrokDasharray[e],s=1/web2d.peer.utils.TransformUtil.workoutScale(this).width,r=this._native.getAttribute("stroke-width")
r=parseFloat(r)
for(var a=[],l=0;l<o.length;l++)a[l]=o[l]*r,a[l]=a[l]*s+"px"
this._stokeStyle=e}$defined(n)&&this._native.setAttribute("stroke-opacity",n)},setVisibility:function(t){this._native.setAttribute("visibility",t?"visible":"hidden")},isVisible:function(){var t=this._native.getAttribute("visibility")
return!("hidden"==t)},updateStrokeStyle:function(){var t=this._stokeStyle
this.getParent()&&t&&"solid"!=t&&this.setStroke(null,t)},attachChangeEventListener:function(t,e){var i=this.getChangeEventListeners(t)
if(!$defined(e))throw"Listener can not be null"
i.push(e)},getChangeEventListeners:function(t){var e=this._changeListeners[t]
return $defined(e)||(e=[],this._changeListeners[t]=e),e},positionRelativeTo:function(t,e){e=$defined(e)?e:{},e.relativeTo=$moo(this._native),t.position(e)},moveToFront:function(){this._native.parentNode.appendChild(this._native)},moveToBack:function(){this._native.parentNode.insertBefore(this._native,this._native.parentNode.firstChild)},setCursor:function(t){this._native.style.cursor=t}}),web2d.peer.svg.ElementPeer.prototype.svgNamespace="http://www.w3.org/2000/svg",web2d.peer.svg.ElementPeer.prototype.linkNamespace="http://www.w3.org/1999/xlink",web2d.peer.svg.ElementPeer.prototype.__stokeStyleToStrokDasharray={solid:[],dot:[1,3],dash:[4,3],longdash:[10,2],dashdot:[5,3,1,3]},web2d.peer.svg.ElipsePeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"ellipse")
this.parent(t),this.attachChangeEventListener("strokeStyle",web2d.peer.svg.ElementPeer.prototype.updateStrokeStyle),this._position={x:0,y:0}},setSize:function(t,e){this.parent(t,e),$defined(t)&&this._native.setAttribute("rx",t/2),$defined(e)&&this._native.setAttribute("ry",e/2)
var i=this.getPosition()
this.setPosition(i.x,i.y)},setPosition:function(t,e){var i=this.getSize()
t+=i.width/2,e+=i.height/2,$defined(t)&&this._native.setAttribute("cx",t),$defined(e)&&this._native.setAttribute("cy",e)},getPosition:function(){return this._position}}),web2d.peer.svg.Font=new Class({initialize:function(){this._size=10,this._style="normal",this._weight="normal"},init:function(t){$defined(t.size)&&(this._size=parseInt(t.size)),$defined(t.style)&&(this._style=t.style),$defined(t.weight)&&(this._weight=t.weight)},getHtmlSize:function(t){var e=0
return 6==this._size&&(e=this._size*t.height*43/32),8==this._size?e=this._size*t.height*42/32:10==this._size?e=this._size*t.height*42/32:15==this._size&&(e=this._size*t.height*42/32),e},getGraphSize:function(){return 43*this._size/32},getSize:function(){return parseInt(this._size)},getStyle:function(){return this._style},getWeight:function(){return this._weight},setSize:function(t){this._size=t},setStyle:function(t){this._style=t},setWeight:function(t){this._weight=t},getWidthMargin:function(){var t=0
return(10==this._size||6==this._size)&&(t=4),t}}),web2d.peer.svg.ArialFont=new Class({Extends:web2d.peer.svg.Font,initialize:function(){this.parent(),this._fontFamily="Arial"},getFontFamily:function(){return this._fontFamily},getFont:function(){return web2d.Font.ARIAL}}),web2d.peer.svg.PolyLinePeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"polyline")
this.parent(t),this.setFill("none"),this.breakDistance=10},setFrom:function(t,e){this._x1=t,this._y1=e,this._updatePath()},setTo:function(t,e){this._x2=t,this._y2=e,this._updatePath()},setStrokeWidth:function(t){this._native.setAttribute("stroke-width",t)},setColor:function(t){this._native.setAttribute("stroke",t)},setStyle:function(t){this._style=t,this._updatePath()},getStyle:function(){return this._style},_updatePath:function(){"Curved"==this._style?this._updateMiddleCurvePath():"Straight"==this._style?this._updateStraightPath():this._updateCurvePath()},_updateStraightPath:function(){if($defined(this._x1)&&$defined(this._x2)&&$defined(this._y1)&&$defined(this._y2)){var t=web2d.PolyLine.buildStraightPath(this.breakDistance,this._x1,this._y1,this._x2,this._y2)
this._native.setAttribute("points",t)}},_updateMiddleCurvePath:function(){var t=this._x1,e=this._y1,i=this._x2,n=this._y2
if($defined(t)&&$defined(i)&&$defined(e)&&$defined(n)){var o=i-t,s=o/2+t,r=1,a=1
0>o&&(r=-1),e>n&&(a=-1)
var l=t+", "+e+" "+(s-10*r)+", "+e+" "+s+", "+(e+10*a)+" "+s+", "+(n-10*a)+" "+(s+10*r)+", "+n+" "+i+", "+n
this._native.setAttribute("points",l)}},_updateCurvePath:function(){if($defined(this._x1)&&$defined(this._x2)&&$defined(this._y1)&&$defined(this._y2)){var t=web2d.PolyLine.buildCurvedPath(this.breakDistance,this._x1,this._y1,this._x2,this._y2)
this._native.setAttribute("points",t)}}}),web2d.peer.svg.CurvedLinePeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"path")
this.parent(t),this._style={fill:"#495879"},this._updateStyle(),this._customControlPoint_1=!1,this._customControlPoint_2=!1,this._control1=new core.Point,this._control2=new core.Point,this._lineStyle=!0},setSrcControlPoint:function(t){this._customControlPoint_1=!0
var e=this._control1.x!=t.x||this._control1.y!=t.y
$defined(t.x)&&(this._control1=t,this._control1.x=parseInt(this._control1.x),this._control1.y=parseInt(this._control1.y)),e&&this._updatePath()},setDestControlPoint:function(t){this._customControlPoint_2=!0
var e=this._control2.x!=t.x||this._control2.y!=t.y
$defined(t.x)&&(this._control2=t,this._control2.x=parseInt(this._control2.x),this._control2.y=parseInt(this._control2.y)),e&&this._updatePath()},isSrcControlPointCustom:function(){return this._customControlPoint_1},isDestControlPointCustom:function(){return this._customControlPoint_2},setIsSrcControlPointCustom:function(t){this._customControlPoint_1=t},setIsDestControlPointCustom:function(t){this._customControlPoint_2=t},getControlPoints:function(){return[this._control1,this._control2]},setFrom:function(t,e){var i=this._x1!=parseInt(t)||this._y1!=parseInt(e)
this._x1=parseInt(t),this._y1=parseInt(e),i&&this._updatePath()},setTo:function(t,e){var i=this._x2!=parseInt(t)||this._y2!=parseInt(e)
this._x2=parseInt(t),this._y2=parseInt(e),i&&this._updatePath()},getFrom:function(){return new core.Point(this._x1,this._y1)},getTo:function(){return new core.Point(this._x2,this._y2)},setStrokeWidth:function(t){this._style["stroke-width"]=t,this._updateStyle()},setColor:function(t){this._style.stroke=t,this._style.fill=t,this._updateStyle()},updateLine:function(t){this._updatePath(t)},setLineStyle:function(t){this._lineStyle=t,this._lineStyle?this._style.fill=this._fill:(this._fill=this._style.fill,this._style.fill="none"),this._updateStyle(),this.updateLine()},getLineStyle:function(){return this._lineStyle},setShowEndArrow:function(t){this._showEndArrow=t,this.updateLine()},isShowEndArrow:function(){return this._showEndArrow},setShowStartArrow:function(t){this._showStartArrow=t,this.updateLine()},isShowStartArrow:function(){return this._showStartArrow},_updatePath:function(t){if($defined(this._x1)&&$defined(this._y1)&&$defined(this._x2)&&$defined(this._y2)){this._calculateAutoControlPoints(t)
var e="M"+this._x1+","+this._y1+" C"+(this._control1.x+this._x1)+","+(this._control1.y+this._y1)+" "+(this._control2.x+this._x2)+","+(this._control2.y+this._y2)+" "+this._x2+","+this._y2+(this._lineStyle?" "+(this._control2.x+this._x2)+","+(this._control2.y+this._y2+3)+" "+(this._control1.x+this._x1)+","+(this._control1.y+this._y1+5)+" "+this._x1+","+(this._y1+7)+" Z":"")
this._native.setAttribute("d",e)}},_updateStyle:function(){var t=""
for(var e in this._style)t+=e+":"+this._style[e]+" "
this._native.setAttribute("style",t)},_calculateAutoControlPoints:function(t){var e=mindplot.util.Shape.calculateDefaultControlPoints(new core.Point(this._x1,this._y1),new core.Point(this._x2,this._y2))
this._customControlPoint_1||$defined(t)&&0==t||(this._control1.x=e[0].x,this._control1.y=e[0].y),this._customControlPoint_2||$defined(t)&&1==t||(this._control2.x=e[1].x,this._control2.y=e[1].y)},setDashed:function(t,e){$defined(t)&&$defined(e)?this._native.setAttribute("stroke-dasharray",t+","+e):this._native.setAttribute("stroke-dasharray","")}}),web2d.peer.svg.ArrowPeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"path")
this.parent(t),this._style={},this._controlPoint=new core.Point,this._fromPoint=new core.Point},setFrom:function(t,e){this._fromPoint.x=t,this._fromPoint.y=e,this._redraw()},setControlPoint:function(t){this._controlPoint=t,this._redraw()},setStrokeColor:function(t){this.setStroke(null,null,t,null)},setStrokeWidth:function(t){this.setStroke(t)},setDashed:function(t,e,i){$defined(t)&&t&&$defined(e)&&$defined(i)?this._native.setAttribute("stroke-dasharray",e+","+i):this._native.setAttribute("stroke-dasharray","")},_updateStyle:function(){var t=""
for(var e in this._style)t+=e+":"+this._style[e]+" "
this._native.setAttribute("style",t)},_redraw:function(){var t,e,i,n
if($defined(this._fromPoint.x)&&$defined(this._fromPoint.y)&&$defined(this._controlPoint.x)&&$defined(this._controlPoint.y)){0==this._controlPoint.y&&(this._controlPoint.y=1)
var o=this._controlPoint.y,s=this._controlPoint.x,r=s+o,a=o-s,l=s-o,d=o+s,c=a/r,h=d/l,u=6,p=Math.pow
t=0==r?0:Math.sqrt(p(u,2)/(1+p(c,2))),t*=Math.sign(r),e=0==r?u*Math.sign(a):c*t,i=0==l?0:Math.sqrt(p(u,2)/(1+p(h,2))),i*=Math.sign(l),n=0==l?u*Math.sign(d):h*i
var g="M"+this._fromPoint.x+","+this._fromPoint.y+" L"+(t+this._fromPoint.x)+","+(e+this._fromPoint.y)+"M"+this._fromPoint.x+","+this._fromPoint.y+" L"+(i+this._fromPoint.x)+","+(n+this._fromPoint.y)
this._native.setAttribute("d",g)}}}),web2d.peer.svg.TextPeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"text")
this.parent(t),this._position={x:0,y:0},this._font=new web2d.Font("Arial",this)},appendChild:function(t){this._native.appendChild(t._native)},setTextAlignment:function(t){this._textAlign=t},getTextAlignment:function(){return $defined(this._textAlign)?this._textAlign:"left"},setText:function(t){for(;this._native.firstChild;)this._native.removeChild(this._native.firstChild)
if(this._text=t,t){var e=t.split("\n")
e.forEach(function(t){var e=window.document.createElementNS(this.svgNamespace,"tspan")
e.setAttribute("dy","1em"),e.setAttribute("x",this.getPosition().x),e.textContent=0==t.length?" ":t,this._native.appendChild(e)}.bind(this))}},getText:function(){return this._text},setPosition:function(t,e){this._position={x:t,y:e},this._native.setAttribute("y",e),this._native.setAttribute("x",t),this._native.getElements("tspan").forEach(function(e){e.setAttribute("x",t)})},getPosition:function(){return this._position},setFont:function(t,e,i,n){$defined(t)&&(this._font=new web2d.Font(t,this)),$defined(i)&&this._font.setStyle(i),$defined(n)&&this._font.setWeight(n),$defined(e)&&this._font.setSize(e),this._updateFontStyle()},_updateFontStyle:function(){this._native.setAttribute("font-family",this._font.getFontFamily()),this._native.setAttribute("font-size",this._font.getGraphSize()),this._native.setAttribute("font-style",this._font.getStyle()),this._native.setAttribute("font-weight",this._font.getWeight())},setColor:function(t){this._native.setAttribute("fill",t)},getColor:function(){return this._native.getAttribute("fill")},setTextSize:function(t){this._font.setSize(t),this._updateFontStyle()},setContentSize:function(t,e){this._native.xTextSize=t.toFixed(1)+","+e.toFixed(1)},setStyle:function(t){this._font.setStyle(t),this._updateFontStyle()},setWeight:function(t){this._font.setWeight(t),this._updateFontStyle()},setFontFamily:function(t){var e=this._font
this._font=new web2d.Font(t,this),this._font.setSize(e.getSize()),this._font.setStyle(e.getStyle()),this._font.setWeight(e.getWeight()),this._updateFontStyle()},getFont:function(){return{font:this._font.getFont(),size:parseInt(this._font.getSize()),style:this._font.getStyle(),weight:this._font.getWeight()}},setSize:function(t){this._font.setSize(t),this._updateFontStyle()},getWidth:function(){var t
try{if(t=this._native.getBBox().width,0==t){var e=this._native.getBBox()
t=e.width}}catch(i){t=10}var n=parseInt(t)
return n+=this._font.getWidthMargin()},getHeight:function(){try{var t=this._native.getBBox().height}catch(e){t=10}return parseInt(t)},getHtmlFontSize:function(){return this._font.getHtmlSize()}}),web2d.peer.svg.WorkspacePeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(t){this._element=t
var e=window.document.createElementNS(this.svgNamespace,"svg")
this.parent(e),this._native.setAttribute("focusable","true"),this._native.setAttribute("id","workspace"),this._native.setAttribute("preserveAspectRatio","true")},setCoordSize:function(t,e){var i=this._native.getAttribute("viewBox"),n=[0,0,0,0]
null!=i&&(n=i.split(/ /)),$defined(t)&&(n[2]=t),$defined(e)&&(n[3]=e),this._native.setAttribute("viewBox",n.join(" ")),this._native.setAttribute("preserveAspectRatio","none"),web2d.peer.utils.EventUtils.broadcastChangeEvent(this,"strokeStyle")},getCoordSize:function(){var t=this._native.getAttribute("viewBox"),e=[1,1,1,1]
return null!=t&&(e=t.split(/ /)),{width:e[2],height:e[3]}},setCoordOrigin:function(t,e){var i=this._native.getAttribute("viewBox"),n=[0,0,0,0]
null!=i&&(n=i.split(/ /)),$defined(t)&&(n[0]=t),$defined(e)&&(n[1]=e),this._native.setAttribute("viewBox",n.join(" "))},appendChild:function(t){this.parent(t),web2d.peer.utils.EventUtils.broadcastChangeEvent(t,"onChangeCoordSize")},getCoordOrigin:function(t){var e=this._native.getAttribute("viewBox"),i=[1,1,1,1]
null!=e&&(i=e.split(/ /))
var n=parseFloat(i[0]),o=parseFloat(i[1])
return{x:n,y:o}},getPosition:function(){return{x:0,y:0}}}),web2d.peer.svg.GroupPeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"g")
this.parent(t),this._native.setAttribute("preserveAspectRatio","none"),this._coordSize={width:1,height:1},this._native.setAttribute("focusable","true"),this._position={x:0,y:0},this._coordOrigin={x:0,y:0}},setCoordSize:function(t,e){var i=this._coordSize.width!=t||this._coordSize.height!=e
this._coordSize.width=t,this._coordSize.height=e,i&&this.updateTransform(),web2d.peer.utils.EventUtils.broadcastChangeEvent(this,"strokeStyle")},getCoordSize:function(){return{width:this._coordSize.width,height:this._coordSize.height}},updateTransform:function(){var t=this._size.width/this._coordSize.width,e=this._size.height/this._coordSize.height,i=this._position.x-this._coordOrigin.x*t,n=this._position.y-this._coordOrigin.y*e
this._native.setAttribute("transform","translate("+i+","+n+") scale("+t+","+e+")")},setOpacity:function(t){this._native.setAttribute("opacity",t)},setCoordOrigin:function(t,e){var i=t!=this._coordOrigin.x||e!=this._coordOrigin.y
$defined(t)&&(this._coordOrigin.x=t),$defined(e)&&(this._coordOrigin.y=e),i&&this.updateTransform()},setSize:function(t,e){var i=t!=this._size.width||e!=this._size.height
this.parent(t,e),i&&this.updateTransform()},setPosition:function(t,e){var i=t!=this._position.x||e!=this._position.y
$defined(t)&&(this._position.x=parseInt(t)),$defined(e)&&(this._position.y=parseInt(e)),i&&this.updateTransform()},getPosition:function(){return{x:this._position.x,y:this._position.y}},appendChild:function(t){this.parent(t),web2d.peer.utils.EventUtils.broadcastChangeEvent(t,"onChangeCoordSize")},getCoordOrigin:function(){return{x:this._coordOrigin.x,y:this._coordOrigin.y}}}),web2d.peer.svg.RectPeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(t){var e=window.document.createElementNS(this.svgNamespace,"rect")
this.parent(e),this._arc=t,this.attachChangeEventListener("strokeStyle",web2d.peer.svg.ElementPeer.prototype.updateStrokeStyle)},setPosition:function(t,e){$defined(t)&&this._native.setAttribute("x",parseInt(t)),$defined(e)&&this._native.setAttribute("y",parseInt(e))},getPosition:function(){var t=this._native.getAttribute("x"),e=this._native.getAttribute("y")
return{x:parseInt(t),y:parseInt(e)}},setSize:function(t,e){this.parent(t,e)
var i=e>t?t:e
if($defined(this._arc)){var n=i/2*this._arc
this._native.setAttribute("rx",n),this._native.setAttribute("ry",n)}}}),web2d.peer.svg.ImagePeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"image")
this.parent(t),this._position={x:0,y:0},this._href="",this._native.setAttribute("preserveAspectRatio","none")},setPosition:function(t,e){this._position={x:t,y:e},this._native.setAttribute("y",e),this._native.setAttribute("x",t)},getPosition:function(){return this._position},setHref:function(t){this._native.setAttributeNS(this.linkNamespace,"href",t),this._href=t},getHref:function(){return this._href}}),web2d.peer.svg.TimesFont=new Class({Extends:web2d.peer.svg.Font,initialize:function(){this.parent(),this._fontFamily="times"},getFontFamily:function(){return this._fontFamily},getFont:function(){return web2d.Font.TIMES}}),web2d.peer.svg.LinePeer=new Class({Extends:web2d.peer.svg.ElementPeer,initialize:function(){var t=window.document.createElementNS(this.svgNamespace,"line")
this.parent(t),this.attachChangeEventListener("strokeStyle",web2d.peer.svg.ElementPeer.prototype.updateStrokeStyle)},setFrom:function(t,e){this._x1=t,this._y1=e,this._native.setAttribute("x1",t),this._native.setAttribute("y1",e)},setTo:function(t,e){this._x2=t,this._y2=e,this._native.setAttribute("x2",t),this._native.setAttribute("y2",e)},getFrom:function(){return new core.Point(this._x1,this._y1)},getTo:function(){return new core.Point(this._x2,this._y2)},setArrowStyle:function(t,e){$defined(t),$defined(e)}}),web2d.peer.svg.TahomaFont=new Class({Extends:web2d.peer.svg.Font,initialize:function(){this.parent(),this._fontFamily="tahoma"},getFontFamily:function(){return this._fontFamily},getFont:function(){return web2d.Font.TAHOMA}}),web2d.peer.svg.VerdanaFont=new Class({Extends:web2d.peer.svg.Font,initialize:function(){this.parent(),this._fontFamily="verdana"},getFontFamily:function(){return this._fontFamily},getFont:function(){return web2d.Font.VERDANA}}),web2d.Element=new Class({initialize:function(t,e){if(this._peer=t,null==t)throw new Error("Element peer can not be null")
$defined(e)&&this._initialize(e)},_initialize:function(t){var e={}
for(var i in t){var n=this._attributeNameToFuncName(i,"set"),o=e[n]
$defined(o)||(o=[])
var s=web2d.Element._propertyNameToSignature[i],r=s[1]
r!=web2d.Element._SIGNATURE_MULTIPLE_ARGUMENTS?o[r]=t[i]:o=t[i].split(" "),e[n]=o}for(var i in e){var a=this[i]
if(!$defined(a))throw new Error("Could not find function: "+i)
a.apply(this,e[i])}},setSize:function(t,e){this._peer.setSize(t,e)},setPosition:function(t,e){this._peer.setPosition(t,e)},positionRelativeTo:function(t,e){this._peer.positionRelativeTo(t,e)},addEvent:function(t,e){this._peer.addEvent(t,e)},fireEvent:function(t,e){this._peer.fireEvent(t,e)},cloneEvents:function(t){this._peer.cloneEvents(t)},removeEvent:function(t,e){this._peer.removeEvent(t,e)},getType:function(){throw new Error("Not implemeneted yet. This method must be implemented by all the inherited objects.")},getFill:function(){return this._peer.getFill()},setFill:function(t,e){this._peer.setFill(t,e)},getPosition:function(){return this._peer.getPosition()},setStroke:function(t,e,i,n){if(null!=e&&void 0!=e&&"dash"!=e&&"dot"!=e&&"solid"!=e&&"longdash"!=e&&"dashdot"!=e)throw new Error("Unsupported stroke style: '"+e+"'")
this._peer.setStroke(t,e,i,n)},_attributeNameToFuncName:function(t,e){var i=web2d.Element._propertyNameToSignature[t]
if(!$defined(i))throw"Unsupported attribute: "+t
var n=i[0].charAt(0)
return e+n.toUpperCase()+i[0].substring(1)},setAttribute:function(t,e){var i=this._attributeNameToFuncName(t,"set"),n=web2d.Element._propertyNameToSignature[t]
if(null==n)throw"Could not find the signature for:"+t
var o=n[1],s=[]
if(o!==this._SIGNATURE_MULTIPLE_ARGUMENTS)s[o]=e
else if("array"==typeof e)s=e
else{var r=String(e)
s=r.split(" ")}var a=this[i]
if(null==a)throw"Could not find the function name:"+i
a.apply(this,s)},getAttribute:function(t){var e=this._attributeNameToFuncName(t,"get"),i=web2d.Element._propertyNameToSignature[t]
if(null==i)throw"Could not find the signature for:"+t
var n=this[e]
if(null==n)throw"Could not find the function name:"+e
var o=n.apply(this,[]),s=i[2]
if(!$defined(s))throw"Could not find attribute mapping for:"+t
var r=o[s]
if(!$defined(r))throw"Could not find attribute with name:"+s
return r},setOpacity:function(t){this._peer.setStroke(null,null,null,t),this._peer.setFill(null,t)},setVisibility:function(t){this._peer.setVisibility(t)},isVisible:function(){return this._peer.isVisible()},moveToFront:function(){this._peer.moveToFront()},moveToBack:function(){this._peer.moveToBack()},getStroke:function(){return this._peer.getStroke()},setCursor:function(t){this._peer.setCursor(t)},getParent:function(){return this._peer.getParent()}}),web2d.Element._SIGNATURE_MULTIPLE_ARGUMENTS=-1,web2d.Element._supportedEvents=["click","dblclick","mousemove","mouseout","mouseover","mousedown","mouseup"],web2d.Element._propertyNameToSignature={size:["size",-1],width:["size",0,"width"],height:["size",1,"height"],position:["position",-1],x:["position",0,"x"],y:["position",1,"y"],stroke:["stroke",-1],strokeWidth:["stroke",0,"width"],strokeStyle:["stroke",1,"style"],strokeColor:["stroke",2,"color"],strokeOpacity:["stroke",3,"opacity"],fill:["fill",-1],fillColor:["fill",0,"color"],fillOpacity:["fill",1,"opacity"],coordSize:["coordSize",-1],coordSizeWidth:["coordSize",0,"width"],coordSizeHeight:["coordSize",1,"height"],coordOrigin:["coordOrigin",-1],coordOriginX:["coordOrigin",0,"x"],coordOriginY:["coordOrigin",1,"y"],visibility:["visibility",0],opacity:["opacity",0]},web2d.Elipse=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createElipse(),i={width:40,height:40,x:5,y:5,stroke:"1 solid black",fillColor:"blue"}
for(var n in t)i[n]=t[n]
this.parent(e,i)},getType:function(){return"Elipse"},getSize:function(){return this._peer.getSize()}}),web2d.Font=new Class({initialize:function(fontFamily,textPeer){var font="web2d.peer.Toolkit.create"+fontFamily+"Font();"
this._peer=eval(font),this._textPeer=textPeer},getHtmlSize:function(){var t=web2d.peer.utils.TransformUtil.workoutScale(this._textPeer)
return this._peer.getHtmlSize(t)},getGraphSize:function(){var t=web2d.peer.utils.TransformUtil.workoutScale(this._textPeer)
return this._peer.getGraphSize(t)},getFontScale:function(){return web2d.peer.utils.TransformUtil.workoutScale(this._textPeer).height},getSize:function(){return this._peer.getSize()},getStyle:function(){return this._peer.getStyle()},getWeight:function(){return this._peer.getWeight()},getFontFamily:function(){return this._peer.getFontFamily()},setSize:function(t){return this._peer.setSize(t)},setStyle:function(t){return this._peer.setStyle(t)},setWeight:function(t){return this._peer.setWeight(t)},getFont:function(){return this._peer.getFont()},getWidthMargin:function(){return this._peer.getWidthMargin()}}),web2d.Font.ARIAL="Arial",web2d.Font.TIMES="Times",web2d.Font.TAHOMA="Tahoma",web2d.Font.VERDANA="Verdana",web2d.Group=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createGroup(),i={width:50,height:50,x:50,y:50,coordOrigin:"0 0",coordSize:"50 50"}
for(var n in t)i[n]=t[n]
this.parent(e,i)},removeChild:function(t){if(!$defined(t))throw"Child element can not be null"
if(t==this)throw"It's not possible to add the group as a child of itself"
var e=t.getType()
if(null==e)throw"It seems not to be an element ->"+t
this._peer.removeChild(t._peer)},appendChild:function(t){if(!$defined(t))throw"Child element can not be null"
if(t==this)throw"It's not posible to add the group as a child of itself"
var e=t.getType()
if(null==e)throw"It seems not to be an element ->"+t
if("Workspace"==e)throw"A group can not have a workspace as a child"
this._peer.appendChild(t._peer)},getType:function(){return"Group"},setCoordSize:function(t,e){this._peer.setCoordSize(t,e)},setCoordOrigin:function(t,e){this._peer.setCoordOrigin(t,e)},getCoordOrigin:function(){return this._peer.getCoordOrigin()},getSize:function(){return this._peer.getSize()},setFill:function(t,e){throw"Unsupported operation. Fill can not be set to a group"},setStroke:function(t,e,i,n){throw"Unsupported operation. Stroke can not be set to a group"},getCoordSize:function(){return this._peer.getCoordSize()},appendDomChild:function(t){if(!$defined(t))throw"Child element can not be null"
if(t==this)throw"It's not possible to add the group as a child of itself"
this._peer._native.appendChild(t)},setOpacity:function(t){this._peer.setOpacity(t)}}),web2d.Image=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createImage()
this.parent(e,t)},getType:function(){return"Image"},setHref:function(t){this._peer.setHref(t)},getHref:function(){return this._peer.getHref()},getSize:function(){return this._peer.getSize()}}),web2d.Line=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createLine(),i={strokeColor:"#495879",strokeWidth:1,strokeOpacity:1}
for(var n in t)i[n]=t[n]
this.parent(e,i)},getType:function(){return"Line"},setFrom:function(t,e){this._peer.setFrom(t,e)},setTo:function(t,e){this._peer.setTo(t,e)},getFrom:function(){return this._peer.getFrom()},getTo:function(){return this._peer.getTo()},setArrowStyle:function(t,e){this._peer.setArrowStyle(t,e)},setPosition:function(t,e){throw"Unsupported operation"},setSize:function(t,e){throw"Unsupported operation"},setFill:function(t,e){throw"Unsupported operation"}}),web2d.PolyLine=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createPolyLine(),i={strokeColor:"blue",strokeWidth:1,strokeStyle:"solid",strokeOpacity:1}
for(var n in t)i[n]=t[n]
this.parent(e,i)},getType:function(){return"PolyLine"},setFrom:function(t,e){this._peer.setFrom(t,e)},setTo:function(t,e){this._peer.setTo(t,e)},setStyle:function(t){this._peer.setStyle(t)},getStyle:function(){return this._peer.getStyle()},buildCurvedPath:function(t,e,i,n,o){var s=1,r=1
e>n&&(s=-1),i>o&&(r=-1)
var a
if(Math.abs(i-o)>2){var l=e+(n-e>0?t:-t)
a=e.toFixed(1)+", "+i.toFixed(1)+" "+l.toFixed(1)+", "+i.toFixed(1)+" "+l.toFixed(1)+", "+(o-5*r).toFixed(1)+" "+(l+5*s).toFixed(1)+", "+o.toFixed(1)+" "+n.toFixed(1)+", "+o.toFixed(1)}else a=e.toFixed(1)+", "+i.toFixed(1)+" "+n.toFixed(1)+", "+o.toFixed(1)
return a},buildStraightPath:function(t,e,i,n,o){var s=e+(n-e>0?t:-t)
return e+", "+i+" "+s+", "+i+" "+s+", "+o+" "+n+", "+o}}),web2d.CurvedLine=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createCurvedLine(),i={strokeColor:"blue",strokeWidth:1,strokeStyle:"solid",strokeOpacity:1}
for(var n in t)i[n]=t[n]
this.parent(e,i)},getType:function(){return"CurvedLine"},setFrom:function(t,e){$assert(!isNaN(t),"x must be defined"),$assert(!isNaN(e),"y must be defined"),this._peer.setFrom(t,e)},setTo:function(t,e){$assert(!isNaN(t),"x must be defined"),$assert(!isNaN(e),"y must be defined"),this._peer.setTo(t,e)},getFrom:function(){return this._peer.getFrom()},getTo:function(){return this._peer.getTo()},setShowEndArrow:function(t){this._peer.setShowEndArrow(t)},isShowEndArrow:function(){return this._peer.isShowEndArrow()},setShowStartArrow:function(t){this._peer.setShowStartArrow(t)},isShowStartArrow:function(){return this._peer.isShowStartArrow()},setSrcControlPoint:function(t){this._peer.setSrcControlPoint(t)},setDestControlPoint:function(t){this._peer.setDestControlPoint(t)},getControlPoints:function(){return this._peer.getControlPoints()},isSrcControlPointCustom:function(){return this._peer.isSrcControlPointCustom()},isDestControlPointCustom:function(){return this._peer.isDestControlPointCustom()},setIsSrcControlPointCustom:function(t){this._peer.setIsSrcControlPointCustom(t)},setIsDestControlPointCustom:function(t){this._peer.setIsDestControlPointCustom(t)},updateLine:function(t){return this._peer.updateLine(t)},setStyle:function(t){this._peer.setLineStyle(t)},getStyle:function(){return this._peer.getLineStyle()},setDashed:function(t,e){this._peer.setDashed(t,e)}}),web2d.CurvedLine.SIMPLE_LINE=!1,web2d.CurvedLine.NICE_LINE=!0,web2d.Arrow=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createArrow(),i={strokeColor:"black",strokeWidth:1,strokeStyle:"solid",strokeOpacity:1}
for(var n in t)i[n]=t[n]
this.parent(e,i)},getType:function(){return"Arrow"},setFrom:function(t,e){this._peer.setFrom(t,e)},setControlPoint:function(t){this._peer.setControlPoint(t)},setStrokeColor:function(t){this._peer.setStrokeColor(t)},setStrokeWidth:function(t){this._peer.setStrokeWidth(t)},setDashed:function(t,e,i){this._peer.setDashed(t,e,i)}}),web2d.Rect=new Class({Extends:web2d.Element,initialize:function(t,e){if(t&&t>1)throw"Arc must be 0<=arc<=1"
if(arguments.length<=0);var i=web2d.peer.Toolkit.createRect(t),n={width:40,height:40,x:5,y:5,stroke:"1 solid black",fillColor:"green"}
for(var o in e)n[o]=e[o]
this.parent(i,n)},getType:function(){return"Rect"},getSize:function(){return this._peer.getSize()}}),web2d.Text=new Class({Extends:web2d.Element,initialize:function(t){var e=web2d.peer.Toolkit.createText()
this.parent(e,t)},getType:function(){return"Text"},setText:function(t){this._peer.setText(t)},setTextAlignment:function(t){$assert(t,"align can not be null"),this._peer.setTextAlignment(t)},setTextSize:function(t,e){this._peer.setContentSize(t,e)},getText:function(){return this._peer.getText()},setFont:function(t,e,i,n){this._peer.setFont(t,e,i,n)},setColor:function(t){this._peer.setColor(t)},getColor:function(){return this._peer.getColor()},setStyle:function(t){this._peer.setStyle(t)},setWeight:function(t){this._peer.setWeight(t)},setFontFamily:function(t){this._peer.setFontFamily(t)},getFont:function(){return this._peer.getFont()},setSize:function(t){this._peer.setSize(t)},getHtmlFontSize:function(){return this._peer.getHtmlFontSize()},getWidth:function(){return this._peer.getWidth()},getHeight:function(){return parseInt(this._peer.getHeight())},getFontHeight:function(){var t=this._peer.getText().split("\n").length
return Math.round(this.getHeight()/t)}}),web2d.peer.ToolkitSVG={init:function(){},createWorkspace:function(t){return new web2d.peer.svg.WorkspacePeer(t)},createGroup:function(t){return new web2d.peer.svg.GroupPeer},createElipse:function(){return new web2d.peer.svg.ElipsePeer},createLine:function(){return new web2d.peer.svg.LinePeer},createPolyLine:function(){return new web2d.peer.svg.PolyLinePeer},createCurvedLine:function(){return new web2d.peer.svg.CurvedLinePeer},createArrow:function(){return new web2d.peer.svg.ArrowPeer},createText:function(){return new web2d.peer.svg.TextPeer},createImage:function(){return new web2d.peer.svg.ImagePeer},createRect:function(t){return new web2d.peer.svg.RectPeer(t)},createArialFont:function(){return new web2d.peer.svg.ArialFont},createTimesFont:function(){return new web2d.peer.svg.TimesFont},createVerdanaFont:function(){return new web2d.peer.svg.VerdanaFont},createTahomaFont:function(){return new web2d.peer.svg.TahomaFont}},web2d.peer.Toolkit=web2d.peer.ToolkitSVG,web2d.Workspace=new Class({Extends:web2d.Element,initialize:function(t){this._htmlContainer=this._createDivContainer()
var e=web2d.peer.Toolkit.createWorkspace(this._htmlContainer),i={width:"200px",height:"200px",stroke:"1px solid #edf1be",fillColor:"white",coordOrigin:"0 0",coordSize:"200 200"}
for(var n in t)i[n]=t[n]
this.parent(e,i),this._htmlContainer.appendChild(this._peer._native)},getType:function(){return"Workspace"},appendChild:function(t){if(!$defined(t))throw"Child element can not be null"
var e=t.getType()
if(null==e)throw"It seems not to be an element ->"+t
if("Workspace"==e)throw"A workspace can not have a workspace as a child"
this._peer.appendChild(t._peer)},addItAsChildTo:function(t){if(!$defined(t))throw"Workspace div container can not be null"
t.appendChild(this._htmlContainer)},_createDivContainer:function(t){var e=window.document.createElement("div")
return e.id="workspaceContainer",e.style.position="relative",e.style.top="0px",e.style.left="0px",e.style.height="688px",e.style.border="1px solid red",e},setSize:function(t,e){$defined(t)&&(this._htmlContainer.style.width=t),$defined(e)&&(this._htmlContainer.style.height=e),this._peer.setSize(t,e)},setCoordSize:function(t,e){this._peer.setCoordSize(t,e)},setCoordOrigin:function(t,e){this._peer.setCoordOrigin(t,e)},getCoordOrigin:function(){return this._peer.getCoordOrigin()},_getHtmlContainer:function(){return this._htmlContainer},setFill:function(t,e){if(this._htmlContainer.style.backgroundColor=t,e||0===e)throw"Unsupported operation. Opacity not supported."},getFill:function(){var t=this._htmlContainer.style.backgroundColor
return{color:t}},getSize:function(){var t=this._htmlContainer.style.width,e=this._htmlContainer.style.height
return{width:t,height:e}},setStroke:function(t,e,i,n){if("solid"!=e)throw"Not supported style stroke style:"+e
if(this._htmlContainer.style.border=t+" "+e+" "+i,n||0===n)throw"Unsupported operation. Opacity not supported."},getCoordSize:function(){return this._peer.getCoordSize()},removeChild:function(t){if(!$defined(t))throw"Child element can not be null"
if(t==this)throw"It's not possible to add the group as a child of itself"
var e=t.getType()
if(null==e)throw"It seems not to be an element ->"+t
this._peer.removeChild(t._peer)},dumpNativeChart:function(){var t=this._htmlContainer
return t.innerHTML}}),core.Point=new Class({initialize:function(t,e){this.x=t,this.y=e},setValue:function(t,e){this.x=t,this.y=e},inspect:function(){return"{x:"+this.x+",y:"+this.y+"}"},clone:function(){return new core.Point(this.x,this.y)}}),core.Point.fromString=function(t){var e=t.split(",")
return new core.Point(e[0],e[1])},mindplot.Messages=new Class({Static:{init:function(t){t=$defined(t)?t:"en"
var e=mindplot.Messages.BUNDLES[t]
null==e&&-1!=t.indexOf("_")&&(t=t.substring(0,t.indexOf("_")),e=mindplot.Messages.BUNDLES[t]),mindplot.Messages.__bundle=e}}}),$msg=function(t){mindplot.Messages.__bundle||mindplot.Messages.init("en")
var e=mindplot.Messages.__bundle[t]
return e?e:t},mindplot.Messages.BUNDLES={},mindplot.TopicEventDispatcher=new Class({Extends:Events,Static:{_instance:null,configure:function(t){this._instance=new mindplot.TopicEventDispatcher(t)},getInstance:function(){return this._instance}},initialize:function(t){this._readOnly=t,this._activeEditor=null,this._multilineEditor=new mindplot.MultilineTextEditor},close:function(t){this.isVisible()&&(this._activeEditor.close(t),this._activeEditor=null)},show:function(t,e){this.process(mindplot.TopicEvent.EDIT,t,e)},process:function(t,e,i){$assert(t,"eventType can not be null"),this.isVisible()&&this.close()
var n=e.getModel()
n.getShapeType()==mindplot.model.TopicShape.IMAGE||this._readOnly||t!=mindplot.TopicEvent.EDIT?this.fireEvent(t,{model:n,readOnly:this._readOnly}):(this._multilineEditor.show(e,i?i.text:null),this._activeEditor=this._multilineEditor)},isVisible:function(){return null!=this._activeEditor&&this._activeEditor.isVisible()}}),mindplot.TopicEvent={EDIT:"editnode",CLICK:"clicknode"},mindplot.model.IMindmap=new Class({initialize:function(){throw"Unsupported operation"},getCentralTopic:function(){return this.getBranches()[0]},getDescription:function(){throw"Unsupported operation"},setDescription:function(t){throw"Unsupported operation"},getId:function(){throw"Unsupported operation"},setId:function(t){throw"Unsupported operation"},getVersion:function(){throw"Unsupported operation"},setVersion:function(t){throw"Unsupported operation"},addBranch:function(t){throw"Unsupported operation"},getBranches:function(){throw"Unsupported operation"},removeBranch:function(t){throw"Unsupported operation"},getRelationships:function(){throw"Unsupported operation"},connect:function(t,e){$assert(!e.getParent(),"Child model seems to be already connected"),t.appendChild(e),this.removeBranch(e)},disconnect:function(t){var e=t.getParent()
$assert(t,"Child can not be null."),$assert(e,"Child model seems to be already connected"),e.removeChild(t),this.addBranch(t)},hasAlreadyAdded:function(t){throw"Unsupported operation"},createNode:function(t,e){throw"Unsupported operation"},createRelationship:function(t,e){throw"Unsupported operation"},addRelationship:function(t){throw"Unsupported operation"},deleteRelationship:function(t){throw"Unsupported operation"},inspect:function(){var t=""
t="{ "
var e=this.getBranches()
t=t+"version:"+this.getVersion(),t+=" , ["
for(var i=0;i<e.length;i++){var n=e[i]
0!=i&&(t+=",\n "),t=t+"("+i+") =>"+n.inspect()}return t+="]",t+=" } "},copyTo:function(t){var e=this,i=e.getVersion()
t.setVersion(i)
var n=this.getDescription()
t.setDescription(n)
var o=e.getBranches()
o.each(function(e){var i=t.createNode(e.getType(),e.getId())
e.copyTo(i),t.addBranch(i)})}}),mindplot.model.Mindmap=new Class({Extends:mindplot.model.IMindmap,initialize:function(t,e){$assert(t,"Id can not be null"),this._branches=[],this._description=null,this._relationships=[],this._version=$defined(e)?e:mindplot.persistence.ModelCodeName.TANGO,this._id=t},getDescription:function(){return this._description},setDescription:function(t){this._description=t},getId:function(){return this._id},setId:function(t){this._id=t},getVersion:function(){return this._version},setVersion:function(t){this._version=t},addBranch:function(t){$assert(t&&t.isNodeModel(),"Add node must be invoked with model objects")
var e=this.getBranches()
0==e.length?($assert(t.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE,"First element must be the central topic"),t.setPosition(0,0)):$assert(t.getType()!=mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE,"Mindmaps only have one cental topic"),this._branches.push(t)},removeBranch:function(t){return $assert(t&&t.isNodeModel(),"Remove node must be invoked with model objects"),this._branches.erase(t)},getBranches:function(){return this._branches},getRelationships:function(){return this._relationships},hasAlreadyAdded:function(t){for(var e=!1,i=this._branches,n=0;n<i.length&&!(e=i[n]._isChildNode(t));n++);},createNode:function(t,e){return t=$defined(t)?t:mindplot.model.INodeModel.MAIN_TOPIC_TYPE,new mindplot.model.NodeModel(t,this,e)},createRelationship:function(t,e){return $assert($defined(t),"from node cannot be null"),$assert($defined(e),"to node cannot be null"),new mindplot.model.RelationshipModel(t,e)},addRelationship:function(t){this._relationships.push(t)},deleteRelationship:function(t){this._relationships.erase(t)},findNodeById:function(t){for(var e=null,i=0;i<this._branches.length;i++){var n=this._branches[i]
if(e=n.findNodeById(t))break}return e}}),mindplot.model.Mindmap.buildEmpty=function(t){var e=new mindplot.model.Mindmap(t),i=e.createNode(mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE,0)
return i.setText(t),e.addBranch(i),e},mindplot.model.INodeModel=new Class({initialize:function(t){$assert(t&&t.getBranches,"mindmap can not be null"),this._mindmap=t},getId:function(){return this.getProperty("id")},setId:function(t){$defined(t)&&t>mindplot.model.INodeModel._uuid&&(mindplot.model.INodeModel._uuid=t),$defined(t)||(t=mindplot.model.INodeModel._nextUUID()),this.putProperty("id",t)},getType:function(){return this.getProperty("type")},setType:function(t){this.putProperty("type",t)},setText:function(t){this.putProperty("text",t)},getText:function(){return this.getProperty("text")},setPosition:function(t,e){$assert(!isNaN(parseInt(t)),"x position is not valid:"+t),$assert(!isNaN(parseInt(e)),"y position is not valid:"+e),this.putProperty("position","{x:"+parseInt(t)+",y:"+parseInt(e)+"}")},getPosition:function(){var value=this.getProperty("position"),result=null
return null!=value&&(result=eval("("+value+")")),result},setImageSize:function(t,e){this.putProperty("imageSize","{width:"+t+",height:"+e+"}")},getImageSize:function(){var value=this.getProperty("imageSize"),result=null
return null!=value&&(result=eval("("+value+")")),result},setImageUrl:function(t){this.putProperty("imageUrl",t)},getMetadata:function(){return this.getProperty("metadata")},setMetadata:function(t){this.putProperty("metadata",t)},getImageUrl:function(){return this.getProperty("imageUrl")},getMindmap:function(){return this._mindmap},disconnect:function(){var t=this.getMindmap()
t.disconnect(this)},getShapeType:function(){return this.getProperty("shapeType")},setShapeType:function(t){this.putProperty("shapeType",t)},setOrder:function(t){$assert("number"==typeof t&&isFinite(t)||null==t,"Order must be null or a number"),this.putProperty("order",t)},getOrder:function(){return this.getProperty("order")},setFontFamily:function(t){this.putProperty("fontFamily",t)},getFontFamily:function(){return this.getProperty("fontFamily")},setFontStyle:function(t){this.putProperty("fontStyle",t)},getFontStyle:function(){return this.getProperty("fontStyle")},setFontWeight:function(t){this.putProperty("fontWeight",t)},getFontWeight:function(){return this.getProperty("fontWeight")},setFontColor:function(t){this.putProperty("fontColor",t)},getFontColor:function(){return this.getProperty("fontColor")},setFontSize:function(t){this.putProperty("fontSize",t)},getFontSize:function(){return this.getProperty("fontSize")},getBorderColor:function(){return this.getProperty("borderColor")},setBorderColor:function(t){this.putProperty("borderColor",t)},getBackgroundColor:function(){return this.getProperty("backgroundColor")},setBackgroundColor:function(t){this.putProperty("backgroundColor",t)},areChildrenShrunken:function(){var t=this.getProperty("shrunken")
return $defined(t)?t:!1},setChildrenShrunken:function(t){this.putProperty("shrunken",t)},isNodeModel:function(){return!0},isConnected:function(){return null!=this.getParent()},appendChild:function(t){throw"Unsupported operation"},connectTo:function(t){$assert(t,"parent can not be null")
var e=this.getMindmap()
e.connect(t,this)},copyTo:function(t){var e=this,i=e.getPropertiesKeys()
i.each(function(i){var n=e.getProperty(i)
t.putProperty(i,n)})
var n=this.getChildren(),o=t.getMindmap()
return n.each(function(e){var i=o.createNode(e.getType(),e.getId())
e.copyTo(i),t.appendChild(i)}),t},deleteNode:function(){var t=this.getMindmap(),e=this.getParent()
$defined(e)?e.removeChild(this):t.removeBranch(this)},getPropertiesKeys:function(){throw"Unsupported operation"},putProperty:function(t,e){throw"Unsupported operation"},setParent:function(t){throw"Unsupported operation"},getChildren:function(){throw"Unsupported operation"},getParent:function(){throw"Unsupported operation"},clone:function(){throw"Unsupported operation"},inspect:function(){var t="{ type: "+this.getType()+" , id: "+this.getId()+" , text: "+this.getText(),e=this.getChildren()
return e.length>0&&(t=t+", children: {(size:"+e.length,e.each(function(e){t+="=> ("
var i=e.getPropertiesKeys()
i.each(function(i){var n=e.getProperty(i)
t=t+i+":"+n+","}),t+="}"}.bind(this))),t+=" }"},removeChild:function(t){throw"Unsupported operation"}}),mindplot.model.TopicShape={RECTANGLE:"rectagle",ROUNDED_RECT:"rounded rectagle",ELLIPSE:"elipse",LINE:"line",IMAGE:"image"},mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE="CentralTopic",mindplot.model.INodeModel.MAIN_TOPIC_TYPE="MainTopic",mindplot.model.INodeModel.MAIN_TOPIC_TO_MAIN_TOPIC_DISTANCE=220,mindplot.model.INodeModel._nextUUID=function(){return $defined(mindplot.model.INodeModel._uuid)||(mindplot.model.INodeModel._uuid=0),mindplot.model.INodeModel._uuid=mindplot.model.INodeModel._uuid+1,mindplot.model.INodeModel._uuid},mindplot.model.INodeModel._uuid=0,mindplot.model.NodeModel=new Class({Extends:mindplot.model.INodeModel,initialize:function(t,e,i){$assert(t,"Node type can not be null"),$assert(e,"mindmap can not be null"),this._properties={},this.parent(e),this.setId(i),this.setType(t),this.areChildrenShrunken(!1),this._children=[],this._feature=[]},createFeature:function(t,e){return mindplot.TopicFeature.createModel(t,e)},addFeature:function(t){$assert(t,"feature can not be null"),this._feature.push(t)},getFeatures:function(){return this._feature},removeFeature:function(t){$assert(t,"feature can not be null")
var e=this._feature.length
this._feature=this._feature.filter(function(e){return t.getId()!=e.getId()}),$assert(e-1==this._feature.length,"Could not be removed ...")},findFeatureByType:function(t){return $assert(t,"type can not be null"),this._feature.filter(function(e){return e.getType()==t})},findFeatureById:function(t){$assert($defined(t),"id can not be null")
var e=this._feature.filter(function(e){return e.getId()==t})
return $assert(1==e.length,"Feature could not be found:"+t),e[0]},getPropertiesKeys:function(){return Object.keys(this._properties)},putProperty:function(t,e){$defined(t,"key can not be null"),this._properties[t]=e},getProperties:function(){return this._properties},getProperty:function(t){$defined(t,"key can not be null")
var e=this._properties[t]
return $defined(e)?e:null},clone:function(){var t=new mindplot.model.NodeModel(this.getType(),this._mindmap)
return t._children=this._children.map(function(e){var i=e.clone()
return i._parent=t,i}),t._properties=Object.clone(this._properties),t._feature=this._feature.clone(),t},deepCopy:function(){var t=new mindplot.model.NodeModel(this.getType(),this._mindmap)
t._children=this._children.map(function(e){var i=e.deepCopy()
return i._parent=t,i})
var e=t.getId()
return t._properties=Object.clone(this._properties),t.setId(e),t._feature=this._feature.clone(),t},appendChild:function(t){$assert(t&&t.isNodeModel(),"Only NodeModel can be appended to Mindmap object"),this._children.push(t),t._parent=this},removeChild:function(t){$assert(t&&t.isNodeModel(),"Only NodeModel can be appended to Mindmap object."),this._children.erase(t),t._parent=null},getChildren:function(){return this._children},getParent:function(){return this._parent},setParent:function(t){$assert(t!=this,"The same node can not be parent and child if itself."),this._parent=t},_isChildNode:function(t){var e=!1
if(t==this)e=!0
else for(var i=this.getChildren(),n=0;n<i.length;n++){var o=i[n]
if(e=o._isChildNode(t))break}return e},findNodeById:function(t){var e=null
if(this.getId()==t)e=this
else for(var i=this.getChildren(),n=0;n<i.length;n++){var o=i[n]
if(e=o.findNodeById(t))break}return e}}),mindplot.model.RelationshipModel=new Class({Static:{_nextUUID:function(){return $defined(mindplot.model.RelationshipModel._uuid)||(mindplot.model.RelationshipModel._uuid=0),mindplot.model.RelationshipModel._uuid=mindplot.model.RelationshipModel._uuid+1,mindplot.model.RelationshipModel._uuid}},initialize:function(t,e){$assert($defined(t),"from node type can not be null"),$assert($defined(e),"to node type can not be null"),this._id=mindplot.model.RelationshipModel._nextUUID(),this._sourceTargetId=t,this._targetTopicId=e,this._lineType=mindplot.ConnectionLine.SIMPLE_CURVED,this._srcCtrlPoint=null,this._destCtrlPoint=null,this._endArrow=!0,this._startArrow=!1},getFromNode:function(){return this._sourceTargetId},getToNode:function(){return this._targetTopicId},getId:function(){return $assert(this._id,"id is null"),this._id},getLineType:function(){return this._lineType},setLineType:function(t){this._lineType=t},getSrcCtrlPoint:function(){return this._srcCtrlPoint},setSrcCtrlPoint:function(t){this._srcCtrlPoint=t},getDestCtrlPoint:function(){return this._destCtrlPoint},setDestCtrlPoint:function(t){this._destCtrlPoint=t},getEndArrow:function(){return this._endArrow},setEndArrow:function(t){this._endArrow=t},getStartArrow:function(){return this._startArrow},setStartArrow:function(t){this._startArrow=t},clone:function(){var t=new mindplot.model.RelationshipModel(this._sourceTargetId,this._targetTopicId)
return t._id=this._id,t._lineType=this._lineType,t._srcCtrlPoint=this._srcCtrlPoint,t._destCtrlPoint=this._destCtrlPoint,t._endArrow=this._endArrow,t._startArrow=this._startArrow,t},inspect:function(){return"(fromNode:"+this.getFromNode().getId()+" , toNode: "+this.getToNode().getId()+")"}}),mindplot.ActionDispatcher=new Class({Implements:[Events],initialize:function(t){$assert(t,"commandContext can not be null")},addRelationship:function(t,e){throw"method must be implemented."},addTopics:function(t,e){throw"method must be implemented."},deleteEntities:function(t,e){throw"method must be implemented."},dragTopic:function(t,e,i,n){throw"method must be implemented."},moveTopic:function(t,e){throw"method must be implemented."},moveControlPoint:function(t,e){throw"method must be implemented."},changeFontFamilyToTopic:function(t,e){throw"method must be implemented."},changeFontStyleToTopic:function(t){throw"method must be implemented."},changeFontColorToTopic:function(t,e){throw"method must be implemented."},changeFontSizeToTopic:function(t,e){throw"method must be implemented."},changeBackgroundColorToTopic:function(t,e){throw"method must be implemented."},changeBorderColorToTopic:function(t,e){throw"method must be implemented."},changeShapeTypeToTopic:function(t,e){throw"method must be implemented."},changeFontWeightToTopic:function(t){throw"method must be implemented."},changeTextToTopic:function(t,e){throw"method must be implemented."},shrinkBranch:function(t,e){throw"method must be implemented."},addFeatureToTopic:function(t,e,i){throw"method must be implemented."},changeFeatureToTopic:function(t,e,i){throw"method must be implemented."},removeFeatureFromTopic:function(t,e){throw"method must be implemented."}}),mindplot.ActionDispatcher.setInstance=function(t){mindplot.ActionDispatcher._instance=t},mindplot.ActionDispatcher.getInstance=function(){return mindplot.ActionDispatcher._instance},mindplot.StandaloneActionDispatcher=new Class({Extends:mindplot.ActionDispatcher,initialize:function(t){this.parent(t),this._actionRunner=new mindplot.DesignerActionRunner(t,this)},addTopics:function(t,e){var i=new mindplot.commands.AddTopicCommand(t,e)
this.execute(i)},addRelationship:function(t){var e=new mindplot.commands.AddRelationshipCommand(t)
this.execute(e)},deleteEntities:function(t,e){var i=new mindplot.commands.DeleteCommand(t,e)
this.execute(i)},dragTopic:function(t,e,i,n){var o=new mindplot.commands.DragTopicCommand(t,e,i,n)
this.execute(o)},moveTopic:function(t,e){$assert($defined(t),"topicsId can not be null"),$assert($defined(e),"position can not be null")
var i=function(t,e){var i=t.getPosition()
return mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeMoveEvent,{node:t.getModel(),position:e}),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
this.execute(n)},moveControlPoint:function(t,e){var i=new mindplot.commands.MoveControlPointCommand(t,e)
this.execute(i)},changeFontStyleToTopic:function(t){var e=function(t){var e=t.getFontStyle(),i="italic"==e?"normal":"italic"
return t.setFontStyle(i,!0),e},i=new mindplot.commands.GenericFunctionCommand(e,t)
this.execute(i)},changeTextToTopic:function(t,e){$assert($defined(t),"topicsIds can not be null")
var i=function(t,e){var i=t.getText()
return t.setText(e),i}
i.commandType="changeTextToTopic"
var n=new mindplot.commands.GenericFunctionCommand(i,t,e)
this.execute(n)},changeFontFamilyToTopic:function(t,e){$assert(t,"topicIds can not be null"),$assert(e,"fontFamily can not be null")
var i=function(t,e){var i=t.getFontFamily()
return t.setFontFamily(e,!0),t._adjustShapes(),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
this.execute(n)},changeFontColorToTopic:function(t,e){$assert(t,"topicIds can not be null"),$assert(e,"color can not be null")
var i=function(t,e){var i=t.getFontColor()
return t.setFontColor(e,!0),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
n.discardDuplicated="fontColorCommandId",this.execute(n)},changeBackgroundColorToTopic:function(t,e){$assert(t,"topicIds can not be null"),$assert(e,"color can not be null")
var i=function(t,e){var i=t.getBackgroundColor()
return t.setBackgroundColor(e),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
n.discardDuplicated="backColor",this.execute(n)},changeBorderColorToTopic:function(t,e){$assert(t,"topicIds can not be null"),$assert(e,"topicIds can not be null")
var i=function(t,e){var i=t.getBorderColor()
return t.setBorderColor(e),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
n.discardDuplicated="borderColorCommandId",this.execute(n)},changeFontSizeToTopic:function(t,e){$assert(t,"topicIds can not be null"),$assert(e,"size can not be null")
var i=function(t,e){var i=t.getFontSize()
return t.setFontSize(e,!0),t._adjustShapes(),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
this.execute(n)},changeShapeTypeToTopic:function(t,e){$assert(t,"topicsIds can not be null"),$assert(e,"shapeType can not be null")
var i=function(t,e){var i=t.getShapeType()
return t.setShapeType(e,!0),i},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
this.execute(n)},changeFontWeightToTopic:function(t){$assert(t,"topicsIds can not be null")
var e=function(t){var e=t.getFontWeight(),i="bold"==e?"normal":"bold"
return t.setFontWeight(i,!0),t._adjustShapes(),e},i=new mindplot.commands.GenericFunctionCommand(e,t)
this.execute(i)},shrinkBranch:function(t,e){$assert(t,"topicsIds can not be null")
var i=function(t,e){return t.setChildrenShrunken(e),!e},n=new mindplot.commands.GenericFunctionCommand(i,t,e)
this.execute(n,!1)},addFeatureToTopic:function(t,e,i){var n=new mindplot.commands.AddFeatureToTopicCommand(t,e,i)
this.execute(n)},changeFeatureToTopic:function(t,e,i){var n=new mindplot.commands.ChangeFeatureToTopicCommand(t,e,i)
this.execute(n)},removeFeatureFromTopic:function(t,e){var i=new mindplot.commands.RemoveFeatureFromTopicCommand(t,e)
this.execute(i)},execute:function(t){this._actionRunner.execute(t)}}),mindplot.CommandContext=new Class({initialize:function(t){$assert(t,"designer can not be null"),this._designer=t},findTopics:function(t){$assert($defined(t),"topicsIds can not be null"),t instanceof Array||(t=[t])
var e=this._designer.getModel().getTopics(),i=e.filter(function(e){return t.contains(e.getId())})
if(i.length!=t.length){var n=e.map(function(t){return t.getId()})
$assert(i.length==t.length,"Could not find topic. Result:"+i+", Filter Criteria:"+t+", Current Topics: ["+n+"]")}return i},deleteTopic:function(t){this._designer._removeTopic(t)},createTopic:function(t){return $assert(t,"model can not be null"),this._designer._nodeModelToNodeGraph(t)},createModel:function(){var t=this._designer.getMindmap()
return t.createNode(mindplot.NodeModel.MAIN_TOPIC_TYPE)},addTopic:function(t){var e=this._designer.getMindmap()
return e.addBranch(t.getModel())},connect:function(t,e){t.connectTo(e,this._designer._workspace)},disconnect:function(t){t.disconnect(this._designer._workspace)},addRelationship:function(t){return $assert(t,"model cannot be null"),this._designer._addRelationship(t)},deleteRelationship:function(t){this._designer._deleteRelationship(t)},findRelationships:function(t){$assert($defined(t),"relId can not be null"),t instanceof Array||(t=[t])
var e=this._designer.getModel().getRelationships()
return e.filter(function(e){return t.contains(e.getId())})},moveTopic:function(t,e){$assert(t,"topic cannot be null"),$assert(e,"position cannot be null"),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeMoveEvent,{node:t.getModel(),position:e})}}),mindplot.DesignerModel=new Class({Implements:[Events],initialize:function(t){this._zoom=t.zoom,this._topics=[],this._relationships=[]},getZoom:function(){return this._zoom},setZoom:function(t){this._zoom=t},getTopics:function(){return this._topics},getRelationships:function(){return this._relationships},getCentralTopic:function(){var t=this.getTopics()
return t[0]},filterSelectedTopics:function(){for(var t=[],e=0;e<this._topics.length;e++)this._topics[e].isOnFocus()&&t.push(this._topics[e])
return t},filterSelectedRelationships:function(){for(var t=[],e=0;e<this._relationships.length;e++)this._relationships[e].isOnFocus()&&t.push(this._relationships[e])
return t},getEntities:function(){var t=[].append(this._topics)
return t.append(this._relationships),t},removeTopic:function(t){$assert(t,"topic can not be null"),this._topics.erase(t)},removeRelationship:function(t){$assert(t,"rel can not be null"),this._relationships.erase(t)},addTopic:function(t){$assert(t,"topic can not be null"),$assert("number"==typeof t.getId(),"id is not a number:"+t.getId()),this._topics.push(t)},addRelationship:function(t){$assert(t,"rel can not be null"),this._relationships.push(t)},filterTopicsIds:function(t,e){for(var i=[],n=this.filterSelectedTopics(),o=!0,s=0;s<n.length;s++){var r=n[s]
$defined(t)&&(o=t(r)),o?i.push(r.getId()):$notify(e)}return i},selectedTopic:function(){var t=this.filterSelectedTopics()
return t.length>0?t[0]:null},findTopicById:function(t){for(var e=null,i=0;i<this._topics.length;i++){var n=this._topics[i]
if(n.getId()==t){e=n
break}}return e}}),mindplot.Designer=new Class({Extends:Events,initialize:function(t,e){$assert(t,"options must be defined"),$assert(t.zoom,"zoom must be defined"),$assert(e,"divElement must be defined"),mindplot.Messages.init(t.locale),this._options=t,e.setStyles(t.size)
var i=new mindplot.CommandContext(this)
this._actionDispatcher=new mindplot.StandaloneActionDispatcher(i),this._actionDispatcher.addEvent("modelUpdate",function(t){this.fireEvent("modelUpdate",t)}.bind(this)),mindplot.ActionDispatcher.setInstance(this._actionDispatcher),this._model=new mindplot.DesignerModel(t)
var n=new mindplot.ScreenManager(e)
this._workspace=new mindplot.Workspace(n,this._model.getZoom()),console.log("modelll ===="+this.getModel()),this._eventBussDispatcher=new mindplot.layout.EventBusDispatcher(this.getModel()),this.isReadOnly()||(this._registerMouseEvents(),mindplot.DesignerKeyboard.register(this),this._dragManager=this._buildDragManager(this._workspace)),this._registerWheelEvents(),this._relPivot=new mindplot.RelationshipPivot(this._workspace,this),this.setViewPort(t.viewPort),mindplot.TopicEventDispatcher.configure(this.isReadOnly()),this._clipboard=[]},destroy:function(){console.log("Destroy designer"),delete this._options,delete this._actionDispatcher,delete this._model,delete this._workspace,delete this._eventBussDispatcher,delete this._relPivot,delete this._clipboard,delete this._mindmap,mindplot.TopicEventDispatcher.getInstance()._multilineEditor.close(!1),console.log("Destroy designer END")},deactivateKeyboard:function(){mindplot.DesignerKeyboard.getInstance().deactivate(),this.deselectAll()},_registerWheelEvents:function(){var t=this._workspace,e=t.getScreenManager()
console.log($moo(document)),$moo(document).addEvent("mousewheel",function(t){var i=e.getContainer().getCoordinates(),n=t.client.y<i.top||t.client.y>i.bottom||t.client.x<i.left||t.client.x>i.right
n||(t.wheel>0?this.zoomIn(1.05):this.zoomOut(1.05),t.preventDefault())}.bind(this))},activateKeyboard:function(){mindplot.DesignerKeyboard.getInstance().activate()},addEvent:function(t,e){if(t==mindplot.TopicEvent.EDIT||t==mindplot.TopicEvent.CLICK){var i=mindplot.TopicEventDispatcher.getInstance()
i.addEvent(t,e)}else this.parent(t,e)},_registerMouseEvents:function(){var t=this._workspace,e=t.getScreenManager()
e.addEvent("update",function(){var t=this.getModel().getTopics()
t.each(function(t){t.closeEditors()}),this._cleanScreen&&this._cleanScreen()}.bind(this)),e.addEvent("click",function(t){this.onObjectFocusEvent(null,t)}.bind(this)),e.addEvent("dblclick",function(i){if(t.isWorkspaceEventsEnabled()){var n=e.getWorkspaceMousePosition(i),o=this.getModel().getCentralTopic(),s=this._createChildModel(o,n)
this._actionDispatcher.addTopics([s],[o.getId()])}}.bind(this))},_buildDragManager:function(t){var e=this.getModel(),i=new mindplot.DragConnector(e,this._workspace),n=new mindplot.DragManager(t,this._eventBussDispatcher),o=e.getTopics()
return n.addEvent("startdragging",function(){for(var t=0;t<o.length;t++)o[t].setMouseEventsEnabled(!1)}),n.addEvent("dragging",function(t,e){e.updateFreeLayout(t),e.isFreeLayoutOn(t)||(i.checkConnection(e),!e.isVisible()&&e.isConnected()&&e.setVisibility(!0))}),n.addEvent("enddragging",function(e,i){for(var n=0;n<o.length;n++)o[n].setMouseEventsEnabled(!0)
i.applyChanges(t)}),n},setViewPort:function(t){this._workspace.setViewPort(t)
var e=this.getModel()
this._workspace.setZoom(e.getZoom(),!0)},_buildNodeGraph:function(t,e){var i=mindplot.NodeGraph.create(t,{readOnly:e})
this.getModel().addTopic(i),e||(i.addEvent("mousedown",function(t){this.onObjectFocusEvent(i,t)}.bind(this)),i.getType()!=mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&this._dragManager.add(i))
var n=t.isConnected()
if(n){for(var o=t.getParent(),s=null,r=this.getModel().getTopics(),a=0;a<r.length;a++){var l=r[a]
if(l.getModel()==o){s=l,t.disconnect()
break}}$assert(s,"Could not find a topic to connect"),i.connectTo(s,this._workspace)}return i.addEvent("ontblur",function(){var t=this.getModel().filterSelectedTopics(),e=this.getModel().filterSelectedRelationships();(0==t.length||0==e.length)&&this.fireEvent("onblur")}.bind(this)),i.addEvent("ontfocus",function(){var t=this.getModel().filterSelectedTopics(),e=this.getModel().filterSelectedRelationships();(1==t.length||1==e.length)&&this.fireEvent("onfocus")}.bind(this)),i},onObjectFocusEvent:function(t,e){var i=this.getModel().getTopics()
i.each(function(t){t.closeEditors()})
var n=this.getModel(),o=n.getEntities()
o.each(function(i){$defined(e)&&(e.control||e.meta)||i.isOnFocus()&&i!=t&&i.setOnFocus(!1)})},selectAll:function(){var t=this.getModel(),e=t.getEntities()
e.each(function(t){t.setOnFocus(!0)})},deselectAll:function(){var t=this.getModel().getEntities()
t.each(function(t){t.setOnFocus(!1)})},setZoom:function(t){return t>1.9||.3>t?void $notify($msg("ZOOM_IN_ERROR")):(this.getModel().setZoom(t),void this._workspace.setZoom(t))},zoomOut:function(t){t||(t=1.2)
var e=this.getModel(),i=e.getZoom()*t
1.9>=i?(e.setZoom(i),this._workspace.setZoom(i)):$notify($msg("ZOOM_ERROR"))},zoomIn:function(t){t||(t=1.2)
var e=this.getModel(),i=e.getZoom()/t
i>=.3?(e.setZoom(i),this._workspace.setZoom(i)):$notify($msg("ZOOM_ERROR"))},copyToClipboard:function(){var t=this.getModel().filterSelectedTopics()
return t.length<=0?void $notify($msg("AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED")):(t=t.filter(function(t){return!t.isCentralTopic()}),this._clipboard=t.map(function(t){var e=t.getModel().deepCopy(),i=e.getPosition()
return e.setPosition(i.x+60*Math.sign(i.x),i.y+30),e}),void $notify($msg("SELECTION_COPIED_TO_CLIPBOARD")))},pasteClipboard:function(){return 0==this._clipboard.length?void $notify($msg("CLIPBOARD_IS_EMPTY")):(this._actionDispatcher.addTopics(this._clipboard),void(this._clipboard=[]))},getModel:function(){return this._model},shrinkSelectedBranch:function(){var t=this.getModel().filterSelectedTopics()
if(t.length<=0||1!=t.length)return void $notify($msg("ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE"))
var e=t[0]
e.getType()!=mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&this._actionDispatcher.shrinkBranch([e.getId()],!e.areChildrenShrunken())},createChildForSelectedNode:function(){var t=this.getModel().filterSelectedTopics()
if(t.length<=0)return void $notify($msg("ONE_TOPIC_MUST_BE_SELECTED"))
if(1!=t.length)return void $notify($msg("ONLY_ONE_TOPIC_MUST_BE_SELECTED"))
var e=t[0],i=e.getId(),n=this._createChildModel(e)
this._actionDispatcher.addTopics([n],[i])},_copyNodeProps:function(t,e){if(t.getType()!=mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE){var i=t.getFontSize()
i&&e.setFontSize(i)}var n=t.getFontFamily()
n&&e.setFontFamily(n)
var o=t.getFontColor()
o&&e.setFontColor(o)
var s=t.getFontWeight()
s&&e.setFontWeight(s)
var r=t.getFontStyle()
r&&e.setFontStyle(r)
var a=t.getShapeType()
a&&e.setShapeType(a)
var l=t.getBorderColor()
l&&e.setBorderColor(l)
var d=t.getBackgroundColor()
d&&e.setBackgroundColor(d)},_createChildModel:function(t,e){var i=t.getModel(),n=i.getMindmap(),o=n.createNode(),s=this._eventBussDispatcher.getLayoutManager(),r=s.predict(t.getId(),null,e)
o.setOrder(r.order)
var a=r.position
return o.setPosition(a.x,a.y),this._copyNodeProps(i,o),o},addDraggedNode:function(t,e){$assert(t,"event can not be null"),$assert(e,"model can not be null"),e.setPosition(1e3,1e3),this._actionDispatcher.addTopics([e])
var i=this.getModel().findTopicById(e.getId())
i.fireEvent("mousedown",t)},createSiblingForSelectedNode:function(){var t=this.getModel().filterSelectedTopics()
if(t.length<=0)return void $notify($msg("ONE_TOPIC_MUST_BE_SELECTED"))
if(t.length>1)return void $notify($msg("ONLY_ONE_TOPIC_MUST_BE_SELECTED"))
var e=t[0]
if(e.getOutgoingConnectedTopic()){var i=e.getOutgoingConnectedTopic(),n=this._createSiblingModel(e)
i.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&n.setOrder(e.getOrder()+2)
var o=i.getId()
this._actionDispatcher.addTopics([n],[o])}else this.createChildForSelectedNode()},_createSiblingModel:function(t){var e=null,i=t.getOutgoingConnectedTopic()
if(null!=i){var n=t.getModel(),o=n.getMindmap()
e=o.createNode()
var s=t.getOrder()+1
e.setOrder(s),e.setPosition(10,10)}return this._copyNodeProps(n,e),e},showRelPivot:function(t){var e=this.getModel().filterSelectedTopics()
if(e.length<=0)return void $notify($msg("RELATIONSHIP_COULD_NOT_BE_CREATED"))
var i=this._workspace.getScreenManager(),n=i.getWorkspaceMousePosition(t)
this._relPivot.start(e[0],n)},getMindmapProperties:function(){return{zoom:this.getModel().getZoom()}},loadMap:function(t){$assert(t,"mindmapModel can not be null"),console.log(t),this._mindmap=t
var e={width:25,height:25},i=new mindplot.layout.LayoutManager(t.getCentralTopic().getId(),e)
i.addEvent("change",function(t){var e=t.getId(),i=this.getModel().findTopicById(e)
i.setPosition(t.getPosition()),i.setOrder(t.getOrder())}.bind(this)),this._eventBussDispatcher.setLayoutManager(i)
for(var n=t.getBranches(),o=0;o<n.length;o++){var s=n[o]
console.log("r=..."),console.log(s)
var r=this._nodeModelToNodeGraph(s)
r.setBranchVisibility(!0)}for(var a=t.getRelationships(),l=0;l<a.length;l++)this._relationshipModelToRelationship(a[l])
var d=this.getModel().getCentralTopic()
this.goToNode(d),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.DoLayout),this.fireEvent("loadSuccess")},getMindmap:function(){return this._mindmap},undo:function(){this._actionDispatcher._actionRunner.undo()},redo:function(){this._actionDispatcher._actionRunner.redo()},isReadOnly:function(){return this._options.readOnly},_nodeModelToNodeGraph:function(t){$assert(t,"Node model can not be null")
var e=t.getChildren().slice()
e=e.sort(function(t,e){return t.getOrder()-e.getOrder()})
var i=this._buildNodeGraph(t,this.isReadOnly())
i.setVisibility(!1),this._workspace.appendChild(i)
for(var n=0;n<e.length;n++){var o=e[n]
$defined(o)&&this._nodeModelToNodeGraph(o)}return i},_relationshipModelToRelationship:function(t){$assert(t,"Node model can not be null")
var e=this._buildRelationshipShape(t),i=e.getSourceTopic()
i.addRelationship(e)
var n=e.getTargetTopic()
return n.addRelationship(e),e.setVisibility(i.isVisible()&&n.isVisible()),this._workspace.appendChild(e),e},_addRelationship:function(t){var e=this.getMindmap()
return e.addRelationship(t),this._relationshipModelToRelationship(t)},_deleteRelationship:function(t){var e=t.getSourceTopic()
e.deleteRelationship(t)
var i=t.getTargetTopic()
i.deleteRelationship(t),this.getModel().removeRelationship(t),this._workspace.removeChild(t)
var n=this.getMindmap()
n.deleteRelationship(t.getModel())},_buildRelationshipShape:function(t){var e=this.getModel(),i=t.getFromNode(),n=e.findTopicById(i),o=t.getToNode(),s=e.findTopicById(o)
$assert(s,"targetTopic could not be found:"+o+e.getTopics().map(function(t){return t.getId()}))
var r=new mindplot.Relationship(n,s,t)
return r.addEvent("ontblur",function(){var t=this.getModel().filterSelectedTopics(),e=this.getModel().filterSelectedRelationships();(0==t.length||0==e.length)&&this.fireEvent("onblur")}.bind(this)),r.addEvent("ontfocus",function(){var t=this.getModel().filterSelectedTopics(),e=this.getModel().filterSelectedRelationships();(1==t.length||1==e.length)&&this.fireEvent("onfocus")}.bind(this)),e.addRelationship(r),r},_removeTopic:function(t){if(!t.isCentralTopic()){var e=t._parent
for(t.disconnect(this._workspace);t.getChildren().length>0;)this._removeTopic(t.getChildren()[0])
this._workspace.removeChild(t),this.getModel().removeTopic(t)
var i=t.getModel()
i.deleteNode(),$defined(e)&&this.goToNode(e)}},_resetEdition:function(){var t=this._workspace.getScreenManager()
t.fireEvent("update"),t.fireEvent("mouseup"),this._relPivot.dispose()},deleteSelectedEntities:function(){this._resetEdition()
var t=this.getModel().filterSelectedTopics(),e=this.getModel().filterSelectedRelationships()
if(t.length<=0&&e.length<=0)return void $notify($msg("ENTITIES_COULD_NOT_BE_DELETED"))
if(1==t.length&&t[0].isCentralTopic())return void $notify($msg("CENTRAL_TOPIC_CAN_NOT_BE_DELETED"))
var i=t.filter(function(t){return!t.isCentralTopic()}).map(function(t){return t.getId()}),n=e.map(function(t){return t.getId()});(i.length>0||n.length>0)&&this._actionDispatcher.deleteEntities(i,n)},changeFontFamily:function(t){var e=this.getModel().filterTopicsIds()
e.length>0&&this._actionDispatcher.changeFontFamilyToTopic(e,t)},changeFontStyle:function(){var t=this.getModel().filterTopicsIds()
t.length>0&&this._actionDispatcher.changeFontStyleToTopic(t)},changeFontColor:function(t){$assert(t,"color can not be null")
var e=this.getModel().filterTopicsIds()
e.length>0&&this._actionDispatcher.changeFontColorToTopic(e,t)},changeBackgroundColor:function(t){var e=function(t){return t.getShapeType()!=mindplot.model.TopicShape.LINE},i="Color can not be set to line topics.",n=this.getModel().filterTopicsIds(e,i)
n.length>0&&this._actionDispatcher.changeBackgroundColorToTopic(n,t)},changeBorderColor:function(t){var e=function(t){return t.getShapeType()!=mindplot.model.TopicShape.LINE},i="Color can not be set to line topics.",n=this.getModel().filterTopicsIds(e,i)
n.length>0&&this._actionDispatcher.changeBorderColorToTopic(n,t)},changeFontSize:function(t){var e=this.getModel().filterTopicsIds()
e.length>0&&this._actionDispatcher.changeFontSizeToTopic(e,t)},changeTopicShape:function(t){var e=function(e){return!(e.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&t==mindplot.model.TopicShape.LINE)},i="Central Topic shape can not be changed to line figure.",n=this.getModel().filterTopicsIds(e,i)
n.length>0&&this._actionDispatcher.changeShapeTypeToTopic(n,t)},changeFontWeight:function(){var t=this.getModel().filterTopicsIds()
t.length>0&&this._actionDispatcher.changeFontWeightToTopic(t)},addIconType:function(t){var e=this.getModel().filterTopicsIds()
e.length>0&&this._actionDispatcher.addFeatureToTopic(e[0],mindplot.TopicFeature.Icon.id,{id:t})},addLink:function(){var t=this.getModel(),e=t.selectedTopic()
e&&e.showLinkEditor()},addNote:function(){var t=this.getModel(),e=t.selectedTopic()
e&&e.showNoteEditor()},goToNode:function(t){t.setOnFocus(!0),this.onObjectFocusEvent(t)},getWorkSpace:function(){return this._workspace}}),mindplot.ScreenManager=new Class({initialize:function(t){$assert(t,"can not be null"),this._divContainer=t,this._padding={x:0,y:0},this._clickEvents=[],this._divContainer.addEvent("click",function(t){t.stopPropagation()}.bind(this)),this._divContainer.addEvent("dblclick",function(t){t.stopPropagation(),t.preventDefault()})},setScale:function(t){$assert(t,"Screen scale can not be null"),this._scale=t},addEvent:function(t,e){"click"==t?this._clickEvents.push(e):this._divContainer.addEvent(t,e)},removeEvent:function(t,e){"click"==t?this._clickEvents.remove(e):this._divContainer.removeEvent(t,e)},fireEvent:function(t,e){"click"==t?this._clickEvents.each(function(i){i(t,e)}):this._divContainer.fireEvent(t,e)},_getElementPosition:function(t){var e=t.getPosition(),i=e.x,n=e.y
return i-=this._padding.x,n-=this._padding.y,i/=this._scale,n/=this._scale,{x:i,y:n}},getWorkspaceIconPosition:function(t){var e=t.getImage(),i=e.getPosition(),n=t.getSize(),o=t.getGroup(),s=o.getNativeElement(),r=s.getCoordOrigin(),a=s.getSize(),l=s.getCoordSize(),d={x:l.width/parseInt(a.width),y:l.height/parseInt(a.height)},c=(i.x-r.x-parseInt(n.width)/2)/d.x,h=(i.y-r.y-parseInt(n.height)/2)/d.y,u=o.getPosition()
c+=u.x,h+=u.y
var p=o.getTopic(),g=this._getElementPosition(p)
return g.x=g.x-parseInt(p.getSize().width)/2,{x:c+g.x,y:h+g.y}},getWorkspaceMousePosition:function(t){var e=t.client.x,i=t.client.y,n=this.getContainer().getPosition()
return e-=n.x,i-=n.y,e*=this._scale,i*=this._scale,e+=this._padding.x,i+=this._padding.y,new core.Point(e,i)},getContainer:function(){return this._divContainer},setOffset:function(t,e){this._padding.x=t,this._padding.y=e}}),mindplot.Workspace=new Class({initialize:function(t,e){$assert(t,"Div container can not be null"),$assert(e,"zoom container can not be null"),this._zoom=e,this._screenManager=t
var i=t.getContainer()
this._screenWidth=parseInt(i.getStyle("width")),this._screenHeight=parseInt(i.getStyle("height"))
var n=this._createWorkspace()
this._workspace=n,n.addItAsChildTo(i),this.setZoom(e,!0),this._registerDragEvents(),this._eventsEnabled=!0},_createWorkspace:function(){var t=-(this._screenWidth/2),e=-(this._screenHeight/2),i={width:this._screenWidth+"px",height:this._screenHeight+"px",coordSizeWidth:this._screenWidth,coordSizeHeight:this._screenHeight,coordOriginX:t,coordOriginY:e,fillColor:"transparent",strokeWidth:0}
return web2d.peer.Toolkit.init(),new web2d.Workspace(i)},appendChild:function(t){$defined(t.addToWorkspace)?t.addToWorkspace(this):this._workspace.appendChild(t)},removeChild:function(t){$defined(t.removeFromWorkspace)?t.removeFromWorkspace(this):this._workspace.removeChild(t)},addEvent:function(t,e){this._workspace.addEvent(t,e)},removeEvent:function(t,e){$assert(t,"type can not be null"),$assert(e,"listener can not be null"),this._workspace.removeEvent(t,e)},getSize:function(){return this._workspace.getCoordSize()},setZoom:function(t,e){this._zoom=t
var i=this._workspace,n=t*this._screenWidth,o=t*this._screenHeight
i.setCoordSize(n,o),this._viewPort&&(this._viewPort.width=this._viewPort.width*t,this._viewPort.height=this._viewPort.height*t)
var s,r
if(e)this._viewPort?(s=-(this._viewPort.width/2),r=-(this._viewPort.height/2)):(s=-(n/2),r=-(o/2))
else{var a=i.getCoordOrigin()
s=a.x,r=a.y}i.setCoordOrigin(s,r),this._screenManager.setOffset(s,r),this._screenManager.setScale(t),this._screenManager.fireEvent("update")},getScreenManager:function(){return this._screenManager},enableWorkspaceEvents:function(t){this._eventsEnabled=t},isWorkspaceEventsEnabled:function(){return this._eventsEnabled},dumpNativeChart:function(){return this._workspace.dumpNativeChart()},_registerDragEvents:function(){var t=this._workspace,e=this._screenManager,i=this,n=function(n){if($defined(t._mouseMoveListener))t._mouseUpListener()
else if(i.isWorkspaceEventsEnabled()){i.enableWorkspaceEvents(!1)
var o=e.getWorkspaceMousePosition(n),s=t.getCoordOrigin(),r=!1
t._mouseMoveListener=function(i){var n=e.getWorkspaceMousePosition(i),a=n.x-o.x,l=-a+s.x,d=n.y-o.y,c=-d+s.y
t.setCoordOrigin(l,c),window.document.body.style.cursor=Browser.firefox?"-moz-grabbing":"move",i.preventDefault(),e.fireEvent("update"),r=!0}.bind(this),e.addEvent("mousemove",t._mouseMoveListener),t._mouseUpListener=function(n){e.removeEvent("mousemove",t._mouseMoveListener),e.removeEvent("mouseup",t._mouseUpListener),t._mouseUpListener=null,t._mouseMoveListener=null,window.document.body.style.cursor="default"
var o=t.getCoordOrigin()
e.setOffset(o.x,o.y),i.enableWorkspaceEvents(!0),r||e.fireEvent("click")},e.addEvent("mouseup",t._mouseUpListener)}}
e.addEvent("mousedown",n)},setViewPort:function(t){this._viewPort=t}}),mindplot.ShirinkConnector=new Class({initialize:function(t){var e=new web2d.Elipse(mindplot.Topic.prototype.INNER_RECT_ATTRIBUTES)
this._ellipse=e,e.setFill("rgb(62,118,179)"),e.setSize(mindplot.Topic.CONNECTOR_WIDTH,mindplot.Topic.CONNECTOR_WIDTH),e.addEvent("click",function(e){var i=t.getModel(),n=!i.areChildrenShrunken(),o=t.getId(),s=mindplot.ActionDispatcher.getInstance()
s.shrinkBranch([o],n),e.stopPropagation()}),e.addEvent("mousedown",function(t){t.stopPropagation()}),e.addEvent("dblclick",function(t){t.stopPropagation()}),e.addEvent("mouseover",function(t){e.setFill("rgb(153, 0, 255)")}),e.addEvent("mouseout",function(e){var i=t.getBackgroundColor()
this.setFill(i)}.bind(this)),e.setCursor("default"),this._fillColor="#f7f7f7"
var i=t.getModel()
this.changeRender(i.areChildrenShrunken())},changeRender:function(t){var e=this._ellipse
t?e.setStroke("2","solid"):e.setStroke("1","solid")},setVisibility:function(t){this._ellipse.setVisibility(t)},setOpacity:function(t){this._ellipse.setOpacity(t)},setFill:function(t){this._fillColor=t,this._ellipse.setFill(t)},setAttribute:function(t,e){this._ellipse.setAttribute(t,e)},addToWorkspace:function(t){t.appendChild(this._ellipse)},setPosition:function(t,e){this._ellipse.setPosition(t,e)},moveToBack:function(){this._ellipse.moveToBack()},moveToFront:function(){this._ellipse.moveToFront()}}),mindplot.DesignerKeyboard=new Class({Extends:Keyboard,Static:{register:function(t){this._instance=new mindplot.DesignerKeyboard(t),this._instance.activate()},getInstance:function(){return this._instance}},initialize:function(t){$assert(t,"designer can not be null"),this.parent({defaultEventType:"keydown"}),this._registerEvents(t)},_registerEvents:function(t){var e=t.getModel(),i={backspace:function(e){e.preventDefault(),e.stopPropagation(),t.deleteSelectedEntities()}.bind(this),space:function(){t.shrinkSelectedBranch()}.bind(this),f2:function(){var t=e.selectedTopic()
t&&t.showTextEditor()}.bind(this),"delete":function(e){t.deleteSelectedEntities(),e.preventDefault(),e.stopPropagation()}.bind(this),enter:function(){t.createSiblingForSelectedNode()}.bind(this),insert:function(e){t.createChildForSelectedNode(),e.preventDefault(),e.stopPropagation()}.bind(this),tab:function(e){t.createChildForSelectedNode(),e.preventDefault(),e.stopPropagation()}.bind(this),"-":function(){t.createChildForSelectedNode()}.bind(this),"meta+enter":function(e){e.preventDefault(),e.stopPropagation(),t.createChildForSelectedNode()}.bind(this),"ctrl+z":function(e){e.preventDefault(e),e.stopPropagation(),t.undo()}.bind(this),"meta+z":function(e){e.preventDefault(),e.stopPropagation(),t.undo()}.bind(this),"ctrl+c":function(e){e.preventDefault(e),e.stopPropagation(),t.copyToClipboard()}.bind(this),"meta+c":function(e){e.preventDefault(),e.stopPropagation(),t.copyToClipboard()}.bind(this),"ctrl+v":function(e){e.preventDefault(e),e.stopPropagation(),t.pasteClipboard()}.bind(this),"meta+v":function(e){e.preventDefault(),e.stopPropagation(),t.pasteClipboard()}.bind(this),"ctrl+z+shift":function(e){e.preventDefault(),e.stopPropagation(),t.redo()}.bind(this),"meta+z+shift":function(e){e.preventDefault(),e.stopPropagation(),t.redo()}.bind(this),"ctrl+y":function(e){e.preventDefault(),e.stopPropagation(),t.redo()}.bind(this),"meta+y":function(e){e.preventDefault(),e.stopPropagation(),t.redo()}.bind(this),"ctrl+a":function(e){e.preventDefault(),e.stopPropagation(),t.selectAll()},"ctrl+b":function(e){e.preventDefault(),e.stopPropagation(),t.changeFontWeight()},"meta+b":function(e){e.preventDefault(),e.stopPropagation(),t.changeFontWeight()},"ctrl+s":function(t){t.preventDefault(),t.stopPropagation(),$moo("save").fireEvent("click")},"meta+s":function(t){t.preventDefault(),t.stopPropagation(),$moo("save").fireEvent("click")},"ctrl+i":function(e){e.preventDefault(),e.stopPropagation(),t.changeFontStyle()},"meta+i":function(e){e.preventDefault(),e.stopPropagation(),t.changeFontStyle()},"meta+shift+a":function(e){e.preventDefault(),e.stopPropagation(),t.deselectAll()},"ctrl+shift+a":function(e){e.preventDefault(),e.stopPropagation(),t.deselectAll()},"meta+a":function(e){e.preventDefault(),e.stopPropagation(),t.selectAll()},"meta+=":function(e){e.preventDefault(),e.stopPropagation(),t.zoomIn()},"meta+-":function(e){e.preventDefault(),e.stopPropagation(),t.zoomOut()},"ctrl+=":function(e){e.preventDefault(),e.stopPropagation(),t.zoomIn()},"ctrl+-":function(e){e.preventDefault(),e.stopPropagation(),t.zoomOut()},right:function(i){var n=e.selectedTopic()
if(n)n.isCentralTopic()?this._goToSideChild(t,n,"RIGHT"):n.getPosition().x<0?this._goToParent(t,n):n.areChildrenShrunken()||this._goToChild(t,n)
else{var o=e.getCentralTopic()
this._goToNode(t,o)}i.preventDefault(),i.stopPropagation()}.bind(this),left:function(i){var n=e.selectedTopic()
if(n)n.isCentralTopic()?this._goToSideChild(t,n,"LEFT"):n.getPosition().x>0?this._goToParent(t,n):n.areChildrenShrunken()||this._goToChild(t,n)
else{var o=e.getCentralTopic()
this._goToNode(t,o)}i.preventDefault(),i.stopPropagation()}.bind(this),up:function(i){var n=e.selectedTopic()
if(n)n.isCentralTopic()||this._goToBrother(t,n,"UP")
else{var o=e.getCentralTopic()
this._goToNode(t,o)}i.preventDefault(),i.stopPropagation()}.bind(this),down:function(i){var n=e.selectedTopic()
if(n)n.isCentralTopic()||this._goToBrother(t,n,"DOWN")
else{var o=e.getCentralTopic()
this._goToNode(t,o)}i.preventDefault(),i.stopPropagation()}.bind(this)}
this.addEvents(i)
var n=/^(?:shift|control|ctrl|alt|meta)$/,o=["shift","control","alt","meta"],s=["esc","capslock","tab","f1","f3","f4","f5","f6","f7","f8","f9","f10","f11","f12","backspace","down","up","left","right","control"]
Browser.Platform.mac||s.push("alt"),$moo(document).addEvent("keydown",function(e){var r=[]
o.each(function(t){e[t]&&r.push(t)}),n.test(e.key)||r.push(e.key)
var a=r.join("+"),l=!1
for(var d in i)if(d==a){l=!0
break}if(!(l||s.contains(a)||s.contains(e.key)||e.meta||e.control)){var c=t.getModel().filterSelectedTopics()
if(c.length>0){var h=e.key
o.contains(e.key)&&(h=""),c[0].showTextEditor(h),e.stopPropagation()}}})},_goToBrother:function(t,e,i){var n=e.getParent()
if(n){for(var o=n.getChildren(),s=e,r=e.getPosition().y,a=e.getPosition().x,l=null,d=0;d<o.length;d++){var c=a*o[d].getPosition().x>=0
if(o[d]!=e&&c){var h=o[d],u=h.getPosition().y
if("DOWN"==i&&u>r){var p=r-u
0>p&&(p=-1*p),(null==l||l>p)&&(l=p,s=o[d])}else if("UP"==i&&r>u){var g=r-u
0>g&&(g=-1*g),(null==l||l>g)&&(l=g,s=o[d])}}}this._goToNode(t,s)}},_goToSideChild:function(t,e,i){var n=e.getChildren()
if(n.length>0){for(var o=n[0],s=null,r=0;r<n.length;r++){var a=n[r],l=a.getPosition().y
"LEFT"==i&&a.getPosition().x<0&&(null==s||s>l)&&(o=a,s=l),"RIGHT"==i&&a.getPosition().x>0&&(null==s||s>l)&&(o=a,s=l)}this._goToNode(t,o)}},_goToParent:function(t,e){var i=e.getParent()
i&&this._goToNode(t,i)},_goToChild:function(t,e){var i=e.getChildren()
if(i.length>0){for(var n=i[0],o=n.getPosition().y,s=0;s<i.length;s++){var r=i[s]
r.getPosition().y<o&&(o=r.getPosition().y,n=r)}this._goToNode(t,n)}},_goToNode:function(t,e){t.deselectAll(),e.setOnFocus(!0)}}),mindplot.TopicStyle=new Class({Static:{_getStyles:function(t){$assert(t,"topic can not be null")
var e
if(t.isCentralTopic())e=mindplot.TopicStyle.STYLES.CENTRAL_TOPIC
else{var i=t.getOutgoingConnectedTopic()
e=$defined(i)?i.isCentralTopic()?mindplot.TopicStyle.STYLES.MAIN_TOPIC:mindplot.TopicStyle.STYLES.SUB_TOPIC:mindplot.TopicStyle.STYLES.ISOLATED_TOPIC}return e},defaultText:function(t){var e=this._getStyles(t).msgKey
return $msg(e)},defaultFontStyle:function(t){return this._getStyles(t).fontStyle},defaultBackgroundColor:function(t){return this._getStyles(t).backgroundColor},defaultBorderColor:function(t){return this._getStyles(t).borderColor},getInnerPadding:function(t){return this._getStyles(t).innerPadding},defaultShapeType:function(t){return this._getStyles(t).shapeType}}}),mindplot.TopicStyle.STYLES={CENTRAL_TOPIC:{borderColor:"rgb(57,113,177)",backgroundColor:"rgb(80,157,192)",fontStyle:{font:"Verdana",size:10,style:"normal",weight:"bold",color:"#ffffff"},msgKey:"CENTRAL_TOPIC",innerPadding:11,shapeType:mindplot.model.TopicShape.ROUNDED_RECT},MAIN_TOPIC:{borderColor:"rgb(2,59,185)",backgroundColor:"rgb(224,229,239)",fontStyle:{font:"Arial",size:8,style:"normal",weight:"normal",color:"rgb(82,92,97)"},msgKey:"MAIN_TOPIC",innerPadding:3,shapeType:mindplot.model.TopicShape.LINE},SUB_TOPIC:{borderColor:"rgb(2,59,185)",backgroundColor:"rgb(224,229,239)",fontStyle:{font:"Arial",size:6,style:"normal",weight:"normal",color:"rgb(82,92,97)"},msgKey:"SUB_TOPIC",innerPadding:3,shapeType:mindplot.model.TopicShape.LINE},ISOLATED_TOPIC:{borderColor:"rgb(2,59,185)",backgroundColor:"rgb(224,229,239)",fontStyle:{font:"Verdana",size:8,style:"normal",weight:"normal",color:"rgb(82,92,97)"},msgKey:"ISOLATED_TOPIC",innerPadding:4,shapeType:mindplot.model.TopicShape.LINE}},mindplot.NodeGraph=new Class({initialize:function(t,e){$assert(t,"model can not be null"),this._options=e,this._mouseEvents=!0,this.setModel(t),this._onFocus=!1,this._event=new Events,this._size={width:50,height:20}},isReadOnly:function(){return this._options.readOnly},getType:function(){var t=this.getModel()
return t.getType()},setId:function(t){$assert("number"==typeof topic.getId(),"id is not a number:"+t),this.getModel().setId(t)},_set2DElement:function(t){this._elem2d=t},get2DElement:function(){return $assert(this._elem2d,"NodeGraph has not been initialized properly"),this._elem2d},setPosition:function(t,e){throw"Unsupported operation"},addEvent:function(t,e){var i=this.get2DElement()
i.addEvent(t,e)},removeEvent:function(t,e){var i=this.get2DElement()
i.removeEvent(t,e)},fireEvent:function(t,e){var i=this.get2DElement()
i.fireEvent(t,e)},setMouseEventsEnabled:function(t){this._mouseEvents=t},isMouseEventsEnabled:function(){return this._mouseEvents},getSize:function(){return this._size},setSize:function(t){this._size.width=parseInt(t.width),this._size.height=parseInt(t.height)},getModel:function(){return $assert(this._model,"Model has not been initialized yet"),this._model},setModel:function(t){$assert(t,"Model can not be null"),this._model=t},getId:function(){return this._model.getId()},setOnFocus:function(t){if(this._onFocus!=t){this._onFocus=t
var e=this.getOuterShape()
t?(e.setFill(mindplot.Topic.OUTER_SHAPE_ATTRIBUTES_FOCUS.fillColor),e.setOpacity(1)):(e.setFill(mindplot.Topic.OUTER_SHAPE_ATTRIBUTES.fillColor),e.setOpacity(0)),this.setCursor("move"),this.closeEditors(),this.fireEvent(t?"ontfocus":"ontblur",this)}},isOnFocus:function(){return this._onFocus},dispose:function(t){this.setOnFocus(!1),t.removeChild(this)},createDragNode:function(t){var e=this._buildDragShape()
return new mindplot.DragTopic(e,this,t)},_buildDragShape:function(){$assert(!1,"_buildDragShape must be implemented by all nodes.")},getPosition:function(){var t=this.getModel()
return t.getPosition()}}),mindplot.NodeGraph.create=function(t,e){$assert(t,"Model can not be null")
var i=t.getType()
$assert(i,"Node model type can not be null")
var n
return i==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE?n=new mindplot.CentralTopic(t,e):i==mindplot.model.INodeModel.MAIN_TOPIC_TYPE?n=new mindplot.MainTopic(t,e):$assert(!1,"unsupported node type:"+i),n},mindplot.Topic=new Class({Extends:mindplot.NodeGraph,initialize:function(t,e){this.parent(t,e),this._children=[],this._parent=null,this._relationships=[],this._isInWorkspace=!1,this._buildTopicShape()
var i=t.getPosition()
null!=i&&this.isCentralTopic()&&this.setPosition(i),this.isReadOnly()||this._registerEvents()},_registerEvents:function(){this.setMouseEventsEnabled(!0),this.addEvent("click",function(t){t.stopPropagation()}),this.addEvent("dblclick",function(t){this._getTopicEventDispatcher().show(this),t.stopPropagation()}.bind(this))},setShapeType:function(t){this._setShapeType(t,!0)},getParent:function(){return this._parent},_setShapeType:function(t,e){var i=this.getModel()
$defined(e)&&e&&i.setShapeType(t)
var n=this.getInnerShape()
if(null!=n){this._removeInnerShape()
var o=this.getInnerShape(),s=this.getSize()
this.setSize(s,!0)
var r=this.get2DElement()
r.appendChild(o)
var a=this.getTextShape()
a.moveToFront()
var l=this.getIconGroup()
$defined(l)&&l.moveToFront()
var d=this.getShrinkConnector()
$defined(d)&&d.moveToFront()}},getShapeType:function(){var t=this.getModel(),e=t.getShapeType()
return $defined(e)||(e=mindplot.TopicStyle.defaultShapeType(this)),e},_removeInnerShape:function(){var t=this.get2DElement(),e=this.getInnerShape()
return t.removeChild(e),this._innerShape=null,e},getInnerShape:function(){if(!$defined(this._innerShape)){this._innerShape=this._buildShape(mindplot.Topic.INNER_RECT_ATTRIBUTES,this.getShapeType())
var t=this.getBackgroundColor()
this._setBackgroundColor(t,!1)
var e=this.getBorderColor()
this._setBorderColor(e,!1),this._innerShape.setCursor(this.isCentralTopic()||this.isReadOnly()?"default":"move")}return this._innerShape},_buildShape:function(t,e){$assert(t,"attributes can not be null"),$assert(e,"shapeType can not be null")
var i
if(e==mindplot.model.TopicShape.RECTANGLE)i=new web2d.Rect(0,t)
else if(e==mindplot.model.TopicShape.IMAGE){var n=this.getModel(),o=n.getImageUrl(),s=n.getImageSize()
i=new web2d.Image,i.setHref(o),i.setSize(s.width,s.height),i.getSize=function(){return n.getImageSize()},i.setPosition=function(){}}else e==mindplot.model.TopicShape.ELLIPSE?i=new web2d.Rect(.9,t):e==mindplot.model.TopicShape.ROUNDED_RECT?i=new web2d.Rect(.3,t):e==mindplot.model.TopicShape.LINE?(i=new web2d.Line({strokeColor:"#495879",strokeWidth:1}),i.setSize=function(t,e){this.size={width:t,height:e},i.setFrom(0,e),i.setTo(t,e)
var n=mindplot.ConnectionLine.getStrokeColor()
i.setStroke(1,"solid",n)},i.getSize=function(){return this.size},i.setPosition=function(){},i.setFill=function(){},i.setStroke=function(){}):$assert(!1,"Unsupported figure shapeType:"+e)
return i.setPosition(0,0),i},setCursor:function(t){var e=this.getInnerShape()
e.setCursor(t)
var i=this.getOuterShape()
i.setCursor(t)
var n=this.getTextShape()
n.setCursor(t)},getOuterShape:function(){if(!$defined(this._outerShape)){var t=this._buildShape(mindplot.Topic.OUTER_SHAPE_ATTRIBUTES,mindplot.model.TopicShape.ROUNDED_RECT)
t.setPosition(-2,-3),t.setOpacity(0),this._outerShape=t}return this._outerShape},getTextShape:function(){if(!$defined(this._text)){this._text=this._buildTextShape(!1)
var t=this.getText()
this._setText(t,!1)}return this._text},getOrBuildIconGroup:function(){if(!$defined(this._iconsGroup)){this._iconsGroup=this._buildIconGroup()
var t=this.get2DElement()
t.appendChild(this._iconsGroup.getNativeElement()),this._iconsGroup.moveToFront()}return this._iconsGroup},getIconGroup:function(){return this._iconsGroup},_buildIconGroup:function(){var t=this.getTextShape().getFontHeight(),e=new mindplot.IconGroup(this.getId(),t),i=mindplot.TopicStyle.getInnerPadding(this)
e.setPosition(i,i)
for(var n=this.getModel(),o=n.getFeatures(),s=0;s<o.length;s++){var r=o[s],a=mindplot.TopicFeature.createIcon(this,r,this.isReadOnly())
e.addIcon(a,r.getType()==mindplot.TopicFeature.Icon.id&&!this.isReadOnly())}return e},addFeature:function(t){var e=this.getOrBuildIconGroup()
this.closeEditors()
var i=this.getModel()
i.addFeature(t)
var n=mindplot.TopicFeature.createIcon(this,t,this.isReadOnly())
return e.addIcon(n,t.getType()==mindplot.TopicFeature.Icon.id&&!this.isReadOnly()),this._adjustShapes(),n},findFeatureById:function(t){var e=this.getModel()
return e.findFeatureById(t)},removeFeature:function(t){$assert(t,"featureModel could not be null")
var e=this.getModel()
e.removeFeature(t)
var i=this.getIconGroup()
$defined(i)&&i.removeIconByModel(t),this._adjustShapes()},addRelationship:function(t){this._relationships.push(t)},deleteRelationship:function(t){this._relationships.erase(t)},getRelationships:function(){return this._relationships},_buildTextShape:function(t){var e=new web2d.Text,i=this.getFontFamily(),n=this.getFontSize(),o=this.getFontWeight(),s=this.getFontStyle()
e.setFont(i,n,s,o)
var r=this.getFontColor()
return e.setColor(r),t||e.setCursor(this.isCentralTopic()?"default":"move"),e},setFontFamily:function(t,e){var i=this.getTextShape()
if(i.setFontFamily(t),$defined(e)&&e){var n=this.getModel()
n.setFontFamily(t)}this._adjustShapes(e)},setFontSize:function(t,e){var i=this.getTextShape()
if(i.setSize(t),$defined(e)&&e){var n=this.getModel()
n.setFontSize(t)}this._adjustShapes(e)},setFontStyle:function(t,e){var i=this.getTextShape()
if(i.setStyle(t),$defined(e)&&e){var n=this.getModel()
n.setFontStyle(t)}this._adjustShapes(e)},setFontWeight:function(t,e){var i=this.getTextShape()
if(i.setWeight(t),$defined(e)&&e){var n=this.getModel()
n.setFontWeight(t)}this._adjustShapes()},getFontWeight:function(){var t=this.getModel(),e=t.getFontWeight()
if(!$defined(e)){var i=mindplot.TopicStyle.defaultFontStyle(this)
e=i.weight}return e},getFontFamily:function(){var t=this.getModel(),e=t.getFontFamily()
if(!$defined(e)){var i=mindplot.TopicStyle.defaultFontStyle(this)
e=i.font}return e},getFontColor:function(){var t=this.getModel(),e=t.getFontColor()
if(!$defined(e)){var i=mindplot.TopicStyle.defaultFontStyle(this)
e=i.color}return e},getFontStyle:function(){var t=this.getModel(),e=t.getFontStyle()
if(!$defined(e)){var i=mindplot.TopicStyle.defaultFontStyle(this)
e=i.style}return e},getFontSize:function(){var t=this.getModel(),e=t.getFontSize()
if(!$defined(e)){var i=mindplot.TopicStyle.defaultFontStyle(this)
e=i.size}return e},setFontColor:function(t,e){var i=this.getTextShape()
if(i.setColor(t),$defined(e)&&e){var n=this.getModel()
n.setFontColor(t)}},_setText:function(t,e){var i=this.getTextShape()
if(i.setText(null==t?mindplot.TopicStyle.defaultText(this):t),$defined(e)&&e){var n=this.getModel()
n.setText(t)}},setText:function(t){t&&0!=t.trim().length||(t=null),this._setText(t,!0),this._adjustShapes()},getText:function(){var t=this.getModel(),e=t.getText()
return $defined(e)||(e=mindplot.TopicStyle.defaultText(this)),e},setBackgroundColor:function(t){this._setBackgroundColor(t,!0)},_setBackgroundColor:function(t,e){var i=this.getInnerShape()
i.setFill(t)
var n=this.getShrinkConnector()
if(n&&n.setFill(t),$defined(e)&&e){var o=this.getModel()
o.setBackgroundColor(t)}},getBackgroundColor:function(){var t=this.getModel(),e=t.getBackgroundColor()
return $defined(e)||(e=mindplot.TopicStyle.defaultBackgroundColor(this)),e},setBorderColor:function(t){this._setBorderColor(t,!0)},_setBorderColor:function(t,e){var i=this.getInnerShape()
i.setAttribute("strokeColor",t)
var n=this.getShrinkConnector()
if(n&&n.setAttribute("strokeColor",t),$defined(e)&&e){var o=this.getModel()
o.setBorderColor(t)}},getBorderColor:function(){var t=this.getModel(),e=t.getBorderColor()
return $defined(e)||(e=mindplot.TopicStyle.defaultBorderColor(this)),e},_buildTopicShape:function(){var t={width:100,height:100,coordSizeWidth:100,coordSizeHeight:100},e=new web2d.Group(t)
this._set2DElement(e)
var i=this.getOuterShape(),n=this.getInnerShape(),o=this.getTextShape()
e.appendChild(i),e.appendChild(n),e.appendChild(o)
var s=this.getModel()
0!=s.getFeatures().length&&this.getOrBuildIconGroup()
var r=this.getShrinkConnector()
$defined(r)&&r.addToWorkspace(e),this._registerDefaultListenersToElement(e,this)},_registerDefaultListenersToElement:function(t,e){var i=function(t){e.isMouseEventsEnabled()&&e.handleMouseOver(t)}
t.addEvent("mouseover",i)
var n=function(t){e.isMouseEventsEnabled()&&e.handleMouseOut(t)}
t.addEvent("mouseout",n),t.addEvent("mousedown",function(t){if(!this.isReadOnly()){var i=!0;(t.meta&&Browser.Platform.mac||t.control&&!Browser.Platform.mac)&&(i=!this.isOnFocus(),t.stopPropagation(),t.preventDefault()),e.setOnFocus(i)}var n=this._getTopicEventDispatcher()
n.process(mindplot.TopicEvent.CLICK,this),t.stopPropagation()}.bind(this))},areChildrenShrunken:function(){var t=this.getModel()
return t.areChildrenShrunken()&&!this.isCentralTopic()},isCollapsed:function(){for(var t=!1,e=this.getParent();e&&!t;)t=e.areChildrenShrunken(),e=e.getParent()
return t},setChildrenShrunken:function(t){var e=this.getModel()
e.setChildrenShrunken(t)
var i=this.getShrinkConnector()
$defined(i)&&i.changeRender(t)
var n=this._flatten2DElements(this),o=new mindplot.util.FadeEffect(n,!t)
o.addEvent("complete",function(){t&&this.setOnFocus(!0),n.forEach(function(t){t.setOnFocus&&t.setOnFocus(!1)})}.bind(this)),o.start(),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeShrinkEvent,e)},getShrinkConnector:function(){var t=this._connector
return null==this._connector&&(this._connector=new mindplot.ShirinkConnector(this),this._connector.setVisibility(!1),t=this._connector),t},handleMouseOver:function(){var t=this.getOuterShape()
t.setOpacity(1)},handleMouseOut:function(){var t=this.getOuterShape()
this.isOnFocus()||t.setOpacity(0)},showTextEditor:function(t){this._getTopicEventDispatcher().show(this,{text:t})},showNoteEditor:function(){var t=this.getId(),e=this.getModel(),i={getValue:function(){var t,i=e.findFeatureByType(mindplot.TopicFeature.Note.id)
return i.length>0&&(t=i[0].getText()),t},setValue:function(i){var n=mindplot.ActionDispatcher.getInstance(),o=e.findFeatureByType(mindplot.TopicFeature.Note.id)
if($defined(i))o.length>0?n.changeFeatureToTopic(t,o[0].getId(),{text:i}):n.addFeatureToTopic(t,mindplot.TopicFeature.Note.id,{text:i})
else{var s=o[0].getId()
n.removeFeatureFromTopic(t,s)}}},n=new mindplot.widget.NoteEditor(i)
this.closeEditors(),n.show()},showLinkEditor:function(){var t=this.getId(),e=this.getModel(),i={getValue:function(){var t,i=e.findFeatureByType(mindplot.TopicFeature.Link.id)
return i.length>0&&(t=i[0].getUrl()),t},setValue:function(i){var n=mindplot.ActionDispatcher.getInstance(),o=e.findFeatureByType(mindplot.TopicFeature.Link.id)
if($defined(i))o.length>0?n.changeFeatureToTopic(t,o[0].getId(),{url:i}):n.addFeatureToTopic(t,mindplot.TopicFeature.Link.id,{url:i})
else{var s=o[0].getId()
n.removeFeatureFromTopic(t,s)}}}
this.closeEditors()
var n=new mindplot.widget.LinkEditor(i)
n.show()},closeEditors:function(){this._getTopicEventDispatcher().close(!0)},_getTopicEventDispatcher:function(){return mindplot.TopicEventDispatcher.getInstance()},setPosition:function(t){$assert(t,"position can not be null"),t.x=Math.ceil(t.x),t.y=Math.ceil(t.y)
var e=this.getModel()
e.setPosition(t.x,t.y)
var i=this.getSize(),n=t.x-i.width/2,o=t.y-i.height/2
this._elem2d.setPosition(n,o),this._updateConnectionLines(),this.invariant()},getOutgoingLine:function(){return this._outgoingLine},getIncomingLines:function(){for(var t=[],e=this.getChildren(),i=0;i<e.length;i++){var n=e[i],o=n.getOutgoingLine()
$defined(o)&&t.push(o)}return t},getOutgoingConnectedTopic:function(){var t=null,e=this.getOutgoingLine()
return $defined(e)&&(t=e.getTargetTopic()),t},_updateConnectionLines:function(){var t=this.getOutgoingLine()
$defined(t)&&t.redraw()
for(var e=this.getIncomingLines(),i=0;i<e.length;i++)e[i].redraw()
for(var n=0;n<this._relationships.length;n++)this._relationships[n].redraw()},setBranchVisibility:function(t){for(var e=this,i=this;null!=i&&!i.isCentralTopic();)e=i,i=e.getParent()
e.setVisibility(t)},setVisibility:function(t){this._setTopicVisibility(t),this._setChildrenVisibility(t),this._setRelationshipLinesVisibility(t)
var e=this.getOutgoingLine()
e&&e.setVisibility(t)},moveToBack:function(){for(var t=0;t<this._relationships.length;t++)this._relationships[t].moveToBack()
var e=this.getShrinkConnector()
$defined(e)&&e.moveToBack(),this.get2DElement().moveToBack()},moveToFront:function(){this.get2DElement().moveToFront()
var t=this.getShrinkConnector()
$defined(t)&&t.moveToFront()
for(var e=0;e<this._relationships.length;e++)this._relationships[e].moveToFront()},isVisible:function(){var t=this.get2DElement()
return t.isVisible()},_setRelationshipLinesVisibility:function(t){this._relationships.each(function(e){var i=e.getSourceTopic(),n=e.getTargetTopic(),o=n.getModel().getParent(),s=i.getModel().getParent()
e.setVisibility(!(!t||null!=o&&o.areChildrenShrunken()||null!=s&&s.areChildrenShrunken()))})},_setTopicVisibility:function(t){var e=this.get2DElement()
if(e.setVisibility(t),this.getIncomingLines().length>0){var i=this.getShrinkConnector()
$defined(i)&&i.setVisibility(t)}var n=this.getTextShape()
n.setVisibility(this.getShapeType()!=mindplot.model.TopicShape.IMAGE?t:!1)},setOpacity:function(t){var e=this.get2DElement()
e.setOpacity(t)
var i=this.getShrinkConnector()
$defined(i)&&i.setOpacity(t)
var n=this.getTextShape()
n.setOpacity(t)},_setChildrenVisibility:function(t){var e=this.getChildren(),i=this.getModel()
t=t?!i.areChildrenShrunken():t
for(var n=0;n<e.length;n++){var o=e[n]
o.setVisibility(t)
var s=o.getOutgoingLine()
s.setVisibility(t)}},invariant:function(){{var t=(this._outgoingLine,this.getModel())
t.isConnected()}},setSize:function(t,e){$assert(t,"size can not be null"),$assert($defined(t.width),"size seem not to be a valid element"),t={width:Math.ceil(t.width),height:Math.ceil(t.height)}
var i=this.getSize(),n=i.width!=t.width||i.height!=t.height
if(n||e){mindplot.NodeGraph.prototype.setSize.call(this,t)
var o=this.getOuterShape(),s=this.getInnerShape()
o.setSize(t.width+4,t.height+6),s.setSize(t.width,t.height),this._updatePositionOnChangeSize(i,t),n&&mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeResizeEvent,{node:this.getModel(),size:t})}},_updatePositionOnChangeSize:function(){$assert(!1,"this method must be overwrited.")},disconnect:function(t){var e=this.getOutgoingLine()
if($defined(e)){$assert(t,"workspace can not be null"),this._outgoingLine=null
var i=e.getTargetTopic()
i.removeChild(this)
var n=this.getModel()
n.disconnect(),this._parent=null,e.removeFromWorkspace(t),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeDisconnectEvent,this.getModel())
var o=this.getModel()
if(!o.getText()){var s=this.getText()
this._setText(s,!1)}if(!o.getFontSize()){var r=this.getFontSize()
this.setFontSize(r,!1)}if(0==i.getChildren().length){var a=i.getShrinkConnector()
$defined(a)&&a.setVisibility(!1)}}},getOrder:function(){var t=this.getModel()
return t.getOrder()},setOrder:function(t){var e=this.getModel()
e.setOrder(t)},connectTo:function(t,e){$assert(!this._outgoingLine,"Could not connect an already connected node"),$assert(t!=this,"Circular connection are not allowed"),$assert(t,"Parent Graph can not be null"),$assert(e,"Workspace can not be null"),t.appendChild(this),this._parent=t
var i=t.getModel(),n=this.getModel()
n.connectTo(i)
var o=new mindplot.ConnectionLine(this,t)
o.setVisibility(!1),this._outgoingLine=o,e.appendChild(o),this.updateTopicShape(t)
var s=this.getModel()
if(!s.getText()){var r=this.getText()
this._setText(r,!1)}if(!s.getFontSize()){var a=this.getFontSize()
this.setFontSize(a,!1)}this.getTextShape()
var l=t.getShrinkConnector()
$defined(l)&&l.setVisibility(!0),o.redraw(),this.isInWorkspace()&&mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeConnectEvent,{parentNode:t.getModel(),childNode:this.getModel()})},appendChild:function(t){var e=this.getChildren()
e.push(t)},removeChild:function(t){var e=this.getChildren()
e.erase(t)},getChildren:function(){var t=this._children
return $defined(t)||(this._children=[],t=this._children),t},removeFromWorkspace:function(t){var e=this.get2DElement()
t.removeChild(e)
var i=this.getOutgoingLine()
$defined(i)&&t.removeChild(i),this._isInWorkspace=!1,mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeRemoved,this.getModel())},addToWorkspace:function(t){var e=this.get2DElement()
t.appendChild(e),this.isInWorkspace()||(this.isCentralTopic()||mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeAdded,this.getModel()),this.getModel().isConnected()&&mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.NodeConnectEvent,{parentNode:this.getOutgoingConnectedTopic().getModel(),childNode:this.getModel()})),this._isInWorkspace=!0,this._adjustShapes()},isInWorkspace:function(){return this._isInWorkspace},createDragNode:function(t){var e=this.parent(t),i=this.getOutgoingConnectedTopic()
return $defined(i)&&(e.connectTo(i),e.setVisibility(!1)),this._getTopicEventDispatcher().close(),e},_adjustShapes:function(){if(this._isInWorkspace){var t=this.getTextShape()
if(this.getShapeType()!=mindplot.model.TopicShape.IMAGE){var e=t.getWidth(),i=t.getHeight()
i=0!=i?i:20
var n=mindplot.TopicStyle.getInnerPadding(this),o=this.getOrBuildIconGroup(),s=this.getTextShape().getFontHeight()
o.setPosition(n,n),o.seIconSize(s,s)
var r=o.getSize().width
0!=r&&(r+=i/4)
var a=i+2*n,l=e+r+2*n
this.setSize({width:l,height:a}),t.setPosition(n+r,n)}else{var d=this.getModel().getImageSize()
this.setSize(d)}}},_flatten2DElements:function(t){for(var e=[],i=t.getChildren(),n=0;n<i.length;n++){var o=i[n]
e.push(o),e.push(o.getOutgoingLine())
var s=o.getRelationships()
if(e=e.concat(s),!o.areChildrenShrunken()){var r=this._flatten2DElements(o)
e=e.concat(r)}}return e},isChildTopic:function(t){var e=this.getId()==t.getId()
if(!e)for(var i=this.getChildren(),n=0;n<i.length;n++){var o=i[n]
if(e=o.isChildTopic(t))break}return e},isCentralTopic:function(){return this.getModel().getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE}}),mindplot.Topic.CONNECTOR_WIDTH=6,mindplot.Topic.OUTER_SHAPE_ATTRIBUTES={fillColor:"rgb(252,235,192)",stroke:"1 dot rgb(241,163,39)",x:0,y:0},mindplot.Topic.OUTER_SHAPE_ATTRIBUTES_FOCUS={fillColor:"rgb(244,184,45)",x:0,y:0},mindplot.Topic.INNER_RECT_ATTRIBUTES={stroke:"2 solid"},mindplot.CentralTopic=new Class({Extends:mindplot.Topic,initialize:function(t,e){this.parent(t,e)},_registerEvents:function(){this.parent(),this.addEvent("mousedown",function(t){t.stopPropagation()})},workoutIncomingConnectionPoint:function(){return this.getPosition()},setCursor:function(t){t="move"==t?"default":t,this.parent(t)},updateTopicShape:function(){},_updatePositionOnChangeSize:function(){var t=new core.Point(0,0)
this.setPosition(t)},getShrinkConnector:function(){return null},workoutOutgoingConnectionPoint:function(t){$assert(t,"targetPoint can not be null")
var e=this.getPosition(),i=mindplot.util.Shape.isAtRight(t,e),n=this.getSize()
return mindplot.util.Shape.calculateRectConnectionPoint(e,n,!i)}}),mindplot.MainTopic=new Class({Extends:mindplot.Topic,initialize:function(t,e){this.parent(t,e)},INNER_RECT_ATTRIBUTES:{stroke:"0.5 solid #009900"},_buildDragShape:function(){var t=this._buildShape(this.INNER_RECT_ATTRIBUTES,this.getShapeType()),e=this.getSize()
t.setSize(e.width,e.height),t.setPosition(0,0),t.setOpacity(.5),t.setCursor("default"),t.setVisibility(!0)
var i=this.getBorderColor()
t.setAttribute("strokeColor",i)
var n=this.getBackgroundColor()
t.setAttribute("fillColor",n)
var o={width:100,height:100,coordSizeWidth:100,coordSizeHeight:100},s=new web2d.Group(o)
if(s.appendChild(t),this.getShapeType()!=mindplot.model.TopicShape.IMAGE){var r=this._buildTextShape(!0),a=this.getText()
r.setText(a),r.setOpacity(.5),s.appendChild(r)}return s},updateTopicShape:function(t,e){var i=this.getModel(),n=i.getShapeType()
t.isCentralTopic()||$defined(n)||(n=this.getShapeType(),this._setShapeType(n,!1))},disconnect:function(t){this.parent(t)
var e=(this.getSize(),this.getModel()),i=e.getShapeType()
$defined(i)||(i=this.getShapeType(),this._setShapeType(mindplot.model.TopicShape.ROUNDED_RECT,!1))
var n=this.getInnerShape()
n.setVisibility(!0)},_updatePositionOnChangeSize:function(t,e){var i=Math.round((e.width-t.width)/2),n=this.getPosition()
$defined(n)&&(n.x=n.x>0?n.x+i:n.x-i,this.setPosition(n))},workoutIncomingConnectionPoint:function(t){return mindplot.util.Shape.workoutIncomingConnectionPoint(this,t)},workoutOutgoingConnectionPoint:function(t){$assert(t,"targetPoint can not be null")
var e,i=this.getPosition(),n=mindplot.util.Shape.isAtRight(t,i),o=this.getSize()
if(this.getShapeType()==mindplot.model.TopicShape.LINE){e=new core.Point
var s=this._elem2d.getPosition(),r=this.getInnerShape().getSize()
if(r){var a=.3
e.x=n?s.x+a:s.x+r.width-a,e.y=s.y+r.height}else e.x=n?i.x-o.width/2:i.x+o.width/2,e.y=i.y+o.height/2}else e=mindplot.util.Shape.calculateRectConnectionPoint(i,o,n,!0)
return e}}),mindplot.DragTopic=new Class({initialize:function(t,e,i){$assert(t,"Rect can not be null."),$assert(e,"draggedNode can not be null."),$assert(i,"layoutManger can not be null."),this._elem2d=t,this._order=null,this._draggedNode=e,this._layoutManager=i,this._position=new core.Point,this._isInWorkspace=!1,this._isFreeLayoutEnabled=!1},setOrder:function(t){this._order=t},setPosition:function(t,e){var i={x:t,y:e}
if(this.isFreeLayoutOn()&&this.isConnected()){var n=this._layoutManager,o=this.getConnectedToTopic()
i=n.predict(o.getId(),this._draggedNode.getId(),i,!0).position}this._position.setValue(i.x,i.y)
var s=this._draggedNode,r=s.getSize(),a=i.x-(i.x>0?0:r.width),l=Math.ceil(i.y-r.height/2)
if(this._elem2d.setPosition(a,l),this.isConnected()&&!this.isFreeLayoutOn()){var d=this.getConnectedToTopic(),c=this._layoutManager.predict(d.getId(),this._draggedNode.getId(),this.getPosition())
if(this._order!=c.order){var h=this._getDragPivot(),u=c.position
h.connectTo(d,u),this.setOrder(c.order)}}},updateFreeLayout:function(t){var e=t.meta&&Browser.Platform.mac||t.control&&!Browser.Platform.mac
if(this.isFreeLayoutOn()!=e){var i=this._getDragPivot()
i.setVisibility(!e),this._isFreeLayoutEnabled=e}},setVisibility:function(t){var e=this._getDragPivot()
e.setVisibility(t)},isVisible:function(){var t=this._getDragPivot()
return t.isVisible()},getInnerShape:function(){return this._elem2d},disconnect:function(t){var e=this._getDragPivot()
e.disconnect(t)},connectTo:function(t){$assert(t,"Parent connection node can not be null.")
var e=designer._eventBussDispatcher._layoutManager.predict(t.getId(),this._draggedNode.getId(),this.getPosition()),i=this._getDragPivot(),n=e.position
i.connectTo(t,n),i.setVisibility(!0),this.setOrder(e.order)},getDraggedTopic:function(){return this._draggedNode},removeFromWorkspace:function(t){if(this._isInWorkspace){t.removeChild(this._elem2d)
var e=this._getDragPivot()
e.setVisibility(!1),this._isInWorkspace=!1}},isInWorkspace:function(){return this._isInWorkspace},addToWorkspace:function(t){if(!this._isInWorkspace){t.appendChild(this._elem2d)
var e=this._getDragPivot()
e.addToWorkspace(t),this._isInWorkspace=!0}},_getDragPivot:function(){return mindplot.DragTopic.__getDragPivot()},getPosition:function(){return this._position},isDragTopic:function(){return!0},applyChanges:function(t){$assert(t,"workspace can not be null")
var e=mindplot.ActionDispatcher.getInstance(),i=this.getDraggedTopic(),n=i.getId(),o=this.getPosition()
if(this.isFreeLayoutOn())e.moveTopic(n,o)
else{var s=null,r=null,a=this.isConnected()
if(a){var l=this.getConnectedToTopic()
s=this._order,r=l}e.dragTopic(n,o,s,r)}},getConnectedToTopic:function(){var t=this._getDragPivot()
return t.getTargetTopic()},isConnected:function(){return null!=this.getConnectedToTopic()},isFreeLayoutOn:function(){return!1}}),mindplot.DragTopic.PIVOT_SIZE={width:50,height:6},mindplot.DragTopic.init=function(t){$assert(t,"workspace can not be null")
var e=mindplot.DragTopic.__getDragPivot()
t.appendChild(e)},mindplot.DragTopic.__getDragPivot=function(){var t=mindplot.DragTopic._dragPivot
return $defined(t)||(t=new mindplot.DragPivot,mindplot.DragTopic._dragPivot=t),t},mindplot.DragManager=new Class({initialize:function(t,e){this._workspace=t,this._designerModel=t,this._listeners={},this._isDragInProcess=!1,this._eventDispatcher=e,mindplot.DragTopic.init(this._workspace)},add:function(t){var e=this._workspace,i=e.getScreenManager(),n=this,o=function(o){if(e.isWorkspaceEventsEnabled()){e.enableWorkspaceEvents(!1)
var s=this._eventDispatcher.getLayoutManager(),r=t.createDragNode(s),a=n._buildMouseMoveListener(e,r,n)
i.addEvent("mousemove",a)
var l=n._buildMouseUpListener(e,t,r,n)
i.addEvent("mouseup",l),window.document.body.style.cursor="move"}}.bind(this)
t.addEvent("mousedown",o)},remove:function(t){for(var e=this._topics,i=!1,n=-1,o=0;o<e.length;o++)e[o]==t&&(i=!0,n=o)},_buildMouseMoveListener:function(t,e,i){var n=t.getScreenManager(),o=function(o){if(!this._isDragInProcess){var s=i._listeners.startdragging
s(o,e),t.appendChild(e),this._isDragInProcess=!0}var r=n.getWorkspaceMousePosition(o)
e.setPosition(r.x,r.y)
var a=i._listeners.dragging
$defined(a)&&a(o,e),o.preventDefault()}.bind(this)
return i._mouseMoveListener=o,o},_buildMouseUpListener:function(t,e,i,n){var o=t.getScreenManager(),s=function(e){if($assert(i.isDragTopic,"dragNode must be an DragTopic"),o.removeEvent("mousemove",n._mouseMoveListener),o.removeEvent("mouseup",n._mouseUpListener),n._mouseMoveListener=null,n._mouseUpListener=null,t.enableWorkspaceEvents(!0),window.document.body.style.cursor="default",this._isDragInProcess){var s=n._listeners.enddragging
s(e,i),i.removeFromWorkspace(t),this._isDragInProcess=!1}}.bind(this)
return n._mouseUpListener=s,s},addEvent:function(t,e){this._listeners[t]=e}}),mindplot.DragPivot=new Class({initialize:function(){this._position=new core.Point,this._size=mindplot.DragTopic.PIVOT_SIZE,this._straightLine=this._buildStraightLine(),this._curvedLine=this._buildCurvedLine(),this._dragPivot=this._buildRect(),this._connectRect=this._buildRect(),this._targetTopic=null,this._isVisible=!1},isVisible:function(){return this._isVisible},getTargetTopic:function(){return this._targetTopic},_buildStraightLine:function(){var t=new web2d.CurvedLine
return t.setStyle(web2d.CurvedLine.SIMPLE_LINE),t.setStroke(1,"solid","#CC0033"),t.setOpacity(.4),t.setVisibility(!1),t},_buildCurvedLine:function(){var t=new web2d.CurvedLine
return t.setStyle(web2d.CurvedLine.SIMPLE_LINE),t.setStroke(1,"solid","#CC0033"),t.setOpacity(.4),t.setVisibility(!1),t},_redrawLine:function(){$assert(this.getTargetTopic(),"Illegal invocation. Target node can not be null")
var t=this._getPivotRect(),e=this.getTargetTopic(),i=this._position,n=this._size,o=e.getPosition(),s=this._getConnectionLine(),r=mindplot.util.Shape.isAtRight(o,i),a=mindplot.util.Shape.calculateRectConnectionPoint(i,n,r)
s.setFrom(a.x,a.y)
var l=i.x-parseInt(n.width)/2,d=i.y-parseInt(n.height)/2
t.setPosition(l,d)
var c=e.workoutIncomingConnectionPoint(a)
s.setTo(c.x,c.y)},setPosition:function(t){this._position=t,this._redrawLine()},getPosition:function(){return this._position},_buildRect:function(){var t=this._size,e={fillColor:"#CC0033",opacity:.4,width:t.width,height:t.height,strokeColor:"#FF9933"},i=new web2d.Rect(0,e)
return i.setVisibility(!1),i},_getPivotRect:function(){return this._dragPivot},getSize:function(){var t=this._getPivotRect()
return t.getSize()},setVisibility:function(t){if(this.isVisible()!=t){var e=this._getPivotRect()
e.setVisibility(t)
var i=this._connectRect
i.setVisibility(t)
var n=this._getConnectionLine()
n&&n.setVisibility(t),this._isVisible=t}},_getConnectionLine:function(){var t=null,e=this._targetTopic
return e&&(t=e.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE?this._straightLine:this._curvedLine),t},addToWorkspace:function(t){var e=this._getPivotRect()
t.appendChild(e)
var i=this._connectRect
t.appendChild(i)
var n=this._straightLine
n.setVisibility(!1),t.appendChild(n),n.moveToBack()
var o=this._curvedLine
o.setVisibility(!1),t.appendChild(o),o.moveToBack()
var s=this._connectRect
s.setVisibility(!1),t.appendChild(s),s.moveToBack()},removeFromWorkspace:function(t){var e=this._getPivotRect()
t.removeChild(e)
var i=this._connectRect
t.removeChild(i),$defined(this._straightLine)&&t.removeChild(this._straightLine),$defined(this._curvedLine)&&t.removeChild(this._curvedLine)},connectTo:function(t,e){$assert(!this._outgoingLine,"Could not connect an already connected node"),$assert(t!=this,"Circular connection are not allowed"),$assert(e,"position can not be null"),$assert(t,"parent can not be null"),this._position=e,this._targetTopic=t
var i=this._connectRect,n=t.getSize(),o=n.width+4,s=n.height+4
i.setSize(o,s)
var r=t.getPosition(),a=Math.ceil(r.x-o/2),l=Math.ceil(r.y-s/2)
i.setPosition(a,l)
var d=this._getPivotRect()
d.moveToFront(),d.setPosition(e.x,e.y),this._redrawLine()},disconnect:function(t){$assert(t,"workspace can not be null."),$assert(this._targetTopic,"There are not connected topic."),this.setVisibility(!1),this._targetTopic=null}}),mindplot.ConnectionLine=new Class({initialize:function(t,e,i){$assert(e,"parentNode node can not be null"),$assert(t,"childNode node can not be null"),$assert(t!=e,"Circular connection"),this._targetTopic=e,this._sourceTopic=t
var n,o=this._getCtrlPoints(t,e)
e.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE?(n=this._createLine(i,mindplot.ConnectionLine.CURVED),n.setSrcControlPoint(o[0]),n.setDestControlPoint(o[1])):(n=this._createLine(i,mindplot.ConnectionLine.SIMPLE_CURVED),n.setSrcControlPoint(o[0]),n.setDestControlPoint(o[1]))
var s=mindplot.ConnectionLine.getStrokeColor()
n.setStroke(1,"solid",s,1),n.setFill(s,1),this._line2d=n},_getCtrlPoints:function(t,e){var i=t.workoutOutgoingConnectionPoint(e.getPosition()),n=e.workoutIncomingConnectionPoint(t.getPosition()),o=(i.x-n.x)/3
return[new core.Point(o,0),new core.Point(-o,0)]},_createLine:function(t,e){$defined(t)||(t=e),t=parseInt(t),this._lineType=t
var i=null
switch(t){case mindplot.ConnectionLine.POLYLINE:i=new web2d.PolyLine
break
case mindplot.ConnectionLine.CURVED:i=new web2d.CurvedLine
break
case mindplot.ConnectionLine.SIMPLE_CURVED:i=new web2d.CurvedLine,i.setStyle(web2d.CurvedLine.SIMPLE_LINE)
break
default:i=new web2d.Line}return i},setVisibility:function(t){this._line2d.setVisibility(t)},isVisible:function(){return this._line2d.isVisible()},setOpacity:function(t){this._line2d.setOpacity(t)},redraw:function(){var t,e,i=this._line2d,n=this._sourceTopic,o=n.getPosition(),s=this._targetTopic,r=s.getPosition()
if(t=n.workoutOutgoingConnectionPoint(r),e=s.workoutIncomingConnectionPoint(o),i.setFrom(e.x,e.y),i.setTo(t.x,t.y),"CurvedLine"==i.getType()){var a=this._getCtrlPoints(this._sourceTopic,this._targetTopic)
i.setSrcControlPoint(a[0]),i.setDestControlPoint(a[1])}this._positionateConnector(s)},_positionateConnector:function(t){var e,i,n=t.getPosition(),o=mindplot.Topic.CONNECTOR_WIDTH/2,s=t.getSize()
e=t.getShapeType()==mindplot.model.TopicShape.LINE?s.height:s.height/2,e-=o
var r=t.getShrinkConnector()
$defined(r)&&(Math.sign(n.x)>0?(i=s.width,r.setPosition(i,e)):i=-mindplot.Topic.CONNECTOR_WIDTH,r.setPosition(i,e))},setStroke:function(t,e,i){this._line2d.setStroke(null,null,t,i)},addToWorkspace:function(t){t.appendChild(this._line2d),this._line2d.moveToBack()},removeFromWorkspace:function(t){t.removeChild(this._line2d)},getTargetTopic:function(){return this._targetTopic},getSourceTopic:function(){return this._sourceTopic},getLineType:function(){return this._lineType},getLine:function(){return this._line2d},getModel:function(){return this._model},setModel:function(t){this._model=t},getType:function(){return"ConnectionLine"},getId:function(){return this._model.getId()},moveToBack:function(){this._line2d.moveToBack()},moveToFront:function(){this._line2d.moveToFront()}}),mindplot.ConnectionLine.getStrokeColor=function(){return"#495879"},mindplot.ConnectionLine.SIMPLE=0,mindplot.ConnectionLine.POLYLINE=1,mindplot.ConnectionLine.CURVED=2,mindplot.ConnectionLine.SIMPLE_CURVED=3,mindplot.Relationship=new Class({Extends:mindplot.ConnectionLine,Static:{getStrokeColor:function(){return"#9b74e6"},type:"Relationship"},initialize:function(t,e,i){$assert(t,"sourceNode can not be null"),$assert(e,"targetNode can not be null"),this.parent(t,e,i.getLineType()),this.setModel(i)
var n=mindplot.Relationship.getStrokeColor()
this._line2d.setIsSrcControlPointCustom(!1),this._line2d.setIsDestControlPointCustom(!1),this._line2d.setCursor("pointer"),this._line2d.setStroke(1,"solid",n),this._line2d.setDashed(4,2),this._focusShape=this._createLine(this.getLineType(),mindplot.ConnectionLine.SIMPLE_CURVED),this._focusShape.setStroke(2,"solid","#3f96ff")
var o=this._line2d.getControlPoints()
if(this._focusShape.setSrcControlPoint(o[0]),this._focusShape.setDestControlPoint(o[1]),this._focusShape.setVisibility(!1),this._onFocus=!1,this._isInWorkspace=!1,this._controlPointsController=new mindplot.ControlPoint,this._startArrow=new web2d.Arrow,this._startArrow.setStrokeColor(n),this._startArrow.setStrokeWidth(2),this.setShowStartArrow(!0),this._showEndArrow&&(this._endArrow=new web2d.Arrow,this._endArrow.setStrokeColor(n),this._endArrow.setStrokeWidth(2)),$defined(i.getSrcCtrlPoint())){var s=i.getSrcCtrlPoint().clone()
this.setSrcControlPoint(s)}if($defined(i.getDestCtrlPoint())){var r=i.getDestCtrlPoint().clone()
this.setDestControlPoint(r)}},setStroke:function(t,e,i){this.parent(t,e,i),this._startArrow.setStrokeColor(t)},redraw:function(){var t=this._line2d,e=this._sourceTopic,i=e.getPosition(),n=this._targetTopic,o=n.getPosition()
n.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&(o=mindplot.util.Shape.workoutIncomingConnectionPoint(n,i))
var s,r
this._line2d.setStroke(2)
var a=this._line2d.getControlPoints()
if(!this._line2d.isDestControlPointCustom()&&!this._line2d.isSrcControlPointCustom()){var l=mindplot.util.Shape.calculateDefaultControlPoints(i,o)
a[0].x=l[0].x,a[0].y=l[0].y,a[1].x=l[1].x,a[1].y=l[1].y}var d=new core.Point
d.x=parseInt(a[0].x)+parseInt(i.x),d.y=parseInt(a[0].y)+parseInt(i.y)
var c=new core.Point
c.x=parseInt(a[1].x)+parseInt(o.x),c.y=parseInt(a[1].y)+parseInt(o.y),s=mindplot.util.Shape.calculateRelationShipPointCoordinates(e,d),r=mindplot.util.Shape.calculateRelationShipPointCoordinates(n,c),t.setFrom(s.x,s.y),t.setTo(r.x,r.y),t.moveToFront(),this._positionArrows(),this._positionateConnector(n),this.isOnFocus()&&this._refreshShape(),this._focusShape.moveToBack(),this._controlPointsController.redraw()},_positionArrows:function(){var t=this._line2d.getTo(),e=this._line2d.getFrom()
if(this._startArrow.setFrom(e.x,e.y),this._startArrow.moveToBack(),this._endArrow&&(this._endArrow.setFrom(t.x,t.y),this._endArrow.moveToBack()),"CurvedLine"==this._line2d.getType()){var i=this._line2d.getControlPoints()
this._startArrow.setControlPoint(i[0]),this._endArrow&&this._endArrow.setControlPoint(i[1])}else this._startArrow.setControlPoint(this._line2d.getTo()),this._endArrow&&this._endArrow.setControlPoint(this._line2d.getFrom())
this._showEndArrow&&this._endArrow.setVisibility(this.isVisible()),this._startArrow.setVisibility(this.isVisible()&&this._showStartArrow)},addToWorkspace:function(t){t.appendChild(this._focusShape),t.appendChild(this._controlPointsController),this._controlPointControllerListener=this._initializeControlPointController.bind(this),this._line2d.addEvent("click",this._controlPointControllerListener),this._isInWorkspace=!0,t.appendChild(this._startArrow),this._endArrow&&t.appendChild(this._endArrow),this.parent(t),this._positionArrows(),this.redraw()},_initializeControlPointController:function(){this.setOnFocus(!0)},removeFromWorkspace:function(t){t.removeChild(this._focusShape),t.removeChild(this._controlPointsController),this._line2d.removeEvent("click",this._controlPointControllerListener),this._isInWorkspace=!1,t.removeChild(this._startArrow),this._endArrow&&t.removeChild(this._endArrow),this.parent(t)},getType:function(){return mindplot.Relationship.type},setOnFocus:function(t){this.isOnFocus()!=t&&(t&&(this._refreshShape(),this._controlPointsController.setLine(this)),this._focusShape.setVisibility(t),this._controlPointsController.setVisibility(t),this._onFocus=t,this.fireEvent(t?"ontfocus":"ontblur",this))},_refreshShape:function(){var t=this._line2d.getFrom(),e=this._line2d.getTo(),i=this._line2d.getControlPoints()
this._focusShape.setFrom(t.x,t.y),this._focusShape.setTo(e.x,e.y)
var n=this._focusShape.getControlPoints()
n[0].x=i[0].x,n[0].y=i[0].y,n[1].x=i[1].x,n[1].y=i[1].y,this._focusShape.updateLine()},addEvent:function(t,e){"onfocus"==t&&(t="mousedown")
var i=this._line2d
i.addEvent(t,e)},isOnFocus:function(){return this._onFocus},isInWorkspace:function(){return this._isInWorkspace},setVisibility:function(t){this.parent(t),this._showEndArrow&&this._endArrow.setVisibility(this._showEndArrow),this._startArrow.setVisibility(this._showStartArrow&&t)},setOpacity:function(t){this.parent(t),this._showEndArrow&&this._endArrow.setOpacity(t),this._showStartArrow&&this._startArrow.setOpacity(t)},setShowEndArrow:function(t){this._showEndArrow=t,this._isInWorkspace&&this.redraw()},setShowStartArrow:function(t){this._showStartArrow=t,this._isInWorkspace&&this.redraw()},setFrom:function(t,e){$assert($defined(t),"x must be defined"),$assert($defined(e),"y must be defined"),this._line2d.setFrom(t,e),this._startArrow.setFrom(t,e)},setTo:function(t,e){$assert($defined(t),"x must be defined"),$assert($defined(e),"y must be defined"),this._line2d.setTo(t,e),this._endArrow&&this._endArrow.setFrom(t,e)},setSrcControlPoint:function(t){this._line2d.setSrcControlPoint(t),this._startArrow.setControlPoint(t)},setDestControlPoint:function(t){this._line2d.setDestControlPoint(t),this._showEndArrow&&this._endArrow.setControlPoint(t)},getControlPoints:function(){return this._line2d.getControlPoints()},isSrcControlPointCustom:function(){return this._line2d.isSrcControlPointCustom()},isDestControlPointCustom:function(){return this._line2d.isDestControlPointCustom()},setIsSrcControlPointCustom:function(t){this._line2d.setIsSrcControlPointCustom(t)},setIsDestControlPointCustom:function(t){this._line2d.setIsDestControlPointCustom(t)},getId:function(){return this._model.getId()},fireEvent:function(t,e){var i=this._line2d
i.fireEvent(t,e)}}),mindplot.DragConnector=new Class({initialize:function(t,e){$assert(t,"designerModel can not be null"),$assert(e,"workspace can not be null"),this._designerModel=t,this._workspace=e},checkConnection:function(t){var e=(this._designerModel.getTopics(),this._searchConnectionCandidates(t)),i=t.getConnectedToTopic()
!i||0!=e.length&&e[0]==i||t.disconnect(this._workspace),!t.isConnected()&&e.length>0&&t.connectTo(e[0])},_searchConnectionCandidates:function(t){var e=this._designerModel.getTopics(),i=t.getDraggedTopic(),n=t.getSize?t.getSize().width:0,o=t.getPosition().x>0?0:n,s={x:t.getPosition().x-o,y:t.getPosition().y}
e=e.filter(function(t){var e=i!=t
return e=e&&t!=i,e=e&&!t.areChildrenShrunken()&&!t.isCollapsed(),e=e&&!i.isChildTopic(t)}),e=e.filter(function(t){var e=t.getPosition(),i=e.x+t.getSize().width/2*Math.sign(s.x),n=(s.x-i)*Math.sign(s.x)
return n>0&&n<mindplot.DragConnector.MAX_VERTICAL_CONNECTION_TOLERANCE})
var r=t.getConnectedToTopic()
return e=e.sort(function(t,e){var i=t.getPosition(),n=e.getPosition(),o=this._isVerticallyAligned(t.getSize(),i,s),a=this._isVerticallyAligned(e.getSize(),n,s)
return this._proximityWeight(o,t,s,r)-this._proximityWeight(a,e,s,r)}.bind(this))},_proximityWeight:function(t,e,i,n){var o=e.getPosition()
return(t?0:200)+Math.abs(o.x-i.x)+Math.abs(o.y-i.y)+(n==e?0:100)},_isVerticallyAligned:function(t,e,i){return Math.abs(i.y-e.y)<t.height/2}}),mindplot.DragConnector.MAX_VERTICAL_CONNECTION_TOLERANCE=80,mindplot.TextEditor=new Class({initialize:function(t){this._topic=t},_buildEditor:function(){this._size={width:500,height:100}
var t=new Element("div")
t.setStyles({position:"absolute",display:"none",zIndex:"8",width:"500px",height:"100px"})
var e=new Element("div")
e.setStyles({border:"none",overflow:"auto"}),e.inject(t)
var i=new Element("input",{type:"text",tabindex:"-1",value:""})
i.setStyles({border:"none",background:"transparent"}),i.inject(e)
var n=new Element("div")
n.setStyle("visibility","hidden"),n.inject(t)
var o=new Element("span",{tabindex:"-1"})
return o.setStyle("white-space","nowrap"),o.setStyle("nowrap","nowrap"),o.inject(n),t},_registerEvents:function(t){var e=this._getTextareaElem(),i=this._getSpanElem()
t.addEvent("keydown",function(n){switch(n.key){case"esc":this.close(!1)
break
case"enter":this.close(!0)
break
default:i.innerHTML=e.value
var o=e.value.length+1
e.size=o,i.offsetWidth>parseInt(t.style.width)-100&&(t.style.width=i.offsetWidth+100+"px")}n.stopPropagation()}.bind(this)),t.addEvent("click",function(t){t.stopPropagation()}),t.addEvent("dblclick",function(t){t.stopPropagation()}),t.addEvent("mousedown",function(t){t.stopPropagation()})},isVisible:function(){return $defined(this._containerElem)&&"block"==this._containerElem.getStyle("display")},_updateModel:function(){if(this._topic.getText()!=this._getText()){var t=this._getText(),e=this._topic.getId(),i=mindplot.ActionDispatcher.getInstance()
i.changeTextToTopic([e],t)}},show:function(t){if(!this.isVisible()){var e=this._buildEditor()
e.inject($moo(document.body)),this._containerElem=e,this._registerEvents(e),this._showEditor(t)}},_showEditor:function(t){var e=this._topic
e.getTextShape().setVisibility(!1)
var i=e.getTextShape(),n=i.getFont()
n.size=i.getHtmlFontSize(),n.color=i.getColor(),this._setStyle(n)
var o=$defined(t)?t:e.getText()
this._setText(o)
var s=function(){var i=this._topic.getTextShape()
i.positionRelativeTo(this._containerElem,{position:{x:"left",y:"top"},edge:{x:"left",y:"top"}}),this._containerElem.setStyle("display","block")
var n=e.getSize()
this._setEditorSize(n.width,n.height)
var o=this._getTextareaElem()
o.focus(),this._positionCursor(o,!$defined(t))}.bind(this)
s.delay(10)},_setStyle:function(t){var e=this._getTextareaElem(),i=this._getSpanElem()
$defined(t.font)||(t.font="Arial"),$defined(t.style)||(t.style="normal"),$defined(t.weight)||(t.weight="normal"),$defined(t.size)||(t.size=12),e.style.fontSize=t.size+"px",e.style.fontFamily=t.font,e.style.fontStyle=t.style,e.style.fontWeight=t.weight,e.style.color=t.color,i.style.fontFamily=t.font,i.style.fontStyle=t.style,i.style.fontWeight=t.weight,i.style.fontSize=t.size+"px"},_setText:function(t){var e=this._getTextareaElem()
e.size=t.length+1,this._containerElem.style.width=e.size*parseInt(e.style.fontSize)+100+"px"
var i=this._getSpanElem()
i.innerHTML=t,e.value=t},_getText:function(){return this._getTextareaElem().value},_getTextareaElem:function(){return this._containerElem.getElement("input")},_getSpanElem:function(){return this._containerElem.getElement("span")},_setEditorSize:function(t,e){var i=this._topic.getTextShape(),n=web2d.peer.utils.TransformUtil.workoutScale(i._peer)
this._size={width:t*n.width,height:e*n.height},this._containerElem.style.width=2*this._size.width+"px",this._containerElem.style.height=this._size.height+"px"},_positionCursor:function(t,e){if(t.createTextRange){var i=t.createTextRange(),n=t.value.length
e?(i.move("character",n),i.select()):(i.select(),i.move("character",n))}else e||t.setSelectionRange(0,t.value.length)},close:function(t){this.isVisible()&&((!$defined(t)||t)&&this._updateModel(),this._topic.getTextShape().setVisibility(!0),this._containerElem.dispose(),this._containerElem=null)}}),mindplot.MultilineTextEditor=new Class({Extends:Events,initialize:function(){this._topic=null,this._timeoutId=-1},_buildEditor:function(){var t=new Element("div")
t.setStyles({position:"absolute",display:"none",zIndex:"8",overflow:"hidden",border:"0 none"})
var e=new Element("textarea",{tabindex:"-1",value:"",wrap:"off"})
return e.setStyles({border:"1px gray dashed",background:"rgba(98, 135, 167, .3)",outline:"0 none",resize:"none",overflow:"hidden"}),e.inject(t),t},_registerEvents:function(t){var e=this._getTextareaElem()
e.addEvent("keydown",function(t){switch(t.key){case"esc":this.close(!1)
break
case"enter":if(t.meta||t.control){var i=e.value,n=i.length
e.selectionStart&&(n=e.selectionStart)
var o=i.substring(0,n),s=""
if(n<i.length&&(s=i.substring(n,i.length)),e.value=o+"\n"+s,e.setSelectionRange)e.focus(),e.setSelectionRange(n+1,n+1)
else if(e.createTextRange){var r=e.createTextRange()
r.moveStart("character",n+1),r.select()}}else this.close(!0)}t.stopPropagation()}.bind(this)),e.addEvent("keypress",function(t){t.stopPropagation()}),e.addEvent("keyup",function(t){var e=this._getTextareaElem().value
this.fireEvent("input",[t,e]),this._adjustEditorSize()}.bind(this)),t.addEvent("click",function(t){t.stopPropagation()}),t.addEvent("dblclick",function(t){t.stopPropagation()}),t.addEvent("mousedown",function(t){t.stopPropagation()})},_adjustEditorSize:function(){if(this.isVisible()){var t=this._getTextareaElem(),e=t.value.split("\n"),i=1
e.each(function(t){i<t.length&&(i=t.length)}),t.setAttribute("cols",i),t.setAttribute("rows",e.length),this._containerElem.setStyles({width:i+3+"em",height:t.getSize().height})}},isVisible:function(){return $defined(this._containerElem)&&"block"==this._containerElem.getStyle("display")},_updateModel:function(){if(this._topic.getText()!=this._getText()){var t=this._getText(),e=this._topic.getId(),i=mindplot.ActionDispatcher.getInstance()
i.changeTextToTopic([e],t)}},show:function(t,e){if(this._topic&&this.close(!1),this._topic=t,!this.isVisible()){var i=this._buildEditor()
i.inject($moo(document.body)),this._containerElem=i,this._registerEvents(i),this._showEditor(e)}},_showEditor:function(t){var e=this._topic
e.getTextShape().setVisibility(!1)
var i=e.getTextShape(),n=i.getFont()
n.size=i.getHtmlFontSize(),n.color=i.getColor(),this._setStyle(n)
var o=function(){var i=e.getTextShape()
i.positionRelativeTo(this._containerElem,{position:{x:"left",y:"top"},edge:{x:"left",y:"top"}}),this._containerElem.setStyle("display","block")
var n=$defined(t)?t:e.getText()
this._setText(n)
var o=this._getTextareaElem()
this._positionCursor(o,!$defined(t))}.bind(this)
this._timeoutId=o.delay(10)},_setStyle:function(t){var e=this._getTextareaElem()
$defined(t.font)||(t.font="Arial"),$defined(t.style)||(t.style="normal"),$defined(t.weight)||(t.weight="normal"),$defined(t.size)||(t.size=12)
var i={fontSize:t.size+"px",fontFamily:t.font,fontStyle:t.style,fontWeight:t.weight,color:t.color}
e.setStyles(i),this._containerElem.setStyles(i)},_setText:function(t){var e=this._getTextareaElem()
e.value=t,this._adjustEditorSize()},_getText:function(){return this._getTextareaElem().value},_getTextareaElem:function(){return this._containerElem.getElement("textarea")},_positionCursor:function(t,e){if(t.focus(),e)if(t.createTextRange){var i=t.createTextRange()
i.select(),i.move("character",t.value.length)}else t.setSelectionRange(0,t.value.length)
else if(t.createTextRange){var n=t.createTextRange()
n.move("character",t.value.length)}else t.selectionStart=t.value.length},close:function(t){this.isVisible()&&this._topic&&(clearTimeout(this._timeoutId),(!$defined(t)||t)&&this._updateModel(),this._topic.getTextShape().setVisibility(!0),this._containerElem.dispose(),this._containerElem=null,this._timeoutId=-1),this._topic=null}}),mindplot.TextEditorFactory={},mindplot.TextEditorFactory.getTextEditorFromName=function(t){var e=null
return e="RichTextEditor"==t?mindplot.RichTextEditor:mindplot.TextEditor},mindplot.util.Shape={isAtRight:function(t,e){return $assert(t,"Source can not be null"),$assert(e,"Target can not be null"),t.x<e.x},calculateRectConnectionPoint:function(t,e,i){$assert(t,"rectCenterPoint can  not be null"),$assert(e,"rectSize can  not be null"),$assert($defined(i),"isRight can  not be null")
var n=new core.Point,o=2
return i?n.setValue(t.x-e.width/2+o,t.y):n.setValue(parseFloat(t.x)+e.width/2-o,t.y),n},calculateRelationShipPointCoordinates:function(t,e){var i,n,o=t.getSize(),s=t.getPosition(),r=s.y-e.y,a=s.x-e.x,l=Math.abs(r)<5||Math.abs(a)<5||Math.abs(r-a)<5,d=5
return e.y>s.y+o.height/2?(i=s.y+o.height/2+d,n=l?s.x:s.x-(s.y-i)/(r/a),n>s.x+o.width/2?n=s.x+o.width/2:n<s.x-o.width/2&&(n=s.x-o.width/2)):e.y<s.y-o.height/2?(i=s.y-o.height/2-d,n=l?s.x:s.x-(s.y-i)/(r/a),n>s.x+o.width/2?n=s.x+o.width/2:n<s.x-o.width/2&&(n=s.x-o.width/2)):e.x<s.x-o.width/2?(n=s.x-o.width/2-d,i=l?s.y:s.y-r/a*(s.x-n)):(n=s.x+o.width/2+d,i=l?s.y:s.y-r/a*(s.x-n)),new core.Point(n,i)},calculateDefaultControlPoints:function(t,e){var i=t.y-e.y,n=t.x-e.x,o=Math.abs(n)>.1?n:.1,s=i/o,r=Math.sqrt(i*i+n*n)/3,a=1
t.x>e.x&&(a=-1)
var l=t.x+Math.sqrt(r*r/(1+s*s))*a,d=s*(l-t.x)+t.y,c=e.x+Math.sqrt(r*r/(1+s*s))*a*-1,h=s*(c-e.x)+e.y
return[new core.Point(-t.x+l,-t.y+d),new core.Point(-e.x+c,-e.y+h)]},workoutIncomingConnectionPoint:function(t,e){$assert(e,"sourcePoint can not be null")
var i=t.getPosition(),n=t.getSize(),o=mindplot.util.Shape.isAtRight(e,i),s=mindplot.util.Shape.calculateRectConnectionPoint(i,n,o)
t.getShapeType()==mindplot.model.TopicShape.LINE&&(s.y=s.y+t.getSize().height/2)
var r=mindplot.Topic.CONNECTOR_WIDTH/2
return s.x=o?s.x-r:s.x+r,s.x=Math.ceil(s.x),s.y=Math.ceil(s.y),s}},mindplot.util.FadeEffect=new Class({Extends:Fx,initialize:function(t,e){this.parent({duration:3e3,frames:15,transition:"linear"}),this._isVisible=e,this._element=t,this.addEvent("complete",function(){this._element.each(function(t){t&&t.setVisibility(e)})})},start:function(){this.parent(this._isVisible?0:1,this._isVisible?1:0)},set:function(t){return this._element.each(function(e){e&&e.setOpacity(t)}),this}}),mindplot.persistence.ModelCodeName={BETA:"beta",PELA:"pela",TANGO:"tango"},mindplot.persistence.XMLSerializer_Pela=new Class({toXML:function(t){$assert(t,"Can not save a null mindmap")
var e=core.Utils.createDocument(),i=e.createElement("map"),n=t.getId()
$defined(n)&&i.setAttribute("name",this.rmXmlInv(n))
var o=t.getVersion()
$defined(o)&&i.setAttribute("version",o),e.appendChild(i)
for(var s=t.getBranches(),r=0;r<s.length;r++){var a=s[r],l=this._topicToXML(e,a)
i.appendChild(l)}var d=t.getRelationships()
if(d.length>0)for(var c=0;c<d.length;c++){var h=d[c]
if(null!==t.findNodeById(h.getFromNode())&&null!==t.findNodeById(h.getToNode())){var u=this._relationshipToXML(e,h)
i.appendChild(u)}}return e},_topicToXML:function(t,e){var i=t.createElement("topic")
if(e.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE)i.setAttribute("central","true")
else{var n=e.getPosition()
i.setAttribute("position",n.x+","+n.y)
var o=e.getOrder()
"number"==typeof o&&isFinite(o)&&i.setAttribute("order",o)}var s=e.getText()
$defined(s)&&this._noteTextToXML(t,i,s)
var r=e.getShapeType()
$defined(r)&&(i.setAttribute("shape",r),r==mindplot.model.TopicShape.IMAGE&&i.setAttribute("image",e.getImageSize().width+","+e.getImageSize().height+":"+e.getImageUrl())),e.areChildrenShrunken()&&e.getType()!=mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&i.setAttribute("shrink","true")
var a=e.getId()
i.setAttribute("id",a)
var l="",d=e.getFontFamily()
l+=(d?d:"")+";"
var c=e.getFontSize()
l+=(c?c:"")+";"
var h=e.getFontColor()
l+=(h?h:"")+";"
var u=e.getFontWeight()
l+=(u?u:"")+";"
var p=e.getFontStyle()
l+=(p?p:"")+";",($defined(d)||$defined(c)||$defined(h)||$defined(u)||$defined(p))&&i.setAttribute("fontStyle",l)
var g=e.getBackgroundColor()
$defined(g)&&i.setAttribute("bgColor",g)
var _=e.getBorderColor()
$defined(_)&&i.setAttribute("brColor",_)
var f=e.getMetadata()
$defined(f)&&i.setAttribute("metadata",f)
for(var m=e.getFeatures(),v=0;v<m.length;v++){var T=m[v],E=T.getType(),C=t.createElement(E),S=T.getAttributes()
for(var b in S){var y=S[b]
if("text"==b){var I=t.createCDATASection(this.rmXmlInv(y))
C.appendChild(I)}else C.setAttribute(b,this.rmXmlInv(y))}i.appendChild(C)}for(var P=e.getChildren(),w=0;w<P.length;w++){var O=P[w],N=this._topicToXML(t,O)
i.appendChild(N)}return i},_noteTextToXML:function(t,e,i){if(-1==i.indexOf("\n"))e.setAttribute("text",this.rmXmlInv(i))
else{var n=t.createElement("text"),o=t.createCDATASection(this.rmXmlInv(i))
n.appendChild(o),e.appendChild(n)}},_relationshipToXML:function(t,e){var i=t.createElement("relationship")
i.setAttribute("srcTopicId",e.getFromNode()),i.setAttribute("destTopicId",e.getToNode())
var n=e.getLineType()
if(i.setAttribute("lineType",n),n==mindplot.ConnectionLine.CURVED||n==mindplot.ConnectionLine.SIMPLE_CURVED){if($defined(e.getSrcCtrlPoint())){var o=e.getSrcCtrlPoint()
i.setAttribute("srcCtrlPoint",Math.round(o.x)+","+Math.round(o.y))}if($defined(e.getDestCtrlPoint())){var s=e.getDestCtrlPoint()
i.setAttribute("destCtrlPoint",Math.round(s.x)+","+Math.round(s.y))}}return i.setAttribute("endArrow",e.getEndArrow()),i.setAttribute("startArrow",e.getStartArrow()),i},loadFromDom:function(t,e){console.log("q="),console.log(t),$assert(t,"dom can not be null"),$assert(e,"mapId can not be null")
var i=t.documentElement
console.log("r="),console.log(i),console.log("====="),$assert(i.tagName==mindplot.persistence.XMLSerializer_Pela.MAP_ROOT_NODE,"This seem not to be a map document."),this._idsMap=new Hash
for(var n=i.getAttribute("version"),o=new mindplot.model.Mindmap(e,n),s=i.childNodes,r=0;r<s.length;r++){var a=s[r]
if(1==a.nodeType)switch(a.tagName){case"topic":var l=this._deserializeNode(a,o)
o.addBranch(l)
break
case"relationship":var d=this._deserializeRelationship(a,o)
null!=d&&o.addRelationship(d)}}return this._idsMap=null,o.setId(e),o},_deserializeNode:function(t,e){var i=null!=t.getAttribute("central")?mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE:mindplot.model.INodeModel.MAIN_TOPIC_TYPE,n=t.getAttribute("id")
$defined(n)&&(n=parseInt(n)),this._idsMap.has(n)?n=null:this._idsMap.set(n,t)
var o=e.createNode(i,n),s=t.getAttribute("text")
$defined(s)&&s&&o.setText(s)
var r=t.getAttribute("fontStyle")
if($defined(r)&&r){var a=r.split(";")
a[0]&&o.setFontFamily(a[0]),a[1]&&o.setFontSize(a[1]),a[2]&&o.setFontColor(a[2]),a[3]&&o.setFontWeight(a[3]),a[4]&&o.setFontStyle(a[4])}var l=t.getAttribute("shape")
if($defined(l)&&(o.setShapeType(l),l==mindplot.model.TopicShape.IMAGE)){var d=t.getAttribute("image"),c=d.substring(0,d.indexOf(":")),h=d.substring(d.indexOf(":")+1,d.length)
o.setImageUrl(h)
var u=c.split(",")
o.setImageSize(u[0],u[1])}var p=t.getAttribute("bgColor")
$defined(p)&&o.setBackgroundColor(p)
var g=t.getAttribute("brColor")
$defined(g)&&o.setBorderColor(g)
var _=t.getAttribute("order")
$defined(_)&&"NaN"!=_&&o.setOrder(parseInt(_))
var f=t.getAttribute("shrink")
$defined(f)&&i!=mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&o.setChildrenShrunken(f)
var m=t.getAttribute("position")
if($defined(m)){var v=m.split(",")
o.setPosition(v[0],v[1])}var T=t.getAttribute("metadata")
$defined(T)&&o.setMetadata(T)
for(var E=t.childNodes,C=0;C<E.length;C++){var S=E[C]
if(S.nodeType==Node.ELEMENT_NODE)if("topic"==S.tagName){var b=this._deserializeNode(S,e)
b.connectTo(o)}else if(mindplot.TopicFeature.isSupported(S.tagName)){for(var y=S.attributes,I={},P=0;P<y.length;P++){var w=y.item(P)
I[w.name]=w.value}var O=this._deserializeTextAttr(S)
O&&(I.text=O)
var N=S.tagName,x=mindplot.TopicFeature.createModel(N,I)
o.addFeature(x)}else if("text"==S.tagName){var A=this._deserializeNodeText(S)
o.setText(A)}}return o},_deserializeTextAttr:function(t){var e=t.getAttribute("text")
if($defined(e))e=unescape(e),""==e&&(e=" ")
else for(var i=t.childNodes,n=0;n<i.length;n++){var o=i[n]
o.nodeType==Node.CDATA_SECTION_NODE&&(e=o.nodeValue)}return e},_deserializeNodeText:function(t){for(var e=t.childNodes,i=null,n=0;n<e.length;n++){var o=e[n]
o.nodeType==Node.CDATA_SECTION_NODE&&(i=o.nodeValue)}return i},_deserializeRelationship:function(t,e){{var i=t.getAttribute("srcTopicId"),n=t.getAttribute("destTopicId"),o=t.getAttribute("lineType"),s=t.getAttribute("srcCtrlPoint"),r=t.getAttribute("destCtrlPoint")
t.getAttribute("endArrow"),t.getAttribute("startArrow")}if(i==n)return null
if(null==e.findNodeById(i)||null==e.findNodeById(n))return null
var a=e.createRelationship(i,n)
return a.setLineType(o),$defined(s)&&""!=s&&a.setSrcCtrlPoint(core.Point.fromString(s)),$defined(r)&&""!=r&&a.setDestCtrlPoint(core.Point.fromString(r)),a.setEndArrow("false"),a.setStartArrow("true"),a},rmXmlInv:function(t){if(null==t||void 0==t)return null
for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);(9==n||10==n||13==n||n>=32&&55295>=n||n>=57344&&65533>=n||n>=65536&&1114111>=n)&&(e+=t.charAt(i))}return e}}),mindplot.persistence.XMLSerializer_Pela.MAP_ROOT_NODE="map",mindplot.persistence.XMLSerializer_Tango=new Class({Extends:mindplot.persistence.XMLSerializer_Pela}),mindplot.persistence.Pela2TangoMigrator=new Class({initialize:function(t){this._pelaSerializer=t,this._tangoSerializer=new mindplot.persistence.XMLSerializer_Tango},toXML:function(t){return this._tangoSerializer.toXML(t)},loadFromDom:function(t,e){$assert($defined(e),"mapId can not be null")
var i=this._pelaSerializer.loadFromDom(t,e)
return i.setVersion(mindplot.persistence.ModelCodeName.TANGO),this._fixOrder(i),this._fixPosition(i),i},_fixOrder:function(t){for(var e=t.getBranches()[0],i=e.getChildren(),n=[],o=[],s=0;s<i.length;s++){var r=i[s],a=r.getPosition()
a.x<0?n.push(r):o.push(r)}for(o.sort(function(t,e){return t.getOrder()>e.getOrder()}),n.sort(function(t,e){return t.getOrder()>e.getOrder()}),s=0;s<o.length;s++)o[s].setOrder(2*s)
for(s=0;s<n.length;s++)n[s].setOrder(2*s+1)},_fixPosition:function(t){for(var e=t.getBranches()[0],i=e.getChildren(),n=0;n<i.length;n++){var o=i[n],s=o.getPosition()
this._fixNodePosition(o,s)}},_fixNodePosition:function(t,e){var i=t.getPosition()
i||(i={x:e.x+30,y:e.y},t.setPosition(i.x,i.y))
for(var n=t.getChildren(),o=0;o<n.length;o++){var s=n[o]
this._fixNodePosition(s,i)}}}),mindplot.persistence.XMLSerializer_Beta=new Class({toXML:function(t){$assert(t,"Can not save a null mindmap")
var e=core.Utils.createDocument(),i=e.createElement("map"),n=t.getId()
$defined(n)&&i.setAttribute("name",n),e.appendChild(i)
for(var o=t.getBranches(),s=0;s<o.length;s++){var r=o[s],a=this._topicToXML(e,r)
i.appendChild(a)}return e},_topicToXML:function(t,e){var i=t.createElement("topic")
if(e.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE)i.setAttribute("central",!0)
else{var n=e.getParent()
if(null==n||n.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE){var o=e.getPosition()
i.setAttribute("position",o.x+","+o.y)}else{var s=e.getOrder()
i.setAttribute("order",s)}}var r=e.getText()
$defined(r)&&i.setAttribute("text",r)
var a=e.getShapeType()
$defined(a)&&i.setAttribute("shape",a),e.areChildrenShrunken()&&i.setAttribute("shrink",!0)
var l="",d=e.getFontFamily()
l+=(d?d:"")+";"
var c=e.getFontSize()
l+=(c?c:"")+";"
var h=e.getFontColor()
l+=(h?h:"")+";"
var u=e.getFontWeight()
l+=(u?u:"")+";"
var p=e.getFontStyle()
l+=(p?p:"")+";",($defined(d)||$defined(c)||$defined(h)||$defined(u)||$defined(p))&&i.setAttribute("fontStyle",l)
var g=e.getBackgroundColor()
$defined(g)&&i.setAttribute("bgColor",g)
var _=e.getBorderColor()
$defined(_)&&i.setAttribute("brColor",_)
var f,m=e.getIcons()
for(f=0;f<m.length;f++){var v=m[f],T=this._iconToXML(t,v)
i.appendChild(T)}var E=e.getLinks()
for(f=0;f<E.length;f++){var C=E[f],S=this._linkToXML(t,C)
i.appendChild(S)}var b=e.getNotes()
for(f=0;f<b.length;f++){var y=b[f],I=this._noteToXML(t,y)
i.appendChild(I)}var P=e.getChildren()
for(f=0;f<P.length;f++){var w=P[f],O=this._topicToXML(t,w)
i.appendChild(O)}return i},_iconToXML:function(t,e){var i=t.createElement("icon")
return i.setAttribute("id",e.getIconType()),i},_linkToXML:function(t,e){var i=t.createElement("link")
return i.setAttribute("url",e.getUrl()),i},_noteToXML:function(t,e){var i=t.createElement("note")
return i.setAttribute("text",e.getText()),i},loadFromDom:function(t,e){$assert(t,"Dom can not be null"),$assert(e,"mapId can not be null")
var i=t.documentElement
$assert("parsererror"!=i.nodeName,"Error while parsing: '"+i.childNodes[0].nodeValue),$assert(i.tagName==mindplot.persistence.XMLSerializer_Beta.MAP_ROOT_NODE,"This seem not to be a map document. Root Tag: '"+i.tagName+",',HTML:"+t.innerHTML+",XML:"+core.Utils.innerXML(t))
var n=i.getAttribute("version")
n=$defined(n)?n:mindplot.persistence.ModelCodeName.BETA
for(var o=new mindplot.model.Mindmap(e,n),s=i.childNodes,r=0;r<s.length;r++){var a=s[r]
if(1==a.nodeType){var l=this._deserializeNode(a,o)
o.addBranch(l)}}return o.setId(e),o},_deserializeNode:function(t,e){var i=null!=t.getAttribute("central")?mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE:mindplot.model.INodeModel.MAIN_TOPIC_TYPE,n=e.createNode(i),o=t.getAttribute("text")
$defined(o)&&n.setText(o)
var s=t.getAttribute("order")
$defined(s)&&n.setOrder(parseInt(s))
var r=t.getAttribute("shape")
$defined(r)&&n.setShapeType(r)
var a=t.getAttribute("shrink")
$defined(a)&&n.setChildrenShrunken(a)
var l=t.getAttribute("fontStyle")
if($defined(l)){var d=l.split(";")
d[0]&&n.setFontFamily(d[0]),d[1]&&n.setFontSize(d[1]),d[2]&&n.setFontColor(d[2]),d[3]&&n.setFontWeight(d[3]),d[4]&&n.setFontStyle(d[4])}var c=t.getAttribute("bgColor")
$defined(c)&&n.setBackgroundColor(c)
var h=t.getAttribute("brColor")
$defined(h)&&n.setBorderColor(h)
var u=t.getAttribute("position")
if($defined(u)){var p=u.split(",")
n.setPosition(p[0],p[1])}for(var g=t.childNodes,_=0;_<g.length;_++){var f=g[_]
if(1==f.nodeType)if($assert("topic"==f.tagName||"icon"==f.tagName||"link"==f.tagName||"note"==f.tagName,"Illegal node type:"+f.tagName),"topic"==f.tagName){var m=this._deserializeNode(f,e)
m.connectTo(n)}else if("icon"==f.tagName){var v=this._deserializeIcon(f,n)
n.addFeature(v)}else if("link"==f.tagName){var T=this._deserializeLink(f,n)
n.addFeature(T)}else if("note"==f.tagName){var E=this._deserializeNote(f,n)
n.addFeature(E)}}return n},_deserializeIcon:function(t){var e=t.getAttribute("id")
return e=e.replace("images/","icons/legacy/"),mindplot.TopicFeature.createModel(mindplot.TopicFeature.Icon.id,{id:e})},_deserializeLink:function(t){return mindplot.TopicFeature.createModel(mindplot.TopicFeature.Link.id,{url:t.getAttribute("url")})},_deserializeNote:function(t){var e=t.getAttribute("text")
return mindplot.TopicFeature.createModel(mindplot.TopicFeature.Note.id,{text:null==e?" ":e})}}),mindplot.persistence.XMLSerializer_Beta.MAP_ROOT_NODE="map",mindplot.persistence.Beta2PelaMigrator=new Class({initialize:function(t){this._betaSerializer=t,this._pelaSerializer=new mindplot.persistence.XMLSerializer_Pela},toXML:function(t){return this._pelaSerializer.toXML(t)},loadFromDom:function(t,e){$assert($defined(e),"mapId can not be null")
var i=this._betaSerializer.loadFromDom(t,e)
i.setVersion(mindplot.persistence.ModelCodeName.PELA)
var n=i.getBranches()
return n.each(function(t){this._fixPosition(t)}.bind(this)),i},_fixPosition:function(t){var e=t.getPosition(),i=e.x>0
t.getChildren().each(function(t){t.getPosition()||t.setPosition(e.x+(50*i?1:-1),e.y),this._fixPosition(t)}.bind(this))}}),mindplot.persistence.XMLSerializerFactory={},mindplot.persistence.XMLSerializerFactory.getSerializerFromMindmap=function(t){return mindplot.persistence.XMLSerializerFactory.getSerializer(t.getVersion())},mindplot.persistence.XMLSerializerFactory.getSerializerFromDocument=function(t){var e=t.documentElement
return mindplot.persistence.XMLSerializerFactory.getSerializer(e.getAttribute("version"))},mindplot.persistence.XMLSerializerFactory.getSerializer=function(t){$defined(t)||(t=mindplot.persistence.ModelCodeName.BETA)
for(var e=mindplot.persistence.XMLSerializerFactory._codeNames,i=!1,n=null,o=0;o<e.length;o++)if(i){var s=e[o].migrator
n=new s(n)}else i=e[o].codeName==t,i&&(n=new e[o].serializer)
return n},mindplot.persistence.XMLSerializerFactory._codeNames=[{codeName:mindplot.persistence.ModelCodeName.BETA,serializer:mindplot.persistence.XMLSerializer_Beta,migrator:function(){}},{codeName:mindplot.persistence.ModelCodeName.PELA,serializer:mindplot.persistence.XMLSerializer_Pela,migrator:mindplot.persistence.Beta2PelaMigrator},{codeName:mindplot.persistence.ModelCodeName.TANGO,serializer:mindplot.persistence.XMLSerializer_Tango,migrator:mindplot.persistence.Pela2TangoMigrator}],mindplot.PersistenceManager=new Class({Static:{loadFromDom:function(t,e){$assert(t,"mapId can not be null"),$assert(e,"mapDom can not be null")
var i=mindplot.persistence.XMLSerializerFactory.getSerializerFromDocument(e)
return i.loadFromDom(e,t)}},initialize:function(){},save:function(t,e,i,n,o){console.log("hello from console"),console.log(t),$assert(t,"mindmap can not be null"),$assert(e,"editorProperties can not be null")
var s=t.getId()
$assert(s,"mapId can not be null")
var r=mindplot.persistence.XMLSerializerFactory.getSerializerFromMindmap(t),a=r.toXML(t)
console.log("R========================"),console.log(a),console.log("END R ===================")
var l=core.Utils.innerXML(a),d=JSON.encode(e)
try{this.saveMapXml(s,l,d,i,n,o)}catch(c){console.log(this),console.log(c),n.onError(this._buildError())}n.onSuccess()},load:function(t,e){return $assert(t,"mapId can not be null"),mindplot.PersistenceManager.loadFromDom(t,this.loadMapDom(e))},discardChanges:function(t){throw new Error("Method must be implemented")},loadMapDom:function(t){throw new Error("Method must be implemented")},saveMapXml:function(t,e,i,n,o,s){throw new Error("Method must be implemented")},unlockMap:function(t){throw new Error("Method must be implemented")}}),mindplot.PersistenceManager.init=function(t){mindplot.PersistenceManager._instance=t},mindplot.PersistenceManager.getInstance=function(){return mindplot.PersistenceManager._instance},mindplot.RESTPersistenceManager=new Class({Extends:mindplot.PersistenceManager,initialize:function(t){this.parent(),$assert(t.documentUrl,"documentUrl can not be null"),$assert(t.revertUrl,"revertUrl can not be null"),$assert(t.lockUrl,"lockUrl can not be null"),$assert(t.session,"session can not be null"),$assert(t.timestamp,"timestamp can not be null"),this.documentUrl=t.documentUrl,this.revertUrl=t.revertUrl,this.lockUrl=t.lockUrl,this.timestamp=t.timestamp,this.session=t.session},saveMapXml:function(t,e,i,n,o,s){var r={id:t,xml:e,properties:i},a=this,l="minor="+!n
if(l=l+"&timestamp="+this.timestamp,l=l+"&session="+this.session,!a.onSave){a.onSave=!0,a.clearTimeout=setTimeout(function(){a.clearTimeout=null,a.onSave=!1},1e4)
var d=new Request({url:this.documentUrl.replace("{id}",t)+"?"+l,method:"put",async:!s,onSuccess:function(t,e){a.timestamp=t,o.onSuccess()},onException:function(t,e){o.onError(a._buildError())},onComplete:function(){a.clearTimeout&&clearTimeout(a.clearTimeout),a.onSave=!1},onFailure:function(t){var e=t.responseText,i={severity:"SEVERE",message:$msg("SAVE_COULD_NOT_BE_COMPLETED")},n=this.getHeader("Content-Type")
if(null!=n&&-1!=n.indexOf("application/json")){var s=null
try{s=JSON.decode(e),s=s.globalSeverity?s:null}catch(r){}i=a._buildError(s)}else 405==this.status&&(i={severity:"SEVERE",message:$msg("SESSION_EXPIRED")})
o.onError(i),a.onSave=!1},headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"},emulation:!1,urlEncoded:!1})
d.put(JSON.encode(r))}},discardChanges:function(t){var e=new Request({url:this.revertUrl.replace("{id}",t),async:!1,method:"post",onSuccess:function(){},onException:function(){},onFailure:function(){},headers:{"Content-Type":"application/json; charset=utf-8",Accept:"application/json"},emulation:!1,urlEncoded:!1})
e.post()},unlockMap:function(t){var e=t.getId(),i=new Request({url:this.lockUrl.replace("{id}",e),async:!1,method:"put",onSuccess:function(){},onException:function(){},onFailure:function(){},headers:{"Content-Type":"text/plain"},emulation:!1,urlEncoded:!1})
i.put("false")},_buildError:function(t){var e=t?t.globalErrors[0]:null,i=t?t.globalSeverity:null
return e||(e=$msg("SAVE_COULD_NOT_BE_COMPLETED")),i||(i="INFO"),{severity:i,message:e}},loadMapDom:function(t){var e=new DOMParser
return e.parseFromString(t,"text/xml")}}),mindplot.LocalStorageManager=new Class({Extends:mindplot.PersistenceManager,initialize:function(t,e){this.parent(),this.documentUrl=t,this.forceLoad=e},saveMapXml:function(t,e,i,n,o){mapAdapter.save(e)},discardChanges:function(t){alert("Discard changes in local storage manager"),localStorage.removeItem(t+"-xml")},loadMapDom:function(t){var e=t,i=new DOMParser
return i.parseFromString(e,"text/xml")},unlockMap:function(t){}}),mindplot.EditorProperties=new Class({initialize:function(){this._zoom=0,this._position=0},setZoom:function(t){this._zoom=t},getZoom:function(){return this._zoom},asProperties:function(){return"zoom="+this._zoom+"\n"}}),mindplot.IconGroup=new Class({initialize:function(t,e){$assert($defined(t),"topicId can not be null"),$assert($defined(e),"iconSize can not be null"),this._icons=[],this._group=new web2d.Group({width:0,height:e,x:0,y:0,coordSizeWidth:0,coordSizeHeight:100}),this._removeTip=new mindplot.IconGroup.RemoveTip(this._group,t),this.seIconSize(e,e),this._registerListeners()},setPosition:function(t,e){this._group.setPosition(t,e)},getPosition:function(){return this._group.getPosition()},getNativeElement:function(){return this._group},getSize:function(){return this._group.getSize()},seIconSize:function(t,e){this._iconSize={width:t,height:e},this._resize(this._icons.length)},addIcon:function(t,e){$defined(t,"icon is not defined"),t.setGroup(this),this._icons.push(t),this._resize(this._icons.length),this._positionIcon(t,this._icons.length-1)
var i=t.getImage()
this._group.appendChild(i),e&&this._removeTip.decorate(this._topicId,t)},_findIconFromModel:function(t){var e=null
if(this._icons.each(function(i){var n=i.getModel()
n.getId()==t.getId()&&(e=i)},this),null==e)throw new Error("Icon can no be found:"+t.getId()+", Icons:"+this._icons)
return e},removeIconByModel:function(t){$assert(t,"featureModel can not be null")
var e=this._findIconFromModel(t)
this._removeIcon(e)},_removeIcon:function(t){$assert(t,"icon can not be null"),this._removeTip.close(0),this._group.removeChild(t.getImage()),this._icons.erase(t),this._resize(this._icons.length),this._icons.each(function(t,e){this._positionIcon(t,e)}.bind(this))},moveToFront:function(){this._group.moveToFront()},_registerListeners:function(){this._group.addEvent("click",function(t){t.stopPropagation()}),this._group.addEvent("dblclick",function(t){t.stopPropagation()})},_resize:function(t){this._group.setSize(t*this._iconSize.width,this._iconSize.height)
var e=mindplot.Icon.SIZE+2*mindplot.IconGroup.ICON_PADDING
this._group.setCoordSize(t*e,e)},_positionIcon:function(t,e){var i=mindplot.Icon.SIZE+2*mindplot.IconGroup.ICON_PADDING
t.getImage().setPosition(i*e+mindplot.IconGroup.ICON_PADDING,mindplot.IconGroup.ICON_PADDING)}}),mindplot.IconGroup.ICON_PADDING=5,mindplot.IconGroup.RemoveTip=new Class({initialize:function(t){$assert(t,"group can not be null"),this._fadeElem=t},show:function(t,e){if($assert(e,"icon can not be null"),this._activeIcon!=e){this._activeIcon&&this.close(0)
var i=e.getPosition(),n=this._buildWeb2d()
n.addEvent("click",function(){e.remove()}),n.addEvent("mouseover",function(){this.show(t,e)}.bind(this)),n.addEvent("mouseout",function(){this.hide()}.bind(this)),n.setPosition(i.x+80,i.y-50),this._fadeElem.appendChild(n),this._activeIcon=e,this._widget=n}else clearTimeout(this._closeTimeoutId)},hide:function(){this.close(200)},close:function(t){if(this._closeTimeoutId&&clearTimeout(this._closeTimeoutId),this._activeIcon){var e=this._widget,i=function(){this._activeIcon=null,this._fadeElem.removeChild(e),this._widget=null,this._closeTimeoutId=null}.bind(this)
$defined(t)&&0!=t?this._closeTimeoutId=i.delay(t):i()}},_buildWeb2d:function(){var t=new web2d.Group({width:10,height:10,x:0,y:0,coordSizeWidth:10,coordSizeHeight:10}),e=new web2d.Rect(0,{x:0,y:0,width:10,height:10,stroke:"0",fillColor:"black"})
t.appendChild(e),e.setCursor("pointer")
var i=new web2d.Rect(0,{x:1,y:1,width:8,height:8,stroke:"1 solid white",fillColor:"gray"})
t.appendChild(i)
var n=new web2d.Line({stroke:"1 solid white"})
n.setFrom(1,1),n.setTo(9,9),t.appendChild(n)
var o=new web2d.Line({stroke:"1 solid white"})
return o.setFrom(1,9),o.setTo(9,1),t.appendChild(o),t.addEvent("mouseover",function(){i.setFill("#CC0033")}),t.addEvent("mouseout",function(){i.setFill("gray")}),t.setSize(50,50),t},decorate:function(t,e){e.__remove||(e.addEvent("mouseover",function(){this.show(t,e)}.bind(this)),e.addEvent("mouseout",function(){this.hide()}.bind(this)),e.__remove=!0)}}),mindplot.Icon=new Class({initialize:function(t){$assert(t,"topic can not be null"),this._image=new web2d.Image,this._image.setHref(t),this._image.setSize(mindplot.Icon.SIZE,mindplot.Icon.SIZE)},getImage:function(){return this._image},setGroup:function(t){this._group=t},getGroup:function(){return this._group},getSize:function(){return this._image.getSize()},getPosition:function(){return this._image.getPosition()},addEvent:function(t,e){this._image.addEvent(t,e)},remove:function(){throw"Unsupported operation"}}),mindplot.Icon.SIZE=90,mindplot.LinkIcon=new Class({Extends:mindplot.Icon,initialize:function(t,e,i){$assert(t,"topic can not be null"),$assert(e,"linkModel can not be null"),this.parent(mindplot.LinkIcon.IMAGE_URL),this._linksModel=e,this._topic=t,this._readOnly=i,this._registerEvents()},_registerEvents:function(){this._image.setCursor("pointer"),this._readOnly||this.addEvent("click",function(t){this._topic.showLinkEditor(),t.stopPropagation()}.bind(this)),this._tip=new mindplot.widget.LinkIconTooltip(this)},getModel:function(){return this._linksModel}}),mindplot.LinkIcon.IMAGE_URL="/mindmap/public/vendor/wisemapping/images/links.png",mindplot.NoteIcon=new Class({Extends:mindplot.Icon,initialize:function(t,e,i){$assert(t,"topic can not be null"),this.parent(mindplot.NoteIcon.IMAGE_URL),this._linksModel=e,this._topic=t,this._readOnly=i,this._registerEvents()},_registerEvents:function(){this._image.setCursor("pointer"),this._readOnly||this.addEvent("click",function(t){this._topic.showNoteEditor(),t.stopPropagation()}.bind(this)),this._tip=new mindplot.widget.FloatingTip(this.getImage()._peer._native,{content:function(){var t=new Element("div")
t.setStyles({padding:"5px"})
var e=new Element("div",{text:$msg("NOTE")})
e.setStyles({"font-weight":"bold",color:"black","padding-bottom":"5px",width:"100px"}),e.inject(t)
var i=new Element("div",{text:this._linksModel.getText()})
return i.setStyles({"white-space":"pre-wrap","word-wrap":"break-word"}),i.inject(t),t}.bind(this),html:!0,position:"bottom",arrowOffset:10,center:!0,arrowSize:15,offset:{x:10,y:20},className:"notesTip"})},getModel:function(){return this._linksModel}}),mindplot.NoteIcon.IMAGE_URL="/mindmap/public/vendor/wisemapping/images/notes.png",mindplot.ActionIcon=new Class({Extends:mindplot.Icon,initialize:function(t,e){this.parent(e),this._node=t},getNode:function(){return this._node},setPosition:function(t,e){var i=this.getSize()
this.getImage().setPosition(t-i.width/2,e-i.height/2)},addEvent:function(t,e){this.getImage().addEvent(t,e)},addToGroup:function(t){t.appendChild(this.getImage())},setVisibility:function(t){this.getImage().setVisibility(t)},isVisible:function(){return this.getImage().isVisible()},setCursor:function(t){return this.getImage().setCursor(t)},moveToBack:function(t){return this.getImage().moveToBack(t)},moveToFront:function(t){return this.getImage().moveToFront(t)}}),mindplot.ImageIcon=new Class({Extends:mindplot.Icon,initialize:function(t,e,i){$assert(e,"iconModel can not be null"),$assert(t,"topic can not be null"),this._topicId=t.getId(),this._featureModel=e
var n=e.getIconType(),o=this._getImageUrl(n)
if(this.parent(o),!i){var s=this.getImage()
s.addEvent("click",function(){var t=e.getIconType(),i=this._getNextFamilyIconId(t)
e.setIconType(i)
var n=this._getImageUrl(i)
this._image.setHref(n)}.bind(this)),this._image.setCursor("pointer")}},_getImageUrl:function(t){return"/mindmap/public/vendor/wisemapping/icons/"+t+".png"},getModel:function(){return this._featureModel},_getNextFamilyIconId:function(t){var e=this._getFamilyIcons(t)
$assert(null!=e,"Family Icon not found!")
for(var i=null,n=0;n<e.length&&null==i;n++)if(e[n]==t){i=n==e.length-1?e[0]:e[n+1]
break}return i},_getFamilyIcons:function(t){$assert(null!=t,"id must not be null"),$assert(-1!=t.indexOf("_"),"Invalid icon id (it must contain '_')")
for(var e=null,i=0;i<mindplot.ImageIcon.prototype.ICON_FAMILIES.length;i++){var n=mindplot.ImageIcon.prototype.ICON_FAMILIES[i],o=t.substr(0,t.indexOf("_"))
if(n.id==o){e=n.icons
break}}return e},remove:function(){var t=mindplot.ActionDispatcher.getInstance(),e=this._featureModel.getId(),i=this._topicId
t.removeFeatureFromTopic(i,e)}}),mindplot.ImageIcon.prototype.ICON_FAMILIES=[{id:"face",icons:["face_plain","face_sad","face_crying","face_smile","face_surprise","face_wink"]},{id:"funy",icons:["funy_angel","funy_devilish","funy_glasses","funy_grin","funy_kiss","funy_monkey"]},{id:"conn",icons:["conn_connect","conn_disconnect"]},{id:"sport",icons:["sport_basketball","sport_football","sport_golf","sport_raquet","sport_shuttlecock","sport_soccer","sport_tennis"]},{id:"bulb",icons:["bulb_light_on","bulb_light_off"]},{id:"thumb",icons:["thumb_thumb_up","thumb_thumb_down"]},{id:"tick",icons:["tick_tick","tick_cross"]},{id:"onoff",icons:["onoff_clock","onoff_clock_red","onoff_add","onoff_delete","onoff_status_offline","onoff_status_online"]},{id:"money",icons:["money_money","money_dollar","money_euro","money_pound","money_yen","money_coins","money_ruby"]},{id:"time",icons:["time_calendar","time_clock","time_hourglass"]},{id:"number",icons:["number_1","number_2","number_3","number_4","number_5","number_6","number_7","number_8","number_9"]},{id:"chart",icons:["chart_bar","chart_line","chart_curve","chart_pie","chart_organisation"]},{id:"sign",icons:["sign_warning","sign_info","sign_stop","sign_help","sign_cancel"]},{id:"hard",icons:["hard_cd","hard_computer","hard_controller","hard_driver_disk","hard_ipod","hard_keyboard","hard_mouse","hard_printer"]},{id:"soft",icons:["soft_bug","soft_cursor","soft_database_table","soft_database","soft_feed","soft_folder_explore","soft_rss","soft_penguin"]},{id:"arrow",icons:["arrow_up","arrow_down","arrow_left","arrow_right"]},{id:"arrowc",icons:["arrowc_rotate_anticlockwise","arrowc_rotate_clockwise","arrowc_turn_left","arrowc_turn_right"]},{id:"people",icons:["people_group","people_male1","people_male2","people_female1","people_female2"]},{id:"mail",icons:["mail_envelop","mail_mailbox","mail_edit","mail_list"]},{id:"flag",icons:["flag_blue","flag_green","flag_orange","flag_pink","flag_purple","flag_yellow"]},{id:"bullet",icons:["bullet_black","bullet_blue","bullet_green","bullet_orange","bullet_red","bullet_pink","bullet_purple"]},{id:"tag",icons:["tag_blue","tag_green","tag_orange","tag_red","tag_pink","tag_yellow"]},{id:"object",icons:["object_bell","object_clanbomber","object_key","object_pencil","object_phone","object_magnifier","object_clip","object_music","object_star","object_wizard","object_house","object_cake","object_camera","object_palette","object_rainbow"]},{id:"weather",icons:["weather_clear-night","weather_clear","weather_few-clouds-night","weather_few-clouds","weather_overcast","weather_severe-alert","weather_showers-scattered","weather_showers","weather_snow","weather_storm"]},{id:"task",icons:["task_0","task_25","task_50","task_75","task_100"]}],mindplot.model.FeatureModel=new Class({Static:{_nextUUID:function(){return $defined(mindplot.model.FeatureModel._uuid)||(mindplot.model.FeatureModel._uuid=0),mindplot.model.FeatureModel._uuid=mindplot.model.FeatureModel._uuid+1,mindplot.model.FeatureModel._uuid}},initialize:function(t){$assert(t,"type can not be null"),this._id=mindplot.model.FeatureModel._nextUUID(),this._type=t,this._attributes={},this["is"+t.camelCase()+"Model"]=function(){return!0}},getAttributes:function(){return Object.clone(this._attributes)},setAttributes:function(t){for(key in t)this["set"+key.capitalize()](t[key])},setAttribute:function(t,e){$assert(t,"key id can not be null"),this._attributes[t]=e},getAttribute:function(t){return $assert(t,"key id can not be null"),this._attributes[t]},getId:function(){return this._id},setId:function(t){this._id=t},getType:function(){return this._type}}),mindplot.model.IconModel=new Class({Extends:mindplot.model.FeatureModel,initialize:function(t){this.parent(mindplot.model.IconModel.FEATURE_TYPE),this.setIconType(t.id)},getIconType:function(){return this.getAttribute("id")},setIconType:function(t){$assert(t,"iconType id can not be null"),this.setAttribute("id",t)}}),mindplot.model.IconModel.FEATURE_TYPE="icon",mindplot.model.LinkModel=new Class({Extends:mindplot.model.FeatureModel,initialize:function(t){this.parent(mindplot.model.LinkModel.FEATURE_TYPE),this.setUrl(t.url)},getUrl:function(){return this.getAttribute("url")},setUrl:function(t){$assert(t,"url can not be null")
var e=this._fixUrl(t)
this.setAttribute("url",e)
var i=e.contains("mailto:")?"mail":"url"
this.setAttribute("urlType",i)},_fixUrl:function(t){var e=t
return e.contains("http://")||e.contains("https://")||e.contains("mailto://")||(e="http://"+e),e},setUrlType:function(t){$assert(t,"urlType can not be null"),this.setAttribute("urlType",t)}}),mindplot.model.LinkModel.FEATURE_TYPE="link",mindplot.model.NoteModel=new Class({Extends:mindplot.model.FeatureModel,initialize:function(t){this.parent(mindplot.model.NoteModel.FEATURE_TYPE)
var e=t.text?t.text:" "
this.setText(e)},getText:function(){return this.getAttribute("text")},setText:function(t){$assert(t,"text can not be null"),this.setAttribute("text",t)}}),mindplot.model.NoteModel.FEATURE_TYPE="note",mindplot.Command=new Class({initialize:function(){this._id=mindplot.Command._nextUUID()},execute:function(t){throw"execute must be implemented."},undoExecute:function(t){throw"undo must be implemented."},getId:function(){return this._id}}),mindplot.Command._nextUUID=function(){return $defined(mindplot.Command._uuid)||(mindplot.Command._uuid=1),mindplot.Command._uuid=mindplot.Command._uuid+1,mindplot.Command._uuid},mindplot.DesignerActionRunner=new Class({initialize:function(t,e){$assert(t,"commandContext can not be null"),this._undoManager=new mindplot.DesignerUndoManager,this._context=t,this._notifier=e},execute:function(t){$assert(t,"command can not be null"),t.execute(this._context),this._undoManager.enqueue(t),this.fireChangeEvent(),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.DoLayout)},undo:function(){this._undoManager.execUndo(this._context),this.fireChangeEvent(),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.DoLayout)},redo:function(){this._undoManager.execRedo(this._context),this.fireChangeEvent(),mindplot.EventBus.instance.fireEvent(mindplot.EventBus.events.DoLayout)},fireChangeEvent:function(){var t=this._undoManager.buildEvent()
this._notifier.fireEvent("modelUpdate",t)}}),mindplot.DesignerUndoManager=new Class({initialize:function(t){this._undoQueue=[],this._redoQueue=[],this._baseId=0},enqueue:function(t){$assert(t,"Command can  not be null")
var e=this._undoQueue.length
if(t.discardDuplicated&&e>0){var i=this._undoQueue[e-1]
i.discardDuplicated!=t.discardDuplicated&&this._undoQueue.push(t)}else this._undoQueue.push(t)
this._redoQueue=[]},execUndo:function(t){if(this._undoQueue.length>0){var e=this._undoQueue.pop()
this._redoQueue.push(e),e.undoExecute(t)}},execRedo:function(t){if(this._redoQueue.length>0){var e=this._redoQueue.pop()
this._undoQueue.push(e),e.execute(t)}},buildEvent:function(){return{undoSteps:this._undoQueue.length,redoSteps:this._redoQueue.length}},markAsChangeBase:function(){var t=this._undoQueue.length
if(t>0){var e=this._undoQueue[t-1]
this._baseId=e.getId()}else this._baseId=0},hasBeenChanged:function(){var t=!0,e=this._undoQueue.length
if(0==e&&0==this._baseId)t=!1
else if(e>0){var i=this._undoQueue[e-1]
t=this._baseId!=i.getId()}return t}}),mindplot.ControlPoint=new Class({initialize:function(){var t=new web2d.Elipse({width:6,height:6,stroke:"1 solid #6589de",fillColor:"gray",visibility:!1})
t.setCursor("pointer")
var e=new web2d.Elipse({width:6,height:6,stroke:"1 solid #6589de",fillColor:"gray",visibility:!1})
e.setCursor("pointer"),this._controlPointsController=[t,e],this._controlLines=[new web2d.Line({strokeColor:"#6589de",strokeWidth:1,opacity:.3}),new web2d.Line({strokeColor:"#6589de",strokeWidth:1,opacity:.3})],this._isBinded=!1,this._controlPointsController[0].addEvent("mousedown",function(t){this._mouseDown.bind(this)(t,mindplot.ControlPoint.FROM)}.bind(this)),this._controlPointsController[0].addEvent("click",function(t){this._mouseClick.bind(this)(t)}.bind(this)),this._controlPointsController[0].addEvent("dblclick",function(t){this._mouseClick.bind(this)(t)}.bind(this)),this._controlPointsController[1].addEvent("mousedown",function(t){this._mouseDown.bind(this)(t,mindplot.ControlPoint.TO)}.bind(this)),this._controlPointsController[1].addEvent("click",function(t){this._mouseClick.bind(this)(t)}.bind(this)),this._controlPointsController[1].addEvent("dblclick",function(t){this._mouseClick.bind(this)(t)}.bind(this))},setSide:function(t){this._side=t},setLine:function(t){$defined(this._line)&&this._removeLine(),this._line=t,this._createControlPoint(),this._endPoint=[],this._orignalCtrlPoint=[],this._orignalCtrlPoint[0]=this._controls[0].clone(),this._orignalCtrlPoint[1]=this._controls[1].clone(),this._endPoint[0]=this._line.getLine().getFrom().clone(),this._endPoint[1]=this._line.getLine().getTo().clone()},redraw:function(){$defined(this._line)&&this._createControlPoint()},_createControlPoint:function(){this._controls=this._line.getLine().getControlPoints()
var t=this._line.getLine().getFrom()
this._controlPointsController[0].setPosition(this._controls[mindplot.ControlPoint.FROM].x+t.x,this._controls[mindplot.ControlPoint.FROM].y+t.y-3),this._controlLines[0].setFrom(t.x,t.y),this._controlLines[0].setTo(this._controls[mindplot.ControlPoint.FROM].x+t.x+3,this._controls[mindplot.ControlPoint.FROM].y+t.y),t=this._line.getLine().getTo(),this._controlLines[1].setFrom(t.x,t.y),this._controlLines[1].setTo(this._controls[mindplot.ControlPoint.TO].x+t.x+3,this._controls[mindplot.ControlPoint.TO].y+t.y),this._controlPointsController[1].setPosition(this._controls[mindplot.ControlPoint.TO].x+t.x,this._controls[mindplot.ControlPoint.TO].y+t.y-3)},_removeLine:function(){},_mouseDown:function(t,e){return this._isBinded||(this._isBinded=!0,this._mouseMoveFunction=function(t){this._mouseMoveEvent.bind(this)(t,e)}.bind(this),this._workspace.getScreenManager().addEvent("mousemove",this._mouseMoveFunction),this._mouseUpFunction=function(t){this._mouseUp.bind(this)(t,e)}.bind(this),this._workspace.getScreenManager().addEvent("mouseup",this._mouseUpFunction)),t.preventDefault(),t.stop(),!1},_mouseMoveEvent:function(t,e){var i=this._workspace.getScreenManager(),n=i.getWorkspaceMousePosition(t)
if(0==e){var o=mindplot.util.Shape.calculateRelationShipPointCoordinates(this._line.getSourceTopic(),n)
this._line.setFrom(o.x,o.y),this._line.setSrcControlPoint(new core.Point(n.x-o.x,n.y-o.y))}else{var o=mindplot.util.Shape.calculateRelationShipPointCoordinates(this._line.getTargetTopic(),n)
this._line.setTo(o.x,o.y),this._line.setDestControlPoint(new core.Point(n.x-o.x,n.y-o.y))}this._controls[e].x=n.x-o.x,this._controls[e].y=n.y-o.y,this._controlPointsController[e].setPosition(n.x-5,n.y-3),this._controlLines[e].setFrom(o.x,o.y),this._controlLines[e].setTo(n.x-2,n.y),this._line.getLine().updateLine(e)},_mouseUp:function(t,e){this._workspace.getScreenManager().removeEvent("mousemove",this._mouseMoveFunction),this._workspace.getScreenManager().removeEvent("mouseup",this._mouseUpFunction)
var i=mindplot.ActionDispatcher.getInstance()
i.moveControlPoint(this,e),this._isBinded=!1},_mouseClick:function(t){return t.preventDefault(),t.stop(),!1},setVisibility:function(t){t&&(this._controlLines[0].moveToFront(),this._controlLines[1].moveToFront(),this._controlPointsController[0].moveToFront(),this._controlPointsController[1].moveToFront()),this._controlPointsController[0].setVisibility(t),this._controlPointsController[1].setVisibility(t),this._controlLines[0].setVisibility(t),this._controlLines[1].setVisibility(t)},addToWorkspace:function(t){this._workspace=t,t.appendChild(this._controlPointsController[0]),t.appendChild(this._controlPointsController[1]),t.appendChild(this._controlLines[0]),t.appendChild(this._controlLines[1])},removeFromWorkspace:function(t){this._workspace=null,t.removeChild(this._controlPointsController[0]),t.removeChild(this._controlPointsController[1]),t.removeChild(this._controlLines[0]),t.removeChild(this._controlLines[1])},getControlPoint:function(t){return this._controls[t]},getOriginalEndPoint:function(t){return this._endPoint[t]},getOriginalCtrlPoint:function(t){return this._orignalCtrlPoint[t]}}),mindplot.ControlPoint.FROM=0,mindplot.ControlPoint.TO=1,mindplot.EditorOptions={LayoutManager:"OriginalLayout",textEditor:"TextEditor"},mindplot.RelationshipPivot=new Class({initialize:function(t,e){$assert(t,"workspace can not be null"),$assert(e,"designer can not be null"),this._workspace=t,this._designer=e,this._mouseMoveEvent=this._mouseMove.bind(this),this._onClickEvent=this._cleanOnMouseClick.bind(this),this._onTopicClick=this._connectOnFocus.bind(this)},start:function(t,e){if($assert(t,"sourceTopic can not be null"),$assert(e,"targetPos can not be null"),this.dispose(),this._sourceTopic=t,null!=t){this._workspace.enableWorkspaceEvents(!1)
var i=t.getPosition(),n=mindplot.Relationship.getStrokeColor()
this._pivot=new web2d.CurvedLine,this._pivot.setStyle(web2d.CurvedLine.SIMPLE_LINE)
var o=this._calculateFromPosition(i)
this._pivot.setFrom(o.x,o.y),this._pivot.setTo(e.x,e.y),this._pivot.setStroke(2,"solid",n),this._pivot.setDashed(4,2),this._startArrow=new web2d.Arrow,this._startArrow.setStrokeColor(n),this._startArrow.setStrokeWidth(2),this._startArrow.setFrom(i.x,i.y),this._workspace.appendChild(this._pivot),this._workspace.appendChild(this._startArrow),this._workspace.addEvent("mousemove",this._mouseMoveEvent),this._workspace.addEvent("click",this._onClickEvent)
var s=this._designer.getModel(),r=s.getTopics()
r.each(function(t){t.addEvent("ontfocus",this._onTopicClick)}.bind(this))}},dispose:function(){var t=this._workspace
if(this._isActive()){t.removeEvent("mousemove",this._mouseMoveEvent),t.removeEvent("click",this._onClickEvent)
var e=this._designer.getModel(),i=e.getTopics()
i.each(function(t){t.removeEvent("ontfocus",this._onTopicClick)}.bind(this)),t.removeChild(this._pivot),t.removeChild(this._startArrow),t.enableWorkspaceEvents(!0),this._sourceTopic=null,this._pivot=null,this._startArrow=null}},_mouseMove:function(t){var e=this._workspace.getScreenManager(),i=e.getWorkspaceMousePosition(t),n=this._sourceTopic.getPosition(),o=5*Math.sign(i.x-n.x),s=this._calculateFromPosition(i)
this._pivot.setFrom(s.x,s.y),this._pivot.setTo(i.x-o,i.y)
var r=this._pivot.getControlPoints()
return this._startArrow.setFrom(i.x-o,i.y),this._startArrow.setControlPoint(r[1]),t.stopPropagation(),!1},_cleanOnMouseClick:function(t){this.dispose(),t.stopPropagation()},_calculateFromPosition:function(t){var e=this._sourceTopic.getPosition()
this._sourceTopic.getType()==mindplot.model.INodeModel.CENTRAL_TOPIC_TYPE&&(e=mindplot.util.Shape.workoutIncomingConnectionPoint(this._sourceTopic,t))
var i=mindplot.util.Shape.calculateDefaultControlPoints(e,t),n=new core.Point
return n.x=parseInt(i[0].x)+parseInt(e.x),n.y=parseInt(i[0].y)+parseInt(e.y),mindplot.util.Shape.calculateRelationShipPointCoordinates(this._sourceTopic,n)},_connectOnFocus:function(t){var e=this._sourceTopic,i=this._designer.getMindmap()
if(t.getId()!=e.getId()){var n=i.createRelationship(t.getId(),e.getId())
this._designer._actionDispatcher.addRelationship(n)}this.dispose()},_isActive:function(){return null!=this._pivot}}),mindplot.TopicFeature={Icon:{id:mindplot.model.IconModel.FEATURE_TYPE,model:mindplot.model.IconModel,icon:mindplot.ImageIcon},Link:{id:mindplot.model.LinkModel.FEATURE_TYPE,model:mindplot.model.LinkModel,icon:mindplot.LinkIcon},Note:{id:mindplot.model.NoteModel.FEATURE_TYPE,model:mindplot.model.NoteModel,icon:mindplot.NoteIcon},isSupported:function(t){return mindplot.TopicFeature._featuresMetadataById.some(function(e){return e.id==t})},createModel:function(t,e){$assert(t,"type can not be null"),$assert(e,"attributes can not be null")
var i=mindplot.TopicFeature._featuresMetadataById.filter(function(e){return e.id==t})[0].model
return new i(e)},createIcon:function(t,e,i){$assert(t,"topic can not be null"),$assert(e,"model can not be null")
var n=mindplot.TopicFeature._featuresMetadataById.filter(function(t){return t.id==e.getType()})[0].icon
return new n(t,e,i)}},mindplot.TopicFeature._featuresMetadataById=[mindplot.TopicFeature.Icon,mindplot.TopicFeature.Link,mindplot.TopicFeature.Note],mindplot.commands.GenericFunctionCommand=new Class({Extends:mindplot.Command,initialize:function(t,e,i){$assert(t,"commandFunc must be defined"),$assert($defined(e),"topicsIds must be defined"),this.parent(),this._value=i,this._topicsId=e,this._commandFunc=t,this._oldValues=[]},execute:function(t){if(this.applied)throw"Command can not be applied two times in a row."
var e=null
try{e=t.findTopics(this._topicsId)}catch(i){if("changeTextToTopic"!=this._commandFunc.commandType)throw i}null!=e&&e.each(function(t){var e=this._commandFunc(t,this._value)
this._oldValues.push(e)}.bind(this)),this.applied=!0},undoExecute:function(t){if(!this.applied)throw"undo can not be applied."
var e=t.findTopics(this._topicsId)
e.each(function(t,e){this._commandFunc(t,this._oldValues[e])}.bind(this)),this.applied=!1,this._oldValues=[]}}),mindplot.commands.DeleteCommand=new Class({Extends:mindplot.Command,initialize:function(t,e){$assert($defined(e),"topicIds can not be null"),this.parent(),this._relIds=e,this._topicIds=t,this._deletedTopicModels=[],this._deletedRelModel=[],this._parentTopicIds=[]},execute:function(t){var e=this._filterChildren(this._topicIds,t)
e.length>0&&e.each(function(e){e.closeEditors()
var i=e.getModel(),n=this._collectInDepthRelationships(e)
this._deletedRelModel.append(n.map(function(t){return t.getModel().clone()})),n.each(function(e){t.deleteRelationship(e)})
var o=i.clone()
this._deletedTopicModels.push(o)
var s=e.getOutgoingConnectedTopic(),r=null
null!=s&&(r=s.getId()),this._parentTopicIds.push(r),t.deleteTopic(e)},this)
var i=t.findRelationships(this._relIds)
i.length>0&&i.each(function(e){this._deletedRelModel.push(e.getModel().clone()),t.deleteRelationship(e)},this)},undoExecute:function(t){if(this._deletedTopicModels.each(function(e){t.createTopic(e)},this),this._deletedTopicModels.each(function(e,i){var n=t.findTopics(e.getId()),o=this._parentTopicIds[i]
if(o){var s=t.findTopics(o)
t.connect(n[0],s[0])}},this),this._deletedRelModel.each(function(e){t.addRelationship(e)}.bind(this)),this._deletedTopicModels.each(function(e){var i=t.findTopics(e.getId())
i[0].setBranchVisibility(!0)},this),this._deletedTopicModels.length>0){var e=this._deletedTopicModels[0],i=t.findTopics(e.getId())[0]
i.setOnFocus(!0)}this._deletedTopicModels=[],this._parentTopicIds=[],this._deletedRelModel=[]},_filterChildren:function(t,e){var i=e.findTopics(t),n=[]
return i.each(function(e){for(var i=e.getParent(),o=!1;null!=i&&!o&&!(o=t.contains(i.getId()));)i=i.getParent()
o||n.push(e)}),n},_collectInDepthRelationships:function(t){var e=[]
e.append(t.getRelationships())
var i=t.getChildren(),n=i.map(function(t){return this._collectInDepthRelationships(t)},this)
if(e.append(n.flatten()),e.length>0){e=e.sort(function(t,e){return t.getModel().getId()-e.getModel().getId()})
for(var o=[e[0]],s=1;s<e.length;s++)e[s-1]!==e[s]&&o.push(e[s])
e=o}return e}}),mindplot.commands.DragTopicCommand=new Class({Extends:mindplot.Command,initialize:function(t,e,i,n){$assert(t,"topicId must be defined"),this._topicsId=t,$defined(n)&&(this._parentId=n.getId()),this.parent(),this._position=e,this._order=i},execute:function(t){var e=t.findTopics(this._topicsId)[0]
e.setVisibility(!1)
var i=e.getOutgoingConnectedTopic(),n=e.getOrder(),o=e.getPosition()
if($defined(i)&&i!=this._parentId&&t.disconnect(e),null!=this._order?e.setOrder(this._order):null!=this._position?t.moveTopic(e,this._position):$assert("Illegal command state exception."),i!=this._parentId){if($defined(this._parentId)){var s=t.findTopics(this._parentId)[0]
t.connect(e,s)}this._parentId=null,$defined(i)&&(this._parentId=i.getId())}e.setVisibility(!0),this._order=n,this._position=o},undoExecute:function(t){this.execute(t)}}),mindplot.commands.AddTopicCommand=new Class({Extends:mindplot.Command,initialize:function(t,e){$assert(t,"models can not be null"),$assert(null==e||e.length==t.length,"parents and models must have the same size"),this.parent(),this._models=t,this._parentsIds=e},execute:function(t){this._models.each(function(e,i){var n=t.createTopic(e)
if(this._parentsIds){var o=this._parentsIds[i]
if($defined(o)){var s=t.findTopics(o)[0]
t.connect(n,s)}}else t.addTopic(n)
var r=t._designer
r.onObjectFocusEvent(n),n.setOnFocus(!0),n.setVisibility(!0)}.bind(this))},undoExecute:function(t){var e=[]
this._models.each(function(t){e.push(t.clone())}),this._models.each(function(e){var i=e.getId(),n=t.findTopics(i)[0]
t.deleteTopic(n)}.bind(this)),this._models=e}}),mindplot.commands.ChangeFeatureToTopicCommand=new Class({Extends:mindplot.Command,initialize:function(t,e,i){$assert($defined(t),"topicId can not be null"),$assert($defined(e),"featureId can not be null"),$assert($defined(i),"attributes can not be null"),this.parent(),this._topicId=t,this._featureId=e,this._attributes=i},execute:function(t){var e=t.findTopics(this._topicId)[0],i=e.findFeatureById(this._featureId),n=i.getAttributes()
i.setAttributes(this._attributes),this._attributes=n},undoExecute:function(t){this.execute(t)}}),mindplot.commands.RemoveFeatureFromTopicCommand=new Class({Extends:mindplot.Command,initialize:function(t,e){$assert($defined(t),"topicId can not be null"),$assert(e,"iconModel can not be null"),this.parent(),this._topicId=t,this._featureId=e,this._oldFeature=null},execute:function(t){var e=t.findTopics(this._topicId)[0],i=e.findFeatureById(this._featureId)
e.removeFeature(i),this._oldFeature=i},undoExecute:function(t){var e=t.findTopics(this._topicId)[0]
e.addFeature(this._oldFeature),this._oldFeature=null}}),mindplot.commands.AddFeatureToTopicCommand=new Class({Extends:mindplot.Command,initialize:function(t,e,i){$assert($defined(t),"topicId can not be null"),$assert(e,"featureType can not be null"),$assert(i,"attributes can not be null"),this.parent(),this._topicId=t,this._featureType=e,this._attributes=i,this._featureModel=null},execute:function(t){var e=t.findTopics(this._topicId)[0]
if(!this._featureModel){var i=e.getModel()
this._featureModel=i.createFeature(this._featureType,this._attributes)}e.addFeature(this._featureModel)},undoExecute:function(t){var e=t.findTopics(this._topicId)[0]
e.removeFeature(this._featureModel)}}),mindplot.commands.AddRelationshipCommand=new Class({Extends:mindplot.Command,initialize:function(t){$assert(t,"Relationship model can not be null"),this.parent(),this._model=t},execute:function(t){var e=t.addRelationship(this._model)
e.setOnFocus(!0)},undoExecute:function(t){var e=t.findRelationships(this._model.getId())
t.deleteRelationship(e[0])}}),mindplot.commands.MoveControlPointCommand=new Class({Extends:mindplot.Command,initialize:function(t,e){switch($assert(t,"line can not be null"),$assert($defined(e),"point can not be null"),this.parent(),this._ctrlPointControler=t,this._line=t._line,this._controlPoint=this._ctrlPointControler.getControlPoint(e).clone(),this._oldControlPoint=this._ctrlPointControler.getOriginalCtrlPoint(e).clone(),this._originalEndPoint=this._ctrlPointControler.getOriginalEndPoint(e).clone(),e){case 0:this._wasCustom=this._line.getLine().isSrcControlPointCustom(),this._endPoint=this._line.getLine().getFrom().clone()
break
case 1:this._wasCustom=this._line.getLine().isDestControlPointCustom(),this._endPoint=this._line.getLine().getTo().clone()}this._point=e},execute:function(t){var e=this._line.getModel()
switch(this._point){case 0:e.setSrcCtrlPoint(this._controlPoint.clone()),this._line.setFrom(this._endPoint.x,this._endPoint.y),this._line.setIsSrcControlPointCustom(!0),this._line.setSrcControlPoint(this._controlPoint.clone())
break
case 1:e.setDestCtrlPoint(this._controlPoint.clone()),this._wasCustom=this._line.getLine().isDestControlPointCustom(),this._line.setTo(this._endPoint.x,this._endPoint.y),this._line.setIsDestControlPointCustom(!0),this._line.setDestControlPoint(this._controlPoint.clone())}this._line.isOnFocus()&&(this._line._refreshShape(),this._ctrlPointControler.setLine(this._line)),this._line.getLine().updateLine(this._point)},undoExecute:function(t){var e=this._line,i=e.getModel()
switch(this._point){case 0:$defined(this._oldControlPoint)&&(e.setFrom(this._originalEndPoint.x,this._originalEndPoint.y),i.setSrcCtrlPoint(this._oldControlPoint.clone()),e.setSrcControlPoint(this._oldControlPoint.clone()),e.setIsSrcControlPointCustom(this._wasCustom))
break
case 1:$defined(this._oldControlPoint)&&(e.setTo(this._originalEndPoint.x,this._originalEndPoint.y),i.setDestCtrlPoint(this._oldControlPoint.clone()),e.setDestControlPoint(this._oldControlPoint.clone()),e.setIsDestControlPointCustom(this._wasCustom))}this._line.getLine().updateLine(this._point),this._line.isOnFocus()&&(this._ctrlPointControler.setLine(e),e._refreshShape())}}),mindplot.widget.ModalDialogNotifier=new Class({Extends:MooDialog,initialize:function(){this.parent({closeButton:!1,destroyOnClose:!1,autoOpen:!0,useEscKey:!1,closeOnOverlayClick:!1,title:"",onInitialize:function(t){t.setStyle("opacity",0),this.wrapper.setStyle("display","none"),this.fx=new Fx.Morph(t,{duration:100,transition:Fx.Transitions.Bounce.easeOut})},onBeforeOpen:function(){var t=this._buildPanel()
this.setContent(t),this.overlay=new Overlay(this.options.inject,{duration:this.options.duration}),this.options.closeOnOverlayClick&&this.overlay.addEvent("click",this.close.bind(this)),this.overlay.open(),this.fx.start({"margin-top":[-200,-100],opacity:[0,1]}).chain(function(){this.fireEvent("show"),this.wrapper.setStyle("display","block")}.bind(this))},onBeforeClose:function(){this.fx.start({"margin-top":[-100,0],opacity:0,duration:200}).chain(function(){this.wrapper.setStyle("display","none"),this.fireEvent("hide")}.bind(this))}}),this.message=null},show:function(t,e){$assert(t,"message can not be null"),this._messsage=t,this.options.title=$defined(e)?e:"Outch!!. An unexpected error has occurred",this.open()},destroy:function(){this.parent(),this.overlay.destroy()},_buildPanel:function(){var t=new Element("div")
t.setStyles({"text-align":"center",width:"400px"})
var e=new Element("p",{text:this._messsage})
return e.inject(t),t}})
var dialogNotifier=new mindplot.widget.ModalDialogNotifier
$notifyModal=dialogNotifier.show.bind(dialogNotifier),mindplot.widget.ToolbarNotifier=new Class({initialize:function(){var t=$moo("headerNotifier")
t&&(this._effect=new Fx.Elements(t,{onComplete:function(){t.setStyle("display","none")}.bind(this),link:"cancel",duration:8e3,transition:Fx.Transitions.Expo.easeInOut}))},logError:function(t){this.logMessage(t,mindplot.widget.ToolbarNotifier.MsgKind.ERROR)},hide:function(){},logMessage:function(t,e){$assert(t,"msg can not be null")
var i=$moo("headerNotifier")
i&&(i.set("text",t),i.setStyle("display","block"),i.position({relativeTo:$moo("header"),position:"upperCenter",edge:"centerTop"}),!$defined(e)||e?this._effect.start({0:{opacity:[1,0]}}):(i.setStyle("opacity","1"),this._effect.pause()))}}),mindplot.widget.ToolbarNotifier.MsgKind={INFO:1,WARNING:2,ERROR:3,FATAL:4}
var toolbarNotifier=new mindplot.widget.ToolbarNotifier
$notify=toolbarNotifier.logMessage.bind(toolbarNotifier),mindplot.widget.ToolbarItem=new Class({Implements:[Events],initialize:function(t,e,i){$assert(t,"buttonId can not be null"),$assert(e,"fn can not be null"),this._buttonId=t,this._fn=e,this._options=i,this._enable=!1,this.enable()},_registerTip:function(){return new mindplot.widget.FloatingTip($moo(this._buttonId),{html:!1,position:"bottom",arrowOffset:5,center:!0,arrowSize:5,showDelay:500,hideDelay:0,className:"toolbarTip",motionOnShow:!1,motionOnHide:!1,motion:0,distance:0,preventHideOnOver:!1})},getButtonElem:function(){var t=$moo(this._buttonId)
return $assert(t,"Could not find element for "+this._buttonId),t}.protect(),getButtonId:function(){return this._buttonId},show:function(){this.fireEvent("show")},hide:function(){this.fireEvent("hide")},isTopicAction:function(){return this._options.topicAction},isRelAction:function(){return this._options.relAction},disable:function(){var t=this.getButtonElem()
this._enable&&(t.removeEvent("click",this._fn),t.removeClass("buttonOn"),t.addClass("buttonOff"),this._enable=!1)},enable:function(){var t=this.getButtonElem()
this._enable||(t.addEvent("click",this._fn),t.removeClass("buttonOff"),t.addClass("buttonOn"),this._enable=!0)},getTip:function(){return this._tip}.protect()}),mindplot.widget.ToolbarPaneItem=new Class({Extends:mindplot.widget.ToolbarItem,initialize:function(t,e){$assert(t,"buttonId can not be null"),$assert(e,"model can not be null"),this._model=e
var i=function(){this.isVisible()?this.hide():this.show()}.bind(this)
this.parent(t,i,{topicAction:!0,relAction:!1}),this._panelElem=this._init(),this._visible=!1},_init:function(){var t=this.buildPanel()
t.setStyle("cursor","default")
var e=this.getButtonElem(),i=this
return this._tip=new mindplot.widget.FloatingTip(e,{html:!0,position:"bottom",arrowOffset:5,center:!0,arrowSize:7,showDelay:0,hideDelay:0,content:function(){return i._updateSelectedItem()}.bind(this),className:"toolbarPaneTip",motionOnShow:!1,motionOnHide:!1,motion:0,distance:0,showOn:"xxxx",hideOn:"xxxx",preventHideOnOver:!0,offset:{x:-4,y:0}}),this._tip.addEvent("hide",function(){this._visible=!1}.bind(this)),this._tip.addEvent("show",function(){this._visible=!0}.bind(this)),t},getModel:function(){return this._model},getPanelElem:function(){return this._panelElem}.protect(),show:function(){this.isVisible()||(this.parent(),this._tip.show(this.getButtonElem()),this.getButtonElem().className="buttonExtActive")},hide:function(){this.isVisible()&&(this.parent(),this._tip.hide(this.getButtonElem()),this.getButtonElem().className="buttonExtOn")},isVisible:function(){return this._visible},disable:function(){this.hide()
var t=this.getButtonElem()
this._enable&&(t.removeEvent("click",this._fn),t.removeClass("buttonExtOn"),t.removeClass("buttonOn"),t.addClass("buttonExtOff"),this._enable=!1)},enable:function(){var t=this.getButtonElem()
this._enable||(t.addEvent("click",this._fn),t.removeClass("buttonExtOff"),t.addClass("buttonExtOn"),this._enable=!0)},buildPanel:function(){throw"Method must be implemented"}.protect()}),mindplot.widget.NoteEditor=new Class({Extends:MooDialog,initialize:function(t){$assert(t,"model can not be null")
var e=this._buildPanel(t)
this.parent({closeButton:!0,destroyOnClose:!0,title:$msg("NOTE"),onInitialize:function(t){t.setStyle("opacity",0),this.fx=new Fx.Morph(t,{duration:600,transition:Fx.Transitions.Bounce.easeOut})},onBeforeOpen:function(){this.overlay=new Overlay(this.options.inject,{duration:this.options.duration}),this.options.closeOnOverlayClick&&this.overlay.addEvent("click",this.close.bind(this)),this.overlay.open(),this.fx.start({"margin-top":[-200,-100],opacity:[0,1]}).chain(function(){this.fireEvent("show")}.bind(this))},onBeforeClose:function(){this.fx.start({"margin-top":[-100,0],opacity:0}).chain(function(){this.fireEvent("hide")}.bind(this)),this.overlay.destroy()}}),this.setContent(e)},_buildPanel:function(t){var e=new Element("div"),i=new Element("form",{action:"none",id:"noteFormId"}),n=new Element("textarea",{placeholder:$msg("WRITE_YOUR_TEXT_HERE"),required:!0,autofocus:"autofocus"})
null!=t.getValue()&&(n.value=t.getValue()),n.setStyles({width:"100%",height:80,resize:"none"}),n.inject(i),i.addEvent("submit",function(e){e.preventDefault(),e.stopPropagation(),n.value&&t.setValue(n.value),this.close()}.bind(this))
var o=new Element("div").setStyles({paddingTop:5,textAlign:"right"}),s=new Element("input",{type:"submit",value:$msg("ACCEPT"),"class":"btn-primary"})
if(s.inject(o),$defined(t.getValue())){var r=new Element("input",{type:"button",value:$msg("REMOVE"),"class":"btn-primary"})
r.setStyle("margin","5px"),r.inject(o),r.addEvent("click",function(){t.setValue(null),this.close()}.bind(this)),o.inject(i)}var a=new Element("input",{type:"button",value:$msg("CANCEL"),"class":"btn-secondary"})
return a.setStyle("margin","5px"),a.inject(o),a.addEvent("click",function(){this.close()}.bind(this)),o.inject(i),e.addEvent("keydown",function(t){t.stopPropagation()}),i.inject(e),e},show:function(){this.open()}}),mindplot.widget.LinkEditor=new Class({Extends:MooDialog,initialize:function(t){$assert(t,"model can not be null")
var e=this._buildPanel(t)
this.parent({closeButton:!0,destroyOnClose:!0,title:$msg("LINK"),onInitialize:function(t){t.setStyle("opacity",0),this.fx=new Fx.Morph(t,{duration:600,transition:Fx.Transitions.Bounce.easeOut})},onBeforeOpen:function(){this.overlay=new Overlay(this.options.inject,{duration:this.options.duration}),this.options.closeOnOverlayClick&&this.overlay.addEvent("click",this.close.bind(this)),this.overlay.open(),this.fx.start({"margin-top":[-200,-100],opacity:[0,1]}).chain(function(){this.fireEvent("show")}.bind(this))},onBeforeClose:function(){this.fx.start({"margin-top":[-100,0],opacity:0}).chain(function(){this.fireEvent("hide")}.bind(this)),this.overlay.destroy()}}),this.setContent(e)},_buildPanel:function(t){var e=new Element("div")
e.setStyle("padding-top","15px")
var i=new Element("form",{action:"none",id:"linkFormId"}),n=new Element("select")
n.setStyles({margin:"5px"}),new Element("option",{text:"URL"}).inject(n),n.inject(i)
var o=new Element("input",{placeholder:"http://www.example.com/",type:Browser.ie?"text":"url",required:!0,autofocus:"autofocus"})
null!=t.getValue()&&(o.value=t.getValue()),o.setStyles({width:"55%",margin:"0px 10px"}),o.inject(i)
var s=new Element("input",{type:"button",value:$msg("OPEN_LINK")})
s.inject(i),s.addEvent("click",function(){window.open(o.value,"_blank","status=1,width=700,height=450,resizable=1")}),i.addEvent("submit",function(e){e.stopPropagation(),e.preventDefault(),null!=o.value&&""!=o.value.trim()&&t.setValue(o.value),this.close()}.bind(this))
var r=new Element("div").setStyles({paddingTop:5,textAlign:"center"}),a=new Element("input",{type:"submit",value:$msg("ACCEPT"),"class":"btn-primary"})
if(a.inject(r),$defined(t.getValue())){var l=new Element("input",{type:"button",value:$msg("REMOVE"),"class":"btn-primary"})
l.setStyle("margin","5px"),l.inject(r),l.addEvent("click",function(e){t.setValue(null),e.stopPropagation(),this.close()}.bind(this)),r.inject(i)}var d=new Element("input",{type:"button",value:$msg("CANCEL"),"class":"btn-secondary"})
return d.setStyle("margin","5px"),d.inject(r),d.addEvent("click",function(){this.close()}.bind(this)),r.inject(i),e.addEvent("keydown",function(t){t.stopPropagation()}),i.inject(e),e},show:function(){this.open()}}),mindplot.widget.FloatingTip=new Class({Implements:[Options,Events],options:{position:"top",center:!0,content:"title",html:!1,balloon:!0,arrowSize:6,arrowOffset:6,distance:7,motion:40,motionOnShow:!0,motionOnHide:!0,showOn:"mouseenter",hideOn:"mouseleave",showDelay:500,hideDelay:250,className:"floating-tip",offset:{x:0,y:0},preventHideOnOver:!0,fx:{duration:"short"}},initialize:function(t,e){this.setOptions(e),this.boundShow=function(){this.show(t)}.bind(this),this.boundHide=function(){this.hide(t)}.bind(this),["top","right","bottom","left","inside"].contains(this.options.position)||(this.options.position="top"),this.attach(t)},attach:function(t){null===t.retrieve("hasEvents")&&(t.addEvent(this.options.showOn,this.boundShow),t.addEvent(this.options.hideOn,this.boundHide),t.store("hasEvents",!0))},show:function(t){var e=$moo(t).retrieve("floatingtip")
if(e&&1==e.getStyle("opacity"))return clearTimeout(e.retrieve("timeout")),this
var i=this._create(t)
return null==i?this:(t.store("floatingtip",i),this._animate(i,"in"),this.options.preventHideOnOver&&(i.addEvent(this.options.showOn,this.boundShow),i.addEvent(this.options.hideOn,this.boundHide)),this.fireEvent("show",[i,t]),this)},hide:function(t){var e=t.retrieve("floatingtip")
if(!e){if("inside"!=this.options.position)return this
try{t=t.getParent().getParent(),e=t.retrieve("floatingtip")}catch(i){}if(!e)return this}return this._animate(e,"out"),this.fireEvent("hide",[e,t]),this},_create:function(t){var e=this.options,i=e.content,n=e.position
"title"==i&&(i="floatingtitle",t.get("floatingtitle")||t.setProperty("floatingtitle",t.get("title")),t.set("title",""))
var o="string"==typeof i?t.get(i):i(t),s=new Element("div").addClass(e.className).setStyle("margin",0),r=new Element("div").addClass(e.className+"-wrapper").setStyles({margin:0,padding:0,"z-index":s.getStyle("z-index")}).adopt(s)
if(!o)return null
e.html?o.inject(s):s.set("text",o)
var a=document.id(document.body)
if(r.setStyles({position:"absolute",opacity:0,top:0,left:0}).inject(a),e.balloon&&!Browser.ie6){var l=new Element("div").addClass(e.className+"-triangle").setStyles({margin:0,padding:0}),d={"border-color":s.getStyle("background-color"),"border-width":e.arrowSize,"border-style":"solid",width:0,height:0}
switch(n){case"inside":case"top":d["border-bottom-width"]=0
break
case"right":d["border-left-width"]=0,d["float"]="left",s.setStyle("margin-left",e.arrowSize)
break
case"bottom":d["border-top-width"]=0
break
case"left":d["border-right-width"]=0,Browser.ie7?(d.position="absolute",d.right=0):d["float"]="right",s.setStyle("margin-right",e.arrowSize)}switch(n){case"inside":case"top":case"bottom":d["border-left-color"]=d["border-right-color"]="transparent",d["margin-left"]=e.center?r.getSize().x/2-e.arrowSize:e.arrowOffset
break
case"left":case"right":d["border-top-color"]=d["border-bottom-color"]="transparent",d["margin-top"]=e.center?r.getSize().y/2-e.arrowSize:e.arrowOffset}l.setStyles(d).inject(r,"top"==n||"inside"==n?"bottom":"top")}var c=r.getSize(),h=t.getCoordinates(a)
h.right=null==h.right?h.left:h.right,h.bottom=null==h.bottom?h.top:h.bottom,h.height=$defined(h.height)?h.height:0,h.width=$defined(h.width)?h.width:0
var u={x:h.left+e.offset.x,y:h.top+e.offset.y}
if("inside"==n)r.setStyles({width:r.getStyle("width"),height:r.getStyle("height")}),t.setStyle("position","relative").adopt(r),u={x:e.offset.x,y:e.offset.y}
else switch(n){case"top":u.y-=c.y+e.distance
break
case"right":u.x+=h.width+e.distance
break
case"bottom":u.y+=h.height+e.distance
break
case"left":u.x-=c.x+e.distance}if(e.center)switch(n){case"top":case"bottom":u.x+=h.width/2-c.x/2
break
case"left":case"right":u.y+=h.height/2-c.y/2
break
case"inside":u.x+=h.width/2-c.x/2,u.y+=h.height/2-c.y/2}return r.set("morph",e.fx).store("position",u),r.setStyles({top:u.y,left:u.x}),r},_animate:function(t,e){return clearTimeout(t.retrieve("timeout")),t.store("timeout",function(t){var i=this.options,n="in"==e,o={opacity:n?1:0}
if(i.motionOnShow&&n||i.motionOnHide&&!n){var s=t.retrieve("position")
if(!s)return
switch(i.position){case"inside":case"top":o.top=n?[s.y-i.motion,s.y]:s.y-i.motion
break
case"right":o.left=n?[s.x+i.motion,s.x]:s.x+i.motion
break
case"bottom":o.top=n?[s.y+i.motion,s.y]:s.y+i.motion
break
case"left":o.left=n?[s.x-i.motion,s.x]:s.x-i.motion}}t.morph(o),n||t.get("morph").chain(function(){this.dispose()}.bind(t))}.delay("in"==e?this.options.showDelay:this.options.hideDelay,this,t)),this}}),mindplot.widget.LinkIconTooltip=new Class({Extends:mindplot.widget.FloatingTip,initialize:function(t){$assert(t,"linkIcon can not be null"),this.parent(t.getImage()._peer._native,{content:this._buildContent.pass(t,this),html:!0,position:"bottom",arrowOffset:10,center:!0,arrowSize:15,offset:{x:10,y:20},className:"linkTip"})},_buildContent:function(t){var e=new Element("div")
e.setStyles({padding:"5px",width:"100%"})
var i=new Element("div",{text:$msg("LINK")})
i.setStyles({"font-weight":"bold",color:"black","padding-bottom":"5px",width:"100px"}),i.inject(e)
var n=new Element("div",{text:"URL: "+t.getModel().getUrl()})
n.setStyles({"white-space":"pre-wrap","word-wrap":"break-word"}),n.inject(e)
var o=new Element("div")
o.setStyles({width:"100%",textAlign:"right","padding-bottom":"5px","padding-top":"5px"})
var s=new Element("img",{src:"https://api.thumbalizr.com/?url="+t.getModel().getUrl()+"&width=250",img:t.getModel().getUrl(),alt:t.getModel().getUrl()})
s.setStyles({padding:"5px"})
var r=new Element("a",{href:t.getModel().getUrl(),alt:"Open in new window ...",target:"_blank"})
return s.inject(r),r.inject(o),o.inject(e),e}}),mindplot.widget.KeyboardShortcutTooltip=new Class({Extends:mindplot.widget.FloatingTip,initialize:function(t,e){$assert(t,"buttonElem can not be null"),$assert(e,"text can not be null"),this._text=e
var i=t.getChildren(),n=t.id+"Tip",o=new Element("div",{id:n})
i[0].inject(o),o.inject(t),this.parent(o,{content:this._buildContent.pass(t,this),html:!0,position:"bottom",arrowOffset:10,center:!0,arrowSize:3,offset:{x:0,y:-2},className:"keyboardShortcutTip",preventHideOnOver:!1,motionOnShow:!1,motionOnHide:!1,fx:{duration:"100"}}),o.addEvent("click",function(t){o.fireEvent("mouseleave",t)})},_buildContent:function(){var t=new Element("div")
t.setStyles({padding:"3px 0px",width:"100%"})
var e=new Element("div",{text:this._text})
return e.setStyles({width:"100%",textAlign:"center","font-weight":"bold"}),e.inject(t),t}}),mindplot.widget.ColorPalettePanel=new Class({Extends:mindplot.widget.ToolbarPaneItem,initialize:function(t,e,i){this._baseUrl=i,this.parent(t,e),$assert($defined(i),"baseUrl can not be null")},_load:function(){if(!mindplot.widget.ColorPalettePanel._panelContent){Asset.css(this._baseUrl+"/colorPalette.css",{id:"colorPaletteStyle",title:"colorPalette"})
var t,e=new Request({url:this._baseUrl+"/colorPalette.html",method:"get",async:!1,onRequest:function(){},onSuccess:function(e){t=e},onFailure:function(){t="<div>Sorry, your request failed :(</div>"}})
e.send(),mindplot.widget.ColorPalettePanel._panelContent=t}return mindplot.widget.ColorPalettePanel._panelContent},buildPanel:function(){var t=new Element("div",{"class":"toolbarPanel",id:this._buttonId+"colorPalette"})
t.innerHTML=this._load()
var e=t.getElements("div[class=palette-colorswatch]"),i=this.getModel()
return e.each(function(t){t.addEvent("click",function(){var e=t.getStyle("background-color")
i.setValue(e),this.hide()}.bind(this))}.bind(this)),t},_updateSelectedItem:function(){var t=this.getPanelElem(),e=t.getElements("td[class='palette-cell palette-cell-selected']")
e.each(function(t){t.className="palette-cell"})
var i=t.getElements("div[class=palette-colorswatch]"),n=this.getModel(),o=n.getValue()
return i.each(function(t){var e=t.getStyle("background-color")
null!=o&&"r"==o[0]&&(o=o.rgbToHex()),null!=o&&o.toUpperCase()==e.toUpperCase()&&(t.parentNode.className="palette-cell palette-cell-selected")}),t}}),mindplot.widget.ListToolbarPanel=new Class({Extends:mindplot.widget.ToolbarPaneItem,initialize:function(t,e){this.parent(t,e),this._initPanel()},_initPanel:function(){var t=this.getPanelElem().getElements("div")
t.each(function(t){t.addEvent("click",function(e){e.stopPropagation(),this.hide()
var i=$defined(t.getAttribute("model"))?t.getAttribute("model"):t.id
this.getModel().setValue(i)}.bind(this))}.bind(this))},_updateSelectedItem:function(){var t=this.getPanelElem(),e=t.getElements("div"),i=this.getModel().getValue()
return e.each(function(t){var e=$defined(t.getAttribute("model"))?t.getAttribute("model"):t.id
$assert(e,"elemValue can not be null"),t.className=e==i?"toolbarPanelLinkSelectedLink":"toolbarPanelLink"}),t}}),mindplot.widget.FontFamilyPanel=new Class({Extends:mindplot.widget.ListToolbarPanel,initialize:function(t,e){this.parent(t,e)},buildPanel:function(){var t=new Element("div",{"class":"toolbarPanel",id:"fontFamilyPanel"})
return t.innerHTML='<div id="times" model="Times" class="toolbarPanelLink" style="font-family:times;">Times</div><div id="arial"  model="Arial" style="font-family:arial;">Arial</div><div id="tahoma" model="Tahoma" style="font-family:tahoma;">Tahoma</div><div id="verdana" model="Verdana" style="font-family:verdana;">Verdana</div>',t}}),mindplot.widget.FontSizePanel=new Class({Extends:mindplot.widget.ListToolbarPanel,initialize:function(t,e){this.parent(t,e)},buildPanel:function(){var t=new Element("div",{"class":"toolbarPanel",id:"fontSizePanel"})
return t.innerHTML='<div id="small" model="6" style="font-size:8px">Small</div><div id="normal" model="8" style="font-size:12px">Normal</div><div id="large" model="10" style="font-size:15px">Large</div><div id="huge"  model="15" style="font-size:24px">Huge</div>',t}}),mindplot.widget.TopicShapePanel=new Class({Extends:mindplot.widget.ListToolbarPanel,initialize:function(t,e){this.parent(t,e)},buildPanel:function(){var t=new Element("div",{"class":"toolbarPanel",id:"topicShapePanel"})
return t.innerHTML='<div id="rectagle" model="rectagle"><img src="/mindmap/public/vendor/wisemapping/images/shape-rectangle.png" alt="Rectangle"></div><div id="rounded_rectagle" model="rounded rectagle" ><img src="/mindmap/public/vendor/wisemapping/images/shape-rectangle-round.png" alt="Rounded Rectangle"></div><div id="line" model="line"><img src="/mindmap/public/vendor/wisemapping/images/shape-line.png" alt="Line"></div><div id="elipse" model="elipse"><img src="/mindmap/public/vendor/wisemapping/images/shape-circle.png"></div>',t}}),mindplot.widget.IconPanel=new Class({Extends:mindplot.widget.ToolbarPaneItem,initialize:function(t,e){this.parent(t,e)},_updateSelectedItem:function(){return this.getPanelElem()},buildPanel:function(){var t=new Element("div",{"class":"toolbarPanel",id:"IconsPanel"})
t.setStyles({width:240,height:280,padding:5}),t.addEvent("click",function(t){t.stopPropagation()})
for(var e=0,i=0;i<mindplot.ImageIcon.prototype.ICON_FAMILIES.length;i+=1)for(var n=mindplot.ImageIcon.prototype.ICON_FAMILIES[i].icons,o=0;o<n.length;o+=1){var s
e%12==0&&(s=new Element("div").inject(t))
var r=n[o],a=new Element("img",{id:r,src:mindplot.ImageIcon.prototype._getImageUrl(r)})
a.setStyles({width:16,height:16,padding:"0px 2px",cursor:"pointer"}).inject(s)
var l=this,d=this.getModel()
a.addEvent("click",function(t){d.setValue(this.id),l.hide()}.bind(a)),e+=1}return t}}),mindplot.widget.IMenu=new Class({initialize:function(t,e,i){$assert(t,"designer can not be null"),$assert(e,"containerId can not be null"),this._designer=t,this._toolbarElems=[],this._containerId=e,this._mapId=i,this._mindmapUpdated=!1,this._designer.addEvent("modelUpdate",function(){this.setRequireChange(!0)}.bind(this))},clear:function(){this._toolbarElems.each(function(t){t.hide()})},discardChanges:function(t){this.setRequireChange(!1)
var e=mindplot.PersistenceManager.getInstance(),i=t.getMindmap()
e.discardChanges(i.getId()),this.unlockMap(t),window.location.reload()},unlockMap:function(t){var e=t.getMindmap(),i=mindplot.PersistenceManager.getInstance()
i.unlockMap(e)},save:function(t,e,i,n){var o=e.getMindmap(),s=e.getMindmapProperties()
i&&($notify($msg("SAVING")),t.setStyle("cursor","wait"))
var r=this,a=mindplot.PersistenceManager.getInstance()
a.save(o,s,i,{onSuccess:function(){i&&(t.setStyle("cursor","pointer"),$notify($msg("SAVE_COMPLETE"))),r.setRequireChange(!1)},onError:function(e){i&&(t.setStyle("cursor","pointer"),"FATAL"!=e.severity?$notify(e.message):$notifyModal(e.message))}},n)},isSaveRequired:function(){return this._mindmapUpdated},setRequireChange:function(t){this._mindmapUpdated=t}}),mindplot.widget.Menu=new Class({Extends:mindplot.widget.IMenu,initialize:function(t,e,i,n,o){this.parent(t,e,i),o=$defined(o)?o:""
var s=o+"/mindmap/public/vendor/wisemapping/css/widget"
$moo(this._containerId).addEvent("click",function(t){return t.stopPropagation(),!1}),$moo(this._containerId).addEvent("dblclick",function(t){return t.stopPropagation(),!1})
var r=t.getModel(),a=$moo("fontFamily")
if(a){var l={getValue:function(){for(var t=r.filterSelectedTopics(),e=null,i=0;i<t.length;i++){var n=t[i].getFontFamily()
if(null!=e&&e!=n){e=null
break}e=n}return e},setValue:function(e){t.changeFontFamily(e)}}
this._toolbarElems.push(new mindplot.widget.FontFamilyPanel("fontFamily",l)),this._registerTooltip("fontFamily",$msg("FONT_FAMILY"))}var d=$moo("fontSize")
if(d){var c={getValue:function(){for(var t=r.filterSelectedTopics(),e=null,i=0;i<t.length;i++){var n=t[i].getFontSize()
if(null!=e&&e!=n){e=null
break}e=n}return e},setValue:function(e){t.changeFontSize(e)}}
this._toolbarElems.push(new mindplot.widget.FontSizePanel("fontSize",c)),this._registerTooltip("fontSize",$msg("FONT_SIZE"))}var h=$moo("topicShape")
if(h){var u={getValue:function(){for(var t=r.filterSelectedTopics(),e=null,i=0;i<t.length;i++){var n=t[i].getShapeType()
if(null!=e&&e!=n){e=null
break}e=n}return e},setValue:function(e){t.changeTopicShape(e)}}
this._toolbarElems.push(new mindplot.widget.TopicShapePanel("topicShape",u)),this._registerTooltip("topicShape",$msg("TOPIC_SHAPE"))}var p=$moo("topicIcon")
if(p){var g={getValue:function(){return null},setValue:function(e){t.addIconType(e)}}
this._toolbarElems.push(new mindplot.widget.IconPanel("topicIcon",g)),this._registerTooltip("topicIcon",$msg("TOPIC_ICON"))}var _=$moo("topicColor")
if(_){var f={getValue:function(){for(var t=r.filterSelectedTopics(),e=null,i=0;i<t.length;i++){var n=t[i].getBackgroundColor()
if(null!=e&&e!=n){e=null
break}e=n}return e},setValue:function(e){t.changeBackgroundColor(e)}}
this._toolbarElems.push(new mindplot.widget.ColorPalettePanel("topicColor",f,s)),this._registerTooltip("topicColor",$msg("TOPIC_COLOR"))}var m=$moo("topicBorder")
if(m){var v={getValue:function(){for(var t=r.filterSelectedTopics(),e=null,i=0;i<t.length;i++){var n=t[i].getBorderColor()
if(null!=e&&e!=n){e=null
break}e=n}return e},setValue:function(e){t.changeBorderColor(e)}}
this._toolbarElems.push(new mindplot.widget.ColorPalettePanel("topicBorder",v,s)),this._registerTooltip("topicBorder",$msg("TOPIC_BORDER_COLOR"))}var T=$moo("fontColor")
if(T){var E={getValue:function(){for(var t=null,e=r.filterSelectedTopics(),i=0;i<e.length;i++){var n=e[i].getFontColor()
if(null!=t&&t!=n){t=null
break}t=n}return t},setValue:function(e){t.changeFontColor(e)}}
this._toolbarElems.push(new mindplot.widget.ColorPalettePanel("fontColor",E,o)),this._registerTooltip("fontColor",$msg("FONT_COLOR"))}this._addButton("export",!1,!1,function(){var t=new MooDialog.Request("c/iframeWrapper.htm?url=c/maps/"+i+"/exportf",null,{"class":"modalDialog exportModalDialog",closeButton:!0,destroyOnClose:!0,title:$msg("EXPORT")})
t.setRequestOptions({onRequest:function(){t.setContent($msg("LOADING"))}}),MooDialog.Request.active=t}),this._registerTooltip("export",$msg("EXPORT")),this._addButton("print",!1,!1,function(){this.save(b,t,!1)
var e=window.location.href.substring(0,window.location.href.lastIndexOf("c/maps/"))
window.open(e+"c/maps/"+i+"/print")}.bind(this)),this._registerTooltip("print",$msg("PRINT")),this._addButton("zoomIn",!1,!1,function(){t.zoomIn()}),this._registerTooltip("zoomIn",$msg("ZOOM_IN")),this._addButton("zoomOut",!1,!1,function(){t.zoomOut()}),this._registerTooltip("zoomOut",$msg("ZOOM_OUT"))
var C=this._addButton("undoEdition",!1,!1,function(){t.undo()})
C&&C.disable(),this._registerTooltip("undoEdition",$msg("UNDO"),"meta+Z")
var S=this._addButton("redoEdition",!1,!1,function(){t.redo()})
S&&S.disable(),this._registerTooltip("redoEdition",$msg("REDO"),"meta+shift+Z"),S&&C&&t.addEvent("modelUpdate",function(t){t.undoSteps>0?C.enable():C.disable(),t.redoSteps>0?S.enable():S.disable()}.bind(this)),this._addButton("addTopic",!0,!1,function(){t.createSiblingForSelectedNode()}),this._registerTooltip("addTopic",$msg("ADD_TOPIC"),"Enter"),this._addButton("deleteTopic",!0,!0,function(){t.deleteSelectedEntities()}),this._registerTooltip("deleteTopic",$msg("TOPIC_DELETE"),"Delete"),this._addButton("topicLink",!0,!1,function(){t.addLink()}),this._registerTooltip("topicLink",$msg("TOPIC_LINK")),this._addButton("topicRelation",!0,!1,function(e){t.showRelPivot(e)}),this._registerTooltip("topicRelation",$msg("TOPIC_RELATIONSHIP")),this._addButton("topicNote",!0,!1,function(){t.addNote()}),this._registerTooltip("topicNote",$msg("TOPIC_NOTE")),this._addButton("fontBold",!0,!1,function(){t.changeFontWeight()}),this._registerTooltip("fontBold",$msg("FONT_BOLD"),"meta+B"),this._addButton("fontItalic",!0,!1,function(){t.changeFontStyle()}),this._registerTooltip("fontItalic",$msg("FONT_ITALIC"),"meta+I")
var b=$moo("save")
b&&(this._addButton("save",!1,!1,function(){this.save(b,t,!0)}.bind(this)),n||(Element.NativeEvents.unload=1,$moo(window).addEvent("unload",function(){this.isSaveRequired()&&this.save(b,t,!1,!0),this.unlockMap(t)}.bind(this))))
var y=$moo("discard")
y&&(this._addButton("discard",!1,!1,function(){this.discardChanges(t)}.bind(this)),this._registerTooltip("discard",$msg("DISCARD_CHANGES")))
var I=$moo("shareIt")
I&&(this._addButton("shareIt",!1,!1,function(){var t=new MooDialog.Request("c/iframeWrapper?url=c/maps/"+i+"/sharef",null,{"class":"modalDialog shareModalDialog",closeButton:!0,destroyOnClose:!0,title:$msg("COLLABORATE")})
t.setRequestOptions({onRequest:function(){t.setContent($msg("LOADING"))}}),MooDialog.Request.active=t}),this._registerTooltip("shareIt",$msg("COLLABORATE")))
var P=$moo("publishIt")
P&&(this._addButton("publishIt",!1,!1,function(){var t=new MooDialog.Request("c/iframeWrapper?url=c/maps/"+i+"/publishf",null,{"class":"modalDialog publishModalDialog",closeButton:!0,destroyOnClose:!0,title:$msg("PUBLISH")})
t.setRequestOptions({onRequest:function(){t.setContent($msg("LOADING"))}}),MooDialog.Request.active=t}),this._registerTooltip("publishIt",$msg("PUBLISH")))
var w=$moo("history")
w&&(this._addButton("history",!1,!1,function(){var t=new MooDialog.Request("c/iframeWrapper?url=c/maps/"+i+"/historyf",null,{"class":"modalDialog historyModalDialog",closeButton:!0,destroyOnClose:!0,title:$msg("HISTORY")})
t.setRequestOptions({onRequest:function(){t.setContent($msg("LOADING"))}})}),this._registerTooltip("history",$msg("HISTORY"))),this._registerEvents(t)
var O=$moo("keyboardShortcuts")
O&&O.addEvent("click",function(t){var e=new MooDialog.Request("c/keyboard",null,{"class":"modalDialog keyboardModalDialog",closeButton:!0,destroyOnClose:!0,title:$msg("SHORTCUTS")})
e.setRequestOptions({onRequest:function(){e.setContent($msg("LOADING"))}}),MooDialog.Request.active=e,t.preventDefault()})
var N=$moo("tutorialVideo")
if(N){var x=900,A=500,M=screen.width/2-x/2,L=screen.height/2-A/2
N.addEvent("click",function(t){window.open("https://www.youtube.com/tv?vq=medium#/watch?v=rKxZwNKs9cE","_blank","toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=yes, copyhistory=no, width="+x+", height="+A+", top="+L+", left="+M),t.preventDefault()})}},_registerEvents:function(t){this._toolbarElems.each(function(t){t.addEvent("show",function(){this.clear()}.bind(this))}.bind(this)),t.addEvent("onblur",function(){var e=t.getModel().filterSelectedTopics(),i=t.getModel().filterSelectedRelationships()
this._toolbarElems.each(function(t){var n=t.isTopicAction(),o=t.isRelAction();(n||o)&&(n&&0!=e.length||o&&0!=i.length?t.enable():t.disable())})}.bind(this)),t.addEvent("onfocus",function(){var e=t.getModel().filterSelectedTopics(),i=t.getModel().filterSelectedRelationships()
this._toolbarElems.each(function(t){var n=t.isTopicAction(),o=t.isRelAction();(n||o)&&(n&&e.length>0&&t.enable(),o&&i.length>0&&t.enable())})}.bind(this))},_addButton:function(t,e,i,n){var o=null
if($moo(t)){var s=new mindplot.widget.ToolbarItem(t,function(t){n(t),this.clear()}.bind(this),{topicAction:e,relAction:i})
this._toolbarElems.push(s),o=s}return o},_registerTooltip:function(t,e,i){if($moo(t)){var n=e
i&&(i=Browser.Platform.mac?i.replace("meta+",""):i.replace("meta+","ctrl+"),n=n+" ("+i+")"),new mindplot.widget.KeyboardShortcutTooltip($moo(t),n)}}}),mindplot.layout.EventBusDispatcher=new Class({initialize:function(){this.registerBusEvents()},setLayoutManager:function(t){this._layoutManager=t},registerBusEvents:function(){mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeAdded,this._nodeAdded.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeRemoved,this._nodeRemoved.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeResizeEvent,this._nodeResizeEvent.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeMoveEvent,this._nodeMoveEvent.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeDisconnectEvent,this._nodeDisconnectEvent.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeConnectEvent,this._nodeConnectEvent.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.NodeShrinkEvent,this._nodeShrinkEvent.bind(this)),mindplot.EventBus.instance.addEvent(mindplot.EventBus.events.DoLayout,this._doLayout.bind(this))},_nodeResizeEvent:function(t){this._layoutManager.updateNodeSize(t.node.getId(),t.size)},_nodeMoveEvent:function(t){this._layoutManager.moveNode(t.node.getId(),t.position)},_nodeDisconnectEvent:function(t){this._layoutManager.disconnectNode(t.getId())},_nodeConnectEvent:function(t){this._layoutManager.connectNode(t.parentNode.getId(),t.childNode.getId(),t.childNode.getOrder())},_nodeShrinkEvent:function(t){this._layoutManager.updateShrinkState(t.getId(),t.areChildrenShrunken())},_nodeAdded:function(t){0!=t.getId()&&(this._layoutManager.addNode(t.getId(),{width:10,height:10},t.getPosition()),this._layoutManager.updateShrinkState(t.getId(),t.areChildrenShrunken()))},_nodeRemoved:function(t){this._layoutManager.removeNode(t.getId())},_doLayout:function(){this._layoutManager.layout(!0)},getLayoutManager:function(){return this._layoutManager}}),mindplot.layout.ChangeEvent=new Class({initialize:function(t){$assert(!isNaN(t),"id can not be null"),this._id=t,this._position=null,this._order=null},getId:function(){return this._id},getOrder:function(){return this._order},getPosition:function(){return this._position},setOrder:function(t){$assert(!isNaN(t),"value can not be null"),this._order=t},setPosition:function(t){$assert(t,"value can not be null"),this._position=t},toString:function(){return"[order:"+this.getOrder()+", position: {"+this.getPosition().x+","+this.getPosition().y+"}]"}}),mindplot.layout.LayoutManager=new Class({Extends:Events,initialize:function(t,e){$assert($defined(t),"rootNodeId can not be null"),$assert(e,"rootSize can not be null")
var i=i||{x:0,y:0}
this._treeSet=new mindplot.layout.RootedTreeSet,this._layout=new mindplot.layout.OriginalLayout(this._treeSet)
var n=this._layout.createNode(t,e,i,"root")
this._treeSet.setRoot(n),this._events=[]},updateNodeSize:function(t,e){$assert($defined(t),"id can not be null")
var i=this._treeSet.find(t)
i.setSize(e)},updateShrinkState:function(t,e){$assert($defined(t),"id can not be null"),$assert($defined(e),"value can not be null")
var i=this._treeSet.find(t)
return i.setShrunken(e),this},find:function(t){return this._treeSet.find(t)},moveNode:function(t,e){$assert($defined(t),"id cannot be null"),$assert($defined(e),"position cannot be null"),$assert($defined(e.x),"x can not be null"),$assert($defined(e.y),"y can not be null")
var i=this._treeSet.find(t)
i.setPosition(e)},connectNode:function(t,e,i){return $assert($defined(t),"parentId cannot be null"),$assert($defined(e),"childId cannot be null"),$assert($defined(i),"order cannot be null"),this._layout.connectNode(t,e,i),this},disconnectNode:function(t){return $assert($defined(t),"id can not be null"),this._layout.disconnectNode(t),this},addNode:function(t,e,i){$assert($defined(t),"id can not be null")
var n=this._layout.createNode(t,e,i,"topic")
return this._treeSet.add(n),this},removeNode:function(t){$assert($defined(t),"id can not be null")
var e=this._treeSet.find(t)
return this._treeSet.getParent(e)&&this.disconnectNode(t),this._treeSet.remove(t),this},predict:function(t,e,i,n){$assert($defined(t),"parentId can not be null")
var o=this._treeSet.find(t),s=e?this._treeSet.find(e):null,r=o.getSorter(),a=r.predict(this._treeSet,o,s,i,n)
return{order:a[0],position:a[1]}},dump:function(){console.log(this._treeSet.dump())},plot:function(t,e){$assert(t,"containerId cannot be null"),e=e||{width:200,height:200}
var i=10,n=Raphael(t,e.width,e.height)
return n.drawGrid(0,0,e.width,e.height,e.width/i,e.height/i),this._treeSet.plot(n),n},layout:function(t){return this._layout.layout(),this._collectChanges(),(!$moo(t)||t)&&this._flushEvents(),this},_flushEvents:function(){this._events.each(function(t){this.fireEvent("change",t)},this),this._events=[]},_collectChanges:function(t){t||(t=this._treeSet.getTreeRoots()),t.each(function(t){if(t.hasOrderChanged()||t.hasPositionChanged()){var e=t.getId(),i=this._events.some(function(t){return t.id==e})
i||(i=new mindplot.layout.ChangeEvent(e)),i.setOrder(t.getOrder()),i.setPosition(t.getPosition()),t.resetPositionState(),t.resetOrderState(),t.resetFreeState(),this._events.push(i)}this._collectChanges(this._treeSet.getChildren(t))},this)}}),mindplot.layout.Node=new Class({initialize:function(t,e,i,n){$assert("number"==typeof t&&isFinite(t),"id can not be null"),$assert(e,"size can not be null"),$assert(i,"position can not be null"),$assert(n,"sorter can not be null"),this._id=t,this._sorter=n,this._properties={},this.setSize(e),this.setPosition(i),this.setShrunken(!1)},getId:function(){return this._id},setFree:function(t){this._setProperty("free",t)},isFree:function(){return this._getProperty("free")},hasFreeChanged:function(){return this._isPropertyChanged("free")},hasFreeDisplacementChanged:function(){return this._isPropertyChanged("freeDisplacement")},setShrunken:function(t){this._setProperty("shrink",t)},areChildrenShrunken:function(){return this._getProperty("shrink")},setOrder:function(t){$assert("number"==typeof t&&isFinite(t),"Order can not be null. Value:"+t),this._setProperty("order",t)},resetPositionState:function(){var t=this._properties.position
t&&(t.hasChanged=!1)},resetOrderState:function(){var t=this._properties.order
t&&(t.hasChanged=!1)},resetFreeState:function(){var t=this._properties.freeDisplacement
t&&(t.hasChanged=!1)},getOrder:function(){return this._getProperty("order")},hasOrderChanged:function(){return this._isPropertyChanged("order")},hasPositionChanged:function(){return this._isPropertyChanged("position")},hasSizeChanged:function(){return this._isPropertyChanged("size")},getPosition:function(){return this._getProperty("position")},setSize:function(t){$assert($defined(t),"Size can not be null"),this._setProperty("size",Object.clone(t))},getSize:function(){return this._getProperty("size")},setFreeDisplacement:function(t){$assert($defined(t),"Position can not be null"),$assert($defined(t.x),"x can not be null"),$assert($defined(t.y),"y can not be null")
var e=this.getFreeDisplacement(),i={x:e.x+t.x,y:e.y+t.y}
this._setProperty("freeDisplacement",Object.clone(i))},resetFreeDisplacement:function(){this._setProperty("freeDisplacement",{x:0,y:0})},getFreeDisplacement:function(){var t=this._getProperty("freeDisplacement")
return t||{x:0,y:0}},setPosition:function(t){$assert($defined(t),"Position can not be null"),$assert($defined(t.x),"x can not be null"),$assert($defined(t.y),"y can not be null")
var e=this.getPosition();(null==e||Math.abs(e.x-t.x)>2||Math.abs(e.y-t.y)>2)&&this._setProperty("position",t)},_setProperty:function(t,e){var i=this._properties[t]
i||(i={hasChanged:!1,value:null,oldValue:null}),JSON.encode(i.value)!=JSON.encode(e)&&(i.oldValue=i.value,i.value=e,i.hasChanged=!0),this._properties[t]=i},_getProperty:function(t){var e=this._properties[t]
return $defined(e)?e.value:null},_isPropertyChanged:function(t){var e=this._properties[t]
return e?e.hasChanged:!1},getSorter:function(){return this._sorter},toString:function(){return"[id:"+this.getId()+", order:"+this.getOrder()+", position: {"+this.getPosition().x+","+this.getPosition().y+"}, size: {"+this.getSize().width+","+this.getSize().height+"}, shrink:"+this.areChildrenShrunken()+"]"}}),mindplot.layout.RootedTreeSet=new Class({initialize:function(){this._rootNodes=[],console.log(this.dump())},setRoot:function(t){$assert(t,"root can not be null"),this._rootNodes.push(this._decodate(t)),console.log(this.dump())},getTreeRoots:function(){return this._rootNodes},_decodate:function(t){return t._children=[],t},add:function(t){$assert(t,"node can not be null"),$assert(!this.find(t.getId(),!1),"node already exits with this id. Id:"+t.getId()),$assert(!t._children,"node already added"),this._rootNodes.push(this._decodate(t))},remove:function(t){$assert($defined(t),"nodeId can not be null")
var e=this.find(t)
this._rootNodes.erase(e)},connect:function(t,e){$assert($defined(t),"parent can not be null"),$assert($defined(e),"child can not be null")
var i=this.find(t),n=this.find(e,!0)
$assert(!n._parent,"node already connected. Id:"+n.getId()+",previous:"+n._parent),i._children.push(n),n._parent=i,this._rootNodes.erase(n)},disconnect:function(t){$assert($defined(t),"nodeId can not be null")
var e=this.find(t)
$assert(e._parent,"Node is not connected"),e._parent._children.erase(e),this._rootNodes.push(e),e._parent=null},find:function(t,e){$assert($defined(t),"id can not be null")
for(var i=this._rootNodes,n=null,o=0;o<i.length;o++){var s=i[o]
if(n=this._find(t,s))break}return e=$defined(e)?e:!0,$assert(e?n:!0,"node could not be found id:"+t+"\n,RootedTreeSet"+this.dump()),n},_find:function(t,e){if(e.getId()==t)return e
for(var i=null,n=e._children,o=0;o<n.length;o++){var s=n[o]
if(i=this._find(t,s))break}return i},getChildren:function(t){return $assert(t,"node cannot be null"),t._children},getRootNode:function(t){$assert(t,"node cannot be null")
var e=this.getParent(t)
return $defined(e)?this.getRootNode(e):t},getAncestors:function(t){return $assert(t,"node cannot be null"),this._getAncestors(this.getParent(t),[])},_getAncestors:function(t,e){var i=e
return t&&(i.push(t),this._getAncestors(this.getParent(t),i)),i},getSiblings:function(t){if($assert(t,"node cannot be null"),!$defined(t._parent))return[]
var e=t._parent._children.filter(function(e){return e!=t})
return e},hasSinglePathToSingleLeaf:function(t){return $assert(t,"node cannot be null"),this._hasSinglePathToSingleLeaf(t)},_hasSinglePathToSingleLeaf:function(t){var e=this.getChildren(t)
return 1==e.length?this._hasSinglePathToSingleLeaf(e[0]):0==e.length},isStartOfSubBranch:function(t){return this.getSiblings(t).length>0&&1==this.getChildren(t).length},isLeaf:function(t){return $assert(t,"node cannot be null"),0==this.getChildren(t).length},getParent:function(t){return $assert(t,"node cannot be null"),t._parent},dump:function(){for(var t=this._rootNodes,e="",i=0;i<t.length;i++){var n=t[i]
e+=this._dump(n,"")}return e},_dump:function(t,e){for(var i=e+t+"\n",n=this.getChildren(t),o=0;o<n.length;o++){var s=n[o]
i+=this._dump(s,e+"   ")}return i},plot:function(t){for(var e=this._rootNodes,i=0;i<e.length;i++){var n=e[i]
this._plot(t,n)}},_plot:function(t,e,i){var n=this.getChildren(e),o=e.getPosition().x+t.width/2-e.getSize().width/2,s=e.getPosition().y+t.height/2-e.getSize().height/2,r=t.rect(o,s,e.getSize().width,e.getSize().height),a=null==e.getOrder()?"r":e.getOrder(),l=t.text(e.getPosition().x+t.width/2,e.getPosition().y+t.height/2,e.getId()+"["+a+"]")
l.attr("fill","#FFF")
var d=this._rootNodes.contains(e)?"#000":e.isFree()?"#abc":"#c00"
r.attr("fill",d)
var c={x:r.attr("x")-t.width/2+r.attr("width")/2,y:r.attr("y")-t.height/2+r.attr("height")/2},h={width:r.attr("width"),height:r.attr("height")}
r.click(function(){console.log("[id:"+e.getId()+", order:"+e.getOrder()+", position:("+c.x+","+c.y+"), size:"+h.width+"x"+h.height+", freeDisplacement:("+e.getFreeDisplacement().x+","+e.getFreeDisplacement().y+")]")}),l.click(function(){console.log("[id:"+e.getId()+", order:"+e.getOrder()+", position:("+c.x+","+c.y+"), size:"+h.width+"x"+h.height+", freeDisplacement:("+e.getFreeDisplacement().x+","+e.getFreeDisplacement().y+")]")})
for(var u=0;u<n.length;u++){var p=n[u]
this._plot(t,p)}},updateBranchPosition:function(t,e){var i=t.getPosition()
t.setPosition(e)
var n=i.x-e.x,o=i.y-e.y,s=this.getChildren(t)
s.each(function(t){this.shiftBranchPosition(t,n,o)}.bind(this))},shiftBranchPosition:function(t,e,i){var n=t.getPosition()
t.setPosition({x:n.x+e,y:n.y+i})
var o=this.getChildren(t)
o.each(function(t){this.shiftBranchPosition(t,e,i)}.bind(this))},getSiblingsInVerticalDirection:function(t,e){var i=this.getParent(t),n=this.getSiblings(t).filter(function(n){var o=t.getPosition().x>i.getPosition().x?n.getPosition().x>i.getPosition().x:n.getPosition().x<i.getPosition().x,s=0>e?n.getOrder()<t.getOrder():n.getOrder()>t.getOrder()
return s&&o})
return 0>e&&n.reverse(),n},getBranchesInVerticalDirection:function(t,e){var i=this.getRootNode(t),n=this.getChildren(i).filter(function(e){return this._find(t.getId(),e)},this),o=n[0],s=this.getSiblings(o).filter(function(n){var s=t.getPosition().x>i.getPosition().x?n.getPosition().x>i.getPosition().x:n.getPosition().x<i.getPosition().x,r=0>e?n.getOrder()<o.getOrder():n.getOrder()>o.getOrder()
return s&&r},this)
return s}}),mindplot.layout.ChildrenSorterStrategy=new Class({initialize:function(){},computeChildrenIdByHeights:function(t,e){throw"Method must be implemented"},computeOffsets:function(t,e){throw"Method must be implemented"},insert:function(t,e,i,n){throw"Method must be implemented"},detach:function(t,e){throw"Method must be implemented"},predict:function(t,e,i,n,o){throw"Method must be implemented"},verify:function(t,e){throw"Method must be implemented"},getChildDirection:function(t,e){throw"Method must be implemented"},toString:function(){throw"Method must be implemented: print name"}}),mindplot.layout.AbstractBasicSorter=new Class({Extends:mindplot.layout.ChildrenSorterStrategy,computeChildrenIdByHeights:function(t,e){var i={}
return this._computeChildrenHeight(t,e,i),i},_getVerticalPadding:function(){return mindplot.layout.AbstractBasicSorter.INTERNODE_VERTICAL_PADDING},_computeChildrenHeight:function(t,e,i){var n,o=e.getSize().height+2*this._getVerticalPadding(),s=t.getChildren(e)
if(0==s.length||e.areChildrenShrunken())n=o
else{var r=0
s.each(function(e){r+=this._computeChildrenHeight(t,e,i)},this),n=Math.max(o,r)}return i&&(i[e.getId()]=n),n},_getSortedChildren:function(t,e){var i=t.getChildren(e)
return i.sort(function(t,e){return t.getOrder()-e.getOrder()}),i},_getRelativeDirection:function(t,e){var i=e.x-t.x
return i>=0?1:-1}}),mindplot.layout.AbstractBasicSorter.INTERNODE_VERTICAL_PADDING=5,mindplot.layout.AbstractBasicSorter.INTERNODE_HORIZONTAL_PADDING=30,mindplot.layout.BalancedSorter=new Class({Extends:mindplot.layout.AbstractBasicSorter,initialize:function(){},predict:function(t,e,i,n,o){if(o){$assert($defined(n),"position cannot be null for predict in free positioning"),$assert($defined(i),"node cannot be null for predict in free positioning")
var s=t.getRootNode(e),r=this._getRelativeDirection(s.getPosition(),i.getPosition()),a=e.getPosition().x+r*(e.getSize().width/2+i.getSize().width/2+mindplot.layout.BalancedSorter.INTERNODE_HORIZONTAL_PADDING),l=r>0?n.x>=a?n.x:a:n.x<=a?n.x:a
return[0,{x:l,y:n.y}]}var s=t.getRootNode(e)
if(i){$assert($defined(n),"position cannot be null for predict in dragging")
var d=this._getRelativeDirection(s.getPosition(),i.getPosition()),c=this._getRelativeDirection(s.getPosition(),n),h=t.getSiblings(i),u=e==t.getParent(i)
if(0==h.length&&d==c&&u)return[i.getOrder(),i.getPosition()]}if(!n)var p=this._getChildrenForOrder(e,t,0),g=this._getChildrenForOrder(e,t,1)
var _=n?n.x>s.getPosition().x?0:1:p.length-g.length>0?1:0,r=_%2==0?1:-1,f=this._getChildrenForOrder(e,t,_).filter(function(t){return t!=i})
if(0==f.length)return[_,{x:e.getPosition().x+r*(e.getSize().width/2+2*mindplot.layout.BalancedSorter.INTERNODE_HORIZONTAL_PADDING),y:e.getPosition().y}]
var m=null,v=f.getLast()
if(n=n||{x:v.getPosition().x,y:v.getPosition().y+1},f.each(function(t,e){var i=t.getPosition()
n.y>i.y&&(yOffset=t==v?t.getSize().height+2*mindplot.layout.BalancedSorter.INTERNODE_VERTICAL_PADDING:(f[e+1].getPosition().y-t.getPosition().y)/2,m=[t.getOrder()+2,{x:i.x,y:i.y+yOffset}])}),!m){var T=f[0]
m=[n.x>0?0:1,{x:T.getPosition().x,y:T.getPosition().y-T.getSize().height-2*mindplot.layout.BalancedSorter.INTERNODE_VERTICAL_PADDING}]}return m},insert:function(t,e,i,n){var o=this._getChildrenForOrder(e,t,n)
if(0==o.length)return void i.setOrder(n%2)
for(var s=0,r=0;r<o.length;r++){var a=o[r]
s=Math.max(s,a.getOrder()),a.getOrder()>=n&&(s=Math.max(s,a.getOrder()+2),a.setOrder(a.getOrder()+2))}var l=n>s+1?s+2:n
i.setOrder(l)},detach:function(t,e){var i=t.getParent(e),n=this._getChildrenForOrder(i,t,e.getOrder())
n.each(function(t,i){t.getOrder()>e.getOrder()&&t.setOrder(t.getOrder()-2)}),e.setOrder(e.getOrder()%2==0?0:1)},computeOffsets:function(t,e){$assert(t,"treeSet can no be null."),$assert(e,"node can no be null.")
var i=this._getSortedChildren(t,e),n=i.map(function(e){return{id:e.getId(),order:e.getOrder(),width:e.getSize().width,height:this._computeChildrenHeight(t,e)}},this).reverse(),o=0,s=0
n.each(function(t){t.order%2==0?o+=t.height:s+=t.height})
for(var r=o/2,a=s/2,l=0,d={},c=0;c<n.length;c++){var h=n[c].order%2?-1:1
h>0?(r-=n[c].height,l=r):(a-=n[c].height,l=a)
var u=l+n[c].height/2,p=h*(e.getSize().width/2+n[c].width/2+ +mindplot.layout.BalancedSorter.INTERNODE_HORIZONTAL_PADDING)
$assert(!isNaN(p),"xOffset can not be null"),$assert(!isNaN(u),"yOffset can not be null"),d[n[c].id]={x:p,y:u}}return d},verify:function(t,e){for(var i=this._getChildrenForOrder(e,t,e.getOrder()),n=e.getOrder()%2==0?2:1,o=0;o<i.length;o++){var s=0==o&&1==n?1:n*o
$assert(i[o].getOrder()==s,"Missing order elements. Missing order: "+o*n+". Parent:"+e.getId()+",Node:"+i[o].getId())}},getChildDirection:function(t,e){return e.getOrder()%2==0?1:-1},toString:function(){return"Balanced Sorter"},_getChildrenForOrder:function(t,e,i){return this._getSortedChildren(e,t).filter(function(t){return t.getOrder()%2==i%2})},_getVerticalPadding:function(){return mindplot.layout.BalancedSorter.INTERNODE_VERTICAL_PADDING}}),mindplot.layout.BalancedSorter.INTERNODE_VERTICAL_PADDING=5,mindplot.layout.BalancedSorter.INTERNODE_HORIZONTAL_PADDING=30,mindplot.layout.SymmetricSorter=new Class({Extends:mindplot.layout.AbstractBasicSorter,initialize:function(){},predict:function(t,e,i,n,o){var s=this,r=t.getRootNode(e)
if(o){$assert($defined(n),"position cannot be null for predict in free positioning"),$assert($defined(i),"node cannot be null for predict in free positioning")
var a=this._getRelativeDirection(r.getPosition(),e.getPosition()),l=e.getPosition().x+a*(e.getSize().width/2+i.getSize().width/2+mindplot.layout.SymmetricSorter.INTERNODE_HORIZONTAL_PADDING),d=a>0?n.x>=l?n.x:l:n.x<=l?n.x:l
return[0,{x:d,y:n.y}]}if(!i){var c=s._getRelativeDirection(r.getPosition(),e.getPosition()),n={x:e.getPosition().x+c*(e.getSize().width+mindplot.layout.SymmetricSorter.INTERNODE_HORIZONTAL_PADDING),y:e.getPosition().y}
return[t.getChildren(e).length,n]}$assert($defined(n),"position cannot be null for predict in dragging")
var h=this._getRelativeDirection(r.getPosition(),i.getPosition()),u=this._getRelativeDirection(r.getPosition(),n),p=t.getSiblings(i),g=e==t.getParent(i)
if(0==p.length&&h==u&&g)return[i.getOrder(),i.getPosition()]
var _=t.getChildren(e)
if(0==_.length){var n={x:e.getPosition().x+u*(e.getSize().width+mindplot.layout.SymmetricSorter.INTERNODE_HORIZONTAL_PADDING),y:e.getPosition().y}
return[0,n]}for(var f=_.getLast(),m=0;m<_.length;m++){var v=_[m],T=m+1==v.length?null:_[m+1]
if(!T&&n.y>v.getPosition().y){var E=t.getParent(i)&&t.getParent(i).getId()==e.getId()?f.getOrder():f.getOrder()+1,n={x:v.getPosition().x,y:v.getPosition().y+v.getSize().height+2*mindplot.layout.SymmetricSorter.INTERNODE_VERTICAL_PADDING}
return[E,n]}if(T&&n.y>v.getPosition().y&&n.y<T.getPosition().y){if(T.getId()==i.getId()||v.getId()==i.getId())return[i.getOrder(),i.getPosition()]
var E=n.y>i.getPosition().y?T.getOrder()-1:v.getOrder()+1,n={x:v.getPosition().x,y:v.getPosition().y+(T.getPosition().y-v.getPosition().y)/2}
return[E,n]}}var C=_[0],n={x:C.getPosition().x,y:C.getPosition().y-C.getSize().height-2*mindplot.layout.SymmetricSorter.INTERNODE_VERTICAL_PADDING}
return[0,n]},insert:function(t,e,i,n){var o=this._getSortedChildren(t,e)
$assert(n<=o.length,"Order must be continues and can not have holes. Order:"+n)
for(var s=n;s<o.length;s++){var r=o[s]
r.setOrder(s+1)}i.setOrder(n)},detach:function(t,e){var i=t.getParent(e),n=this._getSortedChildren(t,i),o=e.getOrder()
$assert(n[o]===e,"Node seems not to be in the right position")
for(var s=e.getOrder()+1;s<n.length;s++){var r=n[s]
r.setOrder(r.getOrder()-1)}e.setOrder(0)},computeOffsets:function(t,e){$assert(t,"treeSet can no be null."),$assert(e,"node can no be null.")
var i=this._getSortedChildren(t,e),n=i.map(function(e){return{id:e.getId(),order:e.getOrder(),position:e.getPosition(),width:e.getSize().width,height:this._computeChildrenHeight(t,e)}},this).reverse(),o=0
n.each(function(t){o+=t.height})
for(var s=o/2,r={},a=0;a<n.length;a++){s-=n[a].height
var l=t.find(n[a].id),d=this.getChildDirection(t,l),c=s+n[a].height/2,h=d*(n[a].width/2+e.getSize().width/2+mindplot.layout.SymmetricSorter.INTERNODE_HORIZONTAL_PADDING)
$assert(!isNaN(h),"xOffset can not be null"),$assert(!isNaN(c),"yOffset can not be null"),r[n[a].id]={x:h,y:c}}return r},verify:function(t,e){for(var i=this._getSortedChildren(t,e),n=0;n<i.length;n++)$assert(i[n].getOrder()==n,"missing order elements")},getChildDirection:function(t,e){$assert(t,"treeSet can no be null."),$assert(t.getParent(e),"This should not happen")
var i,n=t.getRootNode(e)
if(t.getParent(e)==n)i=Math.sign(n.getPosition().x)
else{var o=t.getParent(e),s=t.getParent(o),r=s.getSorter()
i=r.getChildDirection(t,o)}return i},toString:function(){return"Symmetric Sorter"},_getVerticalPadding:function(){return mindplot.layout.SymmetricSorter.INTERNODE_VERTICAL_PADDING}}),mindplot.layout.SymmetricSorter.INTERNODE_VERTICAL_PADDING=5,mindplot.layout.SymmetricSorter.INTERNODE_HORIZONTAL_PADDING=30,mindplot.layout.GridSorter=new Class({Extends:mindplot.layout.AbstractBasicSorter,computeOffsets:function(t,e){$assert(t,"treeSet can no be null."),$assert(e,"node can no be null."),$assert("order can no be null.")
for(var i=this._getSortedChildren(t,e),n=i.map(function(e){return{id:e.getId(),height:this._computeChildrenHeight(t,e)}}.bind(this)),o={},s=0;s<n.length;s++){for(var r=s%2==0?1:-1,a=0==s?0:n[0].height/2*r,l=0,d=s-2;d>0;d-=2)l+=n[d].height*r
var c=0==s?0:n[s].height/2*r,h=a+l+c,u=e.getSize().width+mindplot.layout.GridSorter.GRID_HORIZONTAR_SIZE
$assert(!isNaN(u),"xOffset can not be null"),$assert(!isNaN(h),"yOffset can not be null"),o[n[s].id]={x:u,y:h}}return o},toString:function(){return"Grid Sorter"}}),mindplot.layout.GridSorter.GRID_HORIZONTAR_SIZE=20,mindplot.layout.GridSorter.INTER_NODE_VERTICAL_DISTANCE=50,mindplot.layout.OriginalLayout=new Class({initialize:function(t){this._treeSet=t},createNode:function(t,e,i,n){$assert($defined(t),"id can not be null"),$assert(e,"size can not be null"),$assert(i,"position can not be null"),$assert(n,"type can not be null")
var o="root"===n?mindplot.layout.OriginalLayout.BALANCED_SORTER:mindplot.layout.OriginalLayout.SYMMETRIC_SORTER
return new mindplot.layout.Node(t,e,i,o)},connectNode:function(t,e,i){var n=this._treeSet.find(t),o=this._treeSet.find(e),s=n.getSorter()
s.insert(this._treeSet,n,o,i),this._treeSet.connect(t,e),s.verify(this._treeSet,n)},disconnectNode:function(t){var e=this._treeSet.find(t),i=this._treeSet.getParent(e)
$assert(i,"Node already disconnected"),e.setFree(!1),e.resetFreeDisplacement()
var n=i.getSorter()
n.detach(this._treeSet,e),this._treeSet.disconnect(t),i.getSorter().verify(this._treeSet,i)},layout:function(){var t=this._treeSet.getTreeRoots()
t.each(function(t){var e=t.getSorter(),i=e.computeChildrenIdByHeights(this._treeSet,t)
this._layoutChildren(t,i),this._fixOverlapping(t,i)},this)},_layoutChildren:function(t,e){var i=t.getId(),n=this._treeSet.getChildren(t),o=this._treeSet.getParent(t),s=n.some(function(t){return t.hasOrderChanged()}),r=n.some(function(t){return t.hasSizeChanged()}),a=e[i],l=$defined(o)?o._heightChanged:!1,d=t._branchHeight!=a
if(t._heightChanged=d||l,s||r||d||l){var c=t.getSorter(),h=c.computeOffsets(this._treeSet,t),u=t.getPosition()
n.each(function(i){var n=h[i.getId()],o=i.getFreeDisplacement(),s=t.getSorter().getChildDirection(this._treeSet,i);(s>0&&o.x<0||0>s&&o.x>0)&&(i.resetFreeDisplacement(),i.setFreeDisplacement({x:-o.x,y:o.y})),n.x+=i.getFreeDisplacement().x,n.y+=i.getFreeDisplacement().y
var r=u.x,a=u.y,l={x:r+n.x,y:a+n.y+this._calculateAlignOffset(t,i,e)}
this._treeSet.updateBranchPosition(i,l)}.bind(this)),t._branchHeight=a}n.each(function(t){this._layoutChildren(t,e)},this)},_calculateAlignOffset:function(t,e,i){if(e.isFree())return 0
var n=0,o=t.getSize().height,s=e.getSize().height
return this._treeSet.isStartOfSubBranch(e)&&this._branchIsTaller(e,i)?n=this._treeSet.hasSinglePathToSingleLeaf(e)?i[e.getId()]/2-(s+2*e.getSorter()._getVerticalPadding())/2:this._treeSet.isLeaf(e)?0:-(s-o)/2:o>s?n=this._treeSet.getSiblings(e).length>0?0:o/2-s/2:s>o&&(n=this._treeSet.getSiblings(e).length>0?0:-(s/2-o/2)),n},_branchIsTaller:function(t,e){return e[t.getId()]>t.getSize().height+2*t.getSorter()._getVerticalPadding()},_fixOverlapping:function(t,e){var i=this._treeSet.getChildren(t)
t.isFree()&&this._shiftBranches(t,e),i.each(function(t){this._fixOverlapping(t,e)},this)},_shiftBranches:function(t,e){var i=[t],n=this._treeSet.getSiblingsInVerticalDirection(t,t.getFreeDisplacement().y),o=t
n.each(function(n){var o=i.some(function(t){return this._branchesOverlap(t,n,e)},this)
if(!n.isFree()||o){var s=t.getFreeDisplacement().y
this._treeSet.shiftBranchPosition(n,0,s),i.push(n)}},this)
var s=this._treeSet.getBranchesInVerticalDirection(t,t.getFreeDisplacement().y).filter(function(t){return!i.contains(t)})
s.each(function(e){var n=t.getFreeDisplacement().y
this._treeSet.shiftBranchPosition(e,0,n),i.push(e),o=e},this)},_branchesOverlap:function(t,e,i){if(t==e)return!1
var n=t.getPosition().y-i[t.getId()]/2,o=t.getPosition().y+i[t.getId()]/2,s=e.getPosition().y-i[e.getId()]/2,r=e.getPosition().y+i[e.getId()]/2
return!(n>=r||s>=o)}}),mindplot.layout.OriginalLayout.SYMMETRIC_SORTER=new mindplot.layout.SymmetricSorter,mindplot.layout.OriginalLayout.BALANCED_SORTER=new mindplot.layout.BalancedSorter,mindplot.EventBus=new Class({Implements:Events,initialize:function(){}}),mindplot.EventBus.events={NodeResizeEvent:"NodeResizeEvent",NodeMoveEvent:"NodeMoveEvent",NodeShrinkEvent:"NodeShrinkEvent",NodeConnectEvent:"NodeConnectEvent",NodeDisconnectEvent:"NodeDisconnectEvent",NodeAdded:"NodeAdded",NodeRemoved:"NodeRemoved",DoLayout:"DoLayout"},mindplot.EventBus.instance=new mindplot.EventBus,mindplot.Messages.BUNDLES.en={ZOOM_IN:"Zoom In",ZOOM_OUT:"Zoom Out",TOPIC_SHAPE:"Topic Shape",TOPIC_ADD:"Add Topic",TOPIC_DELETE:"Delete Topic",TOPIC_ICON:"Add Icon",TOPIC_LINK:"Add Link",TOPIC_RELATIONSHIP:"Relationship",TOPIC_COLOR:"Topic Color",TOPIC_BORDER_COLOR:"Topic Border Color",TOPIC_NOTE:"Add Note",FONT_FAMILY:"Font Type",FONT_SIZE:"Text Size",FONT_BOLD:"Text Bold",FONT_ITALIC:"Text Italic",UNDO:"Undo",REDO:"Redo",INSERT:"Insert",SAVE:"Save",NOTE:"Note",ADD_TOPIC:"Add Topic",LOADING:"Loading ...",EXPORT:"Export",PRINT:"Print",PUBLISH:"Publish",COLLABORATE:"Share",HISTORY:"History",DISCARD_CHANGES:"Discard Changes",FONT_COLOR:"Text Color",SAVING:"Saving ...",SAVE_COMPLETE:"Save Complete",ZOOM_IN_ERROR:"Zoom too high.",ZOOM_ERROR:"No more zoom can be applied.",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"Could not create a topic. Only one topic must be selected.",ONE_TOPIC_MUST_BE_SELECTED:"Could not create a topic. One topic must be selected.",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"Children can not be collapsed. One topic must be selected.",SAVE_COULD_NOT_BE_COMPLETED:"Save could not be completed, please try again latter.",UNEXPECTED_ERROR_LOADING:"We're sorry, an unexpected error has occurred.\nTry again reloading the editor.",MAIN_TOPIC:"Main Topic",SUB_TOPIC:"Sub Topic",ISOLATED_TOPIC:"Isolated Topic",CENTRAL_TOPIC:"Central Topic",SHORTCUTS:"Keyboard Shortcuts",ENTITIES_COULD_NOT_BE_DELETED:"Could not delete topic or relation. At least one map entity must be selected.",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"At least one topic must be selected.",CLIPBOARD_IS_EMPTY:"Nothing to copy. Clipboard is empty.",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"Central topic can not be deleted.",RELATIONSHIP_COULD_NOT_BE_CREATED:"Relationship could not be created. A parent relationship topic must be selected first.",SELECTION_COPIED_TO_CLIPBOARD:"Topics copied to the clipboard",WRITE_YOUR_TEXT_HERE:"Write your note here ...",REMOVE:"Remove",ACCEPT:"Accept",CANCEL:"Cancel",LINK:"Link",OPEN_LINK:"Open URL",SESSION_EXPIRED:"Your session has expired, please log-in again.",DUMMY:""},mindplot.Messages.BUNDLES.es={DISCARD_CHANGES:"Descartar Cambios",SAVE:"Guardar",INSERT:"Insertar",ZOOM_IN:"Acercar",ZOOM_OUT:"Alejar",TOPIC_BORDER_COLOR:"Color del Borde",TOPIC_SHAPE:"Forma del Tpico",TOPIC_ADD:"Agregar Tpico",TOPIC_DELETE:"Borrar Tpico",TOPIC_ICON:"Agregar Icono",TOPIC_LINK:"Agregar Enlace",TOPIC_NOTE:"Agregar Nota",TOPIC_COLOR:"Color Tpico",TOPIC_RELATIONSHIP:"Relacin",FONT_FAMILY:"Tipo de Fuente",FONT_SIZE:"Tamao de Texto",FONT_BOLD:"Negrita",FONT_ITALIC:"Italica",FONT_COLOR:"Color de Texto",UNDO:"Rehacer",NOTE:"Nota",LOADING:"Cargando ...",PRINT:"Imprimir",PUBLISH:"Publicar",REDO:"Deshacer",ADD_TOPIC:"Agregar Tpico",COLLABORATE:"Compartir",EXPORT:"Exportar",HISTORY:"History",SAVE_COMPLETE:"Grabado Completo",SAVING:"Grabando ...",ONE_TOPIC_MUST_BE_SELECTED:"No ha sido posible crear un nuevo tpico. Al menos un tpico debe ser seleccionado.",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"No ha sido posible crear un nuevo tpico. Slo un tpico debe ser seleccionado.",SAVE_COULD_NOT_BE_COMPLETED:"Grabacin no pudo ser completada. Intentelo mas tarde.",UNEXPECTED_ERROR_LOADING:"Lo sentimos, un error inesperado ha ocurrido. Intentelo nuevamente recargando el editor.",ZOOM_ERROR:"No es posible aplicar mas zoom.",ZOOM_IN_ERROR:"El zoom es muy alto.",MAIN_TOPIC:"Tpico Principal",SUB_TOPIC:"Tpico Secundario",ISOLATED_TOPIC:"Tpico Aislado",CENTRAL_TOPIC:"Tpico Central",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"Tpicos hijos no pueden ser colapsados. Slo un tpico debe ser seleccionado.",SHORTCUTS:"Accesos directos",ENTITIES_COULD_NOT_BE_DELETED:"El tpico o la relacin no pudo ser borrada. Debe selecionar al menos una.",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"Al menos un tpico debe ser seleccionado.",CLIPBOARD_IS_EMPTY:"Nada que copiar. Clipboard est vacio.",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"El tpico central no puede ser borrado.",RELATIONSHIP_COULD_NOT_BE_CREATED:"La relacin no pudo ser creada. Una relacin padre debe ser seleccionada primero.",SELECTION_COPIED_TO_CLIPBOARD:"Tpicos copiados al clipboard",WRITE_YOUR_TEXT_HERE:"Escribe tu nota aqu ...",REMOVE:"Borrar",ACCEPT:"Aceptar",CANCEL:"Cancelar",LINK:"Enlace",OPEN_LINK:"Abrir Enlace",SESSION_EXPIRED:"Su session ha expirado. Por favor, ingrese nuevamente.",DUMMY:""},mindplot.Messages.BUNDLES.de={ZOOM_IN:"Ansicht vergrern",ZOOM_OUT:"Ansicht verkleinern",TOPIC_SHAPE:"Themen Gestaltung",TOPIC_ADD:"Thema hinzufgen",TOPIC_DELETE:"Thema lschen",TOPIC_ICON:"Symbol hinzufgen",TOPIC_LINK:"Verbindung hinzufgen",TOPIC_RELATIONSHIP:"Beziehung",TOPIC_COLOR:"Themenfarbe",TOPIC_BORDER_COLOR:"Thema Randfarbe",TOPIC_NOTE:"Notiz hinzufgen",FONT_FAMILY:"Schrifttyp",FONT_SIZE:"Schriftgre",FONT_BOLD:"Fette Schrift",FONT_ITALIC:"Kursive Schrift",UNDO:"Rckgngig machen",REDO:"Wiederholen",INSERT:"Einfgen",SAVE:"Sichern",NOTE:"Notiz",ADD_TOPIC:"Thema hinzufgen",LOADING:"Laden ...",EXPORT:"Exportieren",PRINT:"Drucken",PUBLISH:"Publizieren",COLLABORATE:"Mitbenutzen",HISTORY:"Historie",DISCARD_CHANGES:"nderungen verwerfen",FONT_COLOR:"Textfarbe",SAVING:"Sichern ...",SAVE_COMPLETE:"Sichern abgeschlossen",ZOOM_IN_ERROR:"Zoom zu hoch.",ZOOM_ERROR:"Es kann nicht weiter vergrert bzw. verkelinert werden.",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"Thema konnte nicht angelegt werden. Bitte whlen Sie nur ein Thema aus.",ONE_TOPIC_MUST_BE_SELECTED:"Thema konnte nicht angelegt werden. Es muss ein Thema ausgewhlt werden.",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"Kinderknoten knnen nicht eingefaltet werden. Es muss ein Thema ausgewht werden.",SAVE_COULD_NOT_BE_COMPLETED:"Sichern wurde nicht abgeschlossen. Versuchen Sie es spter nocheinmal.",UNEXPECTED_ERROR_LOADING:"E tut uns Leid, ein unerwarteter Fehler ist aufgetreten.\nVersuchen Sie, den Editor neu zu laden.",MAIN_TOPIC:"Hauptthema",SUB_TOPIC:"Unterthema",ISOLATED_TOPIC:"Isoliertes Thema",CENTRAL_TOPIC:"Zentrales Thema",SHORTCUTS:"Tastaturkrzel",ENTITIES_COULD_NOT_BE_DELETED:"Konnte das Thema oder die Beziehung nicht lschen. Es muss mindest ein Eintrag ausgewhlt sein.",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"Es muss mindestens ein Thema ausgewhlt sein.",CLIPBOARD_IS_EMPTY:"Es gibt nichts zu kopieren. Die Zwischenablage ist leer.",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"Das zentrale Thema kann nicht gelscht werden.",RELATIONSHIP_COULD_NOT_BE_CREATED:"Die Beziehung konnte nicht angelegt werden. Es muss erst ein Vater-Thema ausgewhlt werden, um die Beziehung herzustellen.",SELECTION_COPIED_TO_CLIPBOARD:"Themen in der Zwischenablage",WRITE_YOUR_TEXT_HERE:"Schreiben Sie ihre Notiz hier ...",REMOVE:"Entfernen",ACCEPT:"Akzeptieren",CANCEL:"Abbrechen",LINK:"Verbindung",OPEN_LINK:"ffne URL",DUMMY:""},mindplot.Messages.BUNDLES.fr={ZOOM_IN:"Agrandir affichage",ZOOM_OUT:"Rduire affichage",TOPIC_SHAPE:"Forme du noeud",TOPIC_ADD:"Ajouter un noeud",TOPIC_DELETE:"Supprimer le noeud",TOPIC_ICON:"Ajouter une icne",TOPIC_LINK:"Ajouter un lien",TOPIC_RELATIONSHIP:"Relation du noeud",TOPIC_COLOR:"Couleur du noeud",TOPIC_BORDER_COLOR:"Couleur de bordure du noeud",TOPIC_NOTE:"Ajouter une note",FONT_FAMILY:"Type de police",FONT_SIZE:"Taille de police",FONT_BOLD:"Caractres gras",FONT_ITALIC:"Caractres italiques",UNDO:"Annuler",REDO:"Refaire",INSERT:"Insrer",SAVE:"Enregistrer",NOTE:"Note",ADD_TOPIC:"Ajouter un noeud",LOADING:"Chargement ...",EXPORT:"Exporter",PRINT:"Imprimer",PUBLISH:"Publier",COLLABORATE:"Partager",HISTORY:"Historique",DISCARD_CHANGES:"Annuler les changements",FONT_COLOR:"Couleur de police",SAVING:"Enregistrement ...",SAVE_COMPLETE:"Enregistrement termin",ZOOM_IN_ERROR:"Zoom trop grand.",ZOOM_ERROR:"Impossible de zoomer plus.",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"Impossible de crer un noeud. Un seul noeud doit tre slectionn.",ONE_TOPIC_MUST_BE_SELECTED:"Impossible de crer un noeud. Un noeud parent doit tre slectionn au pralable.",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"Un noeud enfant ne peut pas tre rduit. Un noeud doit tre slectionn.",SAVE_COULD_NOT_BE_COMPLETED:"Enregistrement impossible. Essayer ultrieurement.",UNEXPECTED_ERROR_LOADING:"Nous sommes dsols, une erreur vient de survenir.\nEssayez de recharger l'diteur.",MAIN_TOPIC:"Noeud titre principal",SUB_TOPIC:"Noeud sous-titre",ISOLATED_TOPIC:"Noeud isol",CENTRAL_TOPIC:"Noeud racine",SHORTCUTS:"Raccourcis clavier",ENTITIES_COULD_NOT_BE_DELETED:"Impossible d'effacer un noeud ou une relation. Au moins un objet de la carte doit tre slectionn.",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"Au moins un objet de la carte doit tre slectionn.",CLIPBOARD_IS_EMPTY:"Rien  copier. Presse-papier vide.",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"Le noeud racine ne peut pas tre effac.",RELATIONSHIP_COULD_NOT_BE_CREATED:"Impossible de crer relation. Un noeud parent doit tre slectionn au pralable.",SELECTION_COPIED_TO_CLIPBOARD:"Noeuds slectionns copis dans le presse-papiers.",ACCEPT:"Accepter",CANCEL:"Annuler",REMOVE:"Supprimer",WRITE_YOUR_TEXT_HERE:"crivez votre texte ici ...",LINK:"Lien",OPEN_LINK:"Ouvrir URL",DUMMY:""},mindplot.Messages.BUNDLES.pt_br={ZOOM_IN:"Ampliar",ZOOM_OUT:"Reduzir",TOPIC_SHAPE:"Forma do Tpico",TOPIC_ADD:"Adicionar Tpico",TOPIC_DELETE:"Deletar Tpico",TOPIC_ICON:"Adicionar cone",TOPIC_LINK:"Adicionar Link",TOPIC_RELATIONSHIP:"Relacionamento",TOPIC_COLOR:"Cor do Tpico",TOPIC_BORDER_COLOR:"Cor da Borda do Tpico",TOPIC_NOTE:"Adicionar Nota",FONT_FAMILY:"Tipo de Fonte",FONT_SIZE:"Tamanho da Fonte",FONT_BOLD:"Fonte Negrito",FONT_ITALIC:"Fonte Itlico",UNDO:"Desfazer",REDO:"Refazer",INSERT:"Inserir",SAVE:"Salvar",NOTE:"Nota",ADD_TOPIC:"Adicionar Tpico",LOADING:"Carregando ...",EXPORT:"Exportar",PRINT:"Imprimir",PUBLISH:"Publicar",COLLABORATE:"Colaborar",HISTORY:"Histria",DISCARD_CHANGES:"Descartar Alteraes",FONT_COLOR:"Cor da Fonte",SAVING:"Salvando ...",SAVE_COMPLETE:"Salvamento Completo",ZOOM_IN_ERROR:"Zoom excessivo.",ZOOM_ERROR:"No  possvel aplicar mais zoom.",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"No foi possvel criar tpico. Apenas um tpico deve ser selecionado.",ONE_TOPIC_MUST_BE_SELECTED:"No foi possvel criar tpico. Um tpico deve ser selecionado.",SAVE_COULD_NOT_BE_COMPLETED:"Salvamento no pode ser completado. Tente novamente mais tarde.",UNEXPECTED_ERROR_LOADING:"Ocorreu um erro inesperado.\nTente recarregar novamente o editor.",MAIN_TOPIC:"Tpico Principal",SUB_TOPIC:"Sub Tpico",ISOLATED_TOPIC:"Tpico Isolado",CENTRAL_TOPIC:"Tpico Central",SHORTCUTS:"Atalho",ENTITIES_COULD_NOT_BE_DELETED:"O tpico ou a relao no pode ser apagado. Seleccionar pelo menos um.",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"Pelo menos um tpico deve ser selecionado",CLIPBOARD_IS_EMPTY:"Nada para copiar. Clipboard est vazio.",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"O tpico central no pode ser apagado.",RELATIONSHIP_COULD_NOT_BE_CREATED:"A relao no pode ser criada. Uma relao pai deve ser selecionada primeiro.",SELECTION_COPIED_TO_CLIPBOARD:"Tpicos copiados ao clipboard.",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"Tpicos filhos no podem ser colapsados. S um tpico deve ser selecionado.",DUMMY:""},mindplot.Messages.BUNDLES.zh_cn={ZOOM_IN:"",ZOOM_OUT:"",TOPIC_SHAPE:"",TOPIC_ADD:"",TOPIC_DELETE:"",TOPIC_ICON:"",TOPIC_LINK:"",TOPIC_RELATIONSHIP:"",TOPIC_COLOR:"",TOPIC_BORDER_COLOR:"",TOPIC_NOTE:"",FONT_FAMILY:"",FONT_SIZE:"",FONT_BOLD:"",FONT_ITALIC:"",UNDO:"",REDO:"",INSERT:"",SAVE:"",NOTE:"",ADD_TOPIC:"",LOADING:"",EXPORT:"",PRINT:"",PUBLISH:"",COLLABORATE:"",HISTORY:"",DISCARD_CHANGES:"",FONT_COLOR:"",SAVING:"",SAVE_COMPLETE:"",ZOOM_IN_ERROR:"",ZOOM_ERROR:"",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"",ONE_TOPIC_MUST_BE_SELECTED:"",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"",SAVE_COULD_NOT_BE_COMPLETED:"",UNEXPECTED_ERROR_LOADING:"\n",MAIN_TOPIC:"",SUB_TOPIC:"",ISOLATED_TOPIC:"",CENTRAL_TOPIC:"",SHORTCUTS:"",ENTITIES_COULD_NOT_BE_DELETED:"",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"",CLIPBOARD_IS_EMPTY:" ",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"",RELATIONSHIP_COULD_NOT_BE_CREATED:" ",SELECTION_COPIED_TO_CLIPBOARD:"",DUMMY:""},mindplot.Messages.BUNDLES.zh_tw={ZOOM_IN:"",ZOOM_OUT:"",TOPIC_SHAPE:"",TOPIC_ADD:"",TOPIC_DELETE:"",TOPIC_ICON:"",TOPIC_LINK:"",TOPIC_RELATIONSHIP:"",TOPIC_COLOR:"",TOPIC_BORDER_COLOR:"",TOPIC_NOTE:"",FONT_FAMILY:"",FONT_SIZE:"",FONT_BOLD:"",FONT_ITALIC:"",UNDO:"",REDO:"",INSERT:"",SAVE:"",NOTE:"",ADD_TOPIC:"",LOADING:"",EXPORT:"",PRINT:"",PUBLISH:"",COLLABORATE:"",HISTORY:"",DISCARD_CHANGES:"",FONT_COLOR:"",SAVING:"",SAVE_COMPLETE:"",ZOOM_IN_ERROR:"",ZOOM_ERROR:"",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"",ONE_TOPIC_MUST_BE_SELECTED:"",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"",SAVE_COULD_NOT_BE_COMPLETED:"",UNEXPECTED_ERROR_LOADING:"\n",MAIN_TOPIC:"",SUB_TOPIC:"",ISOLATED_TOPIC:"",CENTRAL_TOPIC:"",SHORTCUTS:"",ENTITIES_COULD_NOT_BE_DELETED:"",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"",CLIPBOARD_IS_EMPTY:" ",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"",RELATIONSHIP_COULD_NOT_BE_CREATED:" ",SELECTION_COPIED_TO_CLIPBOARD:"",DUMMY:""},mindplot.Messages.BUNDLES.ca={DISCARD_CHANGES:"Descartar els canvis",SAVE:"Desar",INSERT:"Inserir",ZOOM_IN:"Apropar",ZOOM_OUT:"Allunyar",TOPIC_BORDER_COLOR:"Color del bord",TOPIC_SHAPE:"Forma del Tpic",TOPIC_ADD:"Afegir Tpic",TOPIC_DELETE:"Esborrar Tpic",TOPIC_ICON:"Afegir Icona",TOPIC_LINK:"Afegir Enlla",TOPIC_NOTE:"Afegir Nota",TOPIC_COLOR:"Color del Tpic",TOPIC_RELATIONSHIP:"Relaci",FONT_FAMILY:"Tipus de font",FONT_SIZE:"Mida del text",FONT_BOLD:"Negreta",FONT_ITALIC:"Itlica",FONT_COLOR:"Color del Text",UNDO:"Refer",NOTE:"Nota",LOADING:"Carregant ...",PRINT:"Imprimir",PUBLISH:"Publicar",REDO:"Desfer",ADD_TOPIC:"Afegir Tpic",COLLABORATE:"Compartir",EXPORT:"Exportar",HISTORY:"Histria",SAVE_COMPLETE:"Desat completat",SAVING:"Gravant ...",ONE_TOPIC_MUST_BE_SELECTED:"No ha estat possible crear un nou tpic. Com a mnim ha de seleccionar un tpic.",ONLY_ONE_TOPIC_MUST_BE_SELECTED:"No ha estar possible crear un nou tpic. Noms un tpic ha d'estar seleccionat.",SAVE_COULD_NOT_BE_COMPLETED:"No s'ha pogut desar. Provi ms tard.",UNEXPECTED_ERROR_LOADING:"Ho sentim, un error ha esdevingut inesperadament. Provi recarregant l'editor.",ZOOM_ERROR:"No es pot fer ms zoom.",ZOOM_IN_ERROR:"El zoom s massa creixent.",MAIN_TOPIC:"Tpic principal",SUB_TOPIC:"Tpic secundari",ISOLATED_TOPIC:"Tpic allat",CENTRAL_TOPIC:"Tpic central",ONLY_ONE_TOPIC_MUST_BE_SELECTED_COLLAPSE:"Els tpics fills no es poden collapsar. Noms un tpic ha d'estar seleccionat.",SHORTCUTS:"Accessos directes",ENTITIES_COULD_NOT_BE_DELETED:"El tpic o la reluci no poden ser esborrats. Com a mnim ha de seleccionar un.",AT_LEAST_ONE_TOPIC_MUST_BE_SELECTED:"Com a mnim ha de seleccionar un tpic.",CLIPBOARD_IS_EMPTY:"Res a copiar.",CENTRAL_TOPIC_CAN_NOT_BE_DELETED:"El tpic central no pot esborrar-se.",RELATIONSHIP_COULD_NOT_BE_CREATED:"La reluci no s'ha pout drear. Primer has de seleccionar una reluci pare.",SELECTION_COPIED_TO_CLIPBOARD:"Tpics copiats",WRITE_YOUR_TEXT_HERE:"Escriu aqu la teva nota ...",REMOVE:"Esborrar",ACCEPT:"Acceptar",CANCEL:"Cancellar",LINK:"Enlla",OPEN_LINK:"Obrir Enlla",SESSION_EXPIRED:"La seva sessi ha finalitzat. Si us plau, torni a connectar-se.",DUMMY:""}
