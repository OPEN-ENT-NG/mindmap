/*
 *    Copyright [2012] [wisemapping]
 *
 *   Licensed under WiseMapping Public License, Version 1.0 (the "License").
 *   It is basically the Apache License, Version 2.0 (the "License") plus the
 *   "powered by wisemapping" text requirement on every single page;
 *   you may not use this file except in compliance with the License.
 *   You may obtain a copy of the license at
 *
 *       http://www.wisemapping.org/license
 *
 *   Unless required by applicable law or agreed to in writing, software
 *   distributed under the License is distributed on an "AS IS" BASIS,
 *   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *   See the License for the specific language governing permissions and
 *   limitations under the License.
 */
function buildDesigner(options){var container=$moo(options.container)
$assert(container,"container could not be null"),designer=new mindplot.Designer(options,container),window.onerror=function(e,n,t){if("Script error."!==e||0!=t){var i=e
"object"==typeof e&&e.srcElement&&e.target&&(i="[object HTMLScriptElement]"==e.srcElement&&"[object HTMLScriptElement]"==e.target?"Error loading script":"Event Error - target:"+e.target+" srcElement:"+e.srcElement),i=i.toString(),window.waitDialog&&(window.waitDialog.close.delay(1e3,window.waitDialog),window.waitDialog=null),window.mindmapLoadReady||$notifyModal($msg("UNEXPECTED_ERROR_LOADING"))}}
var persistence
if(persistence=options.persistenceManager?options.persistenceManager instanceof String?eval("new "+options.persistenceManager+"()"):options.persistenceManager:new mindplot.LocalStorageManager("/mindmap/public/vendor/wisemapping/samples/{id}.xml"),mindplot.PersistenceManager.init(persistence),$moo("toolbar")){var menu=new mindplot.widget.Menu(designer,"toolbar",options.mapId,"")
designer._cleanScreen=function(){menu.clear()}}return designer}function loadDesignerOptions(e){var n
if(e){var t=new Request.JSON({url:e,async:!1,onSuccess:function(e){this.options=e}.bind(this)})
t.get(),n=this.options}else{var i=$moo("mindmap-content").getPosition(),o=$moo("mindmap-content").getSize(),r={height:parseInt(window.innerHeight)-i.y-30,width:o.x},a={height:parseInt(window.innerHeight)-i.y-70-30,width:o.x},s=$moo("toolbar")
null!=s&&($moo("toolbar").setStyle("width",a.width),$moo("header").setStyle("width",a.width)),n={readOnly:!1,zoom:.85,saveOnLoad:!0,size:r,viewPort:a,container:"mindplot",locale:"en"}}return n}var designer=null
editor={},editor.WaitDialog=new Class({Extends:MooDialog,initialize:function(){var e=this._buildPanel()
this.parent({closeButton:!1,destroyOnClose:!0,autoOpen:!1,useEscKey:!1,title:"",onInitialize:function(e){e.setStyle("opacity",0),this.wrapper.setStyle("display","none"),this.fx=new Fx.Morph(e,{duration:100,transition:Fx.Transitions.Bounce.easeOut})},onBeforeOpen:function(){this.overlay=new Overlay(this.options.inject,{duration:this.options.duration}),this.overlay.open(),this.fx.start({"margin-top":[-200,-100],opacity:[0,1]}).chain(function(){this.fireEvent("show"),this.wrapper.setStyle("display","block")}.bind(this))},onBeforeClose:function(){this.fx.start({"margin-top":[-100,0],opacity:0,duration:200}).chain(function(){this.fireEvent("hide"),this.wrapper.setStyle("display","none")}.bind(this))}}),this.setContent(e)},_buildPanel:function(){var e=new Element("div")
e.setStyles({"text-align":"center","background-color":"red",width:"400px"})
var n=new Element("img",{src:"/mindmap/public/vendor/wisemapping/images/ajax-loader.gif"})
return n.setStyle("margin-top","15px"),n.inject(e),e},show:function(){this.open()},destroy:function(){this.parent(),this.overlay.destroy()}})
